import{_ as V,bd as z,r as k,o as d,i as p,w as a,l as h,t as _,a as l,H as G,d as L,R as j,aT as H,b as Y,f as O,u as J,E as K,a6 as Q,c as w,G as q,M as N,k as C,j as X,bx as M,ak as Z,n as x,q as ee,aG as ae,aD as le,h as se,I as te,p as de,b5 as oe,F as ue,B as re,ap as ne,Y as ie}from"./app-DvNATx7Y.js";import{a as me}from"./apiAdmin-DqdlX2Lq.js";import{U as fe}from"./Upload-B1S3qWAF.js";import{W as pe}from"./AddButton-H-wVgeKn.js";import{R as _e}from"./AddButton-Cp1J059N.js";import{S as he}from"./SaveOutlined-CMUQh6R8.js";const ve={components:{InfoCircleOutlined:z}};function ge(e,t,y,$,D,v){const g=k("InfoCircleOutlined"),o=G;return d(),p(o,null,{title:a(()=>[h(_(e.$t("user.warehouse_not_changable")),1)]),default:a(()=>[l(g)]),_:1})}const ce=V(ve,[["render",ge]]),be=L({props:["addEditData","data","visible","url","addEditType","pageTitle","successMessage"],components:{PlusOutlined:j,LoadingOutlined:H,SaveOutlined:he,Upload:fe,RoleAddButton:_e,WarehouseAddButton:pe,TooltipWarehouse:ce},setup(e,{emit:t}){const{permsArray:y,user:$,appSetting:D,selectedWarehouse:v}=Y(),{addEditRequestAdmin:g,loading:o,rules:u}=me(),n=O([]),m=O([]),i=O({}),f="roles?limit=10000",A="warehouses?limit=10000",S=J(),c=O(!0);K(()=>{const r=axiosAdmin.get(f),b=axiosAdmin.get(A);Promise.all([r,b]).then(([W,E])=>{n.value=W.data,m.value=E.data}),i.value={...e.addEditData}});const I=()=>{g({url:e.url,data:i.value,successMessage:e.successMessage,success:r=>{t("addEditSuccess",r.xid),$.value.xid==r.xid&&S.dispatch("auth/updateUser")}})},B=()=>{u.value={},t("closed")},R=()=>{axiosAdmin.get(f).then(r=>{n.value=r.data})},U=()=>{axiosAdmin.get(A).then(r=>{m.value=r.data})},T=(r,b)=>{i.value={...i.value,warehouse_id:r.length>0?r[0]:void 0}},s=(r,b)=>{b&&b.title&&b.title=="admin"?c.value=!1:c.value=!0};return Q(()=>e.visible,(r,b)=>{if(r)if(c.value=!0,e.addEditType=="edit"&&(c.value=!0,e.data.user_type=="staff_members"&&e.data.role&&e.data.role.name=="admin"&&(c.value=!1),e.data.user_type=="customers"&&e.data.is_walkin_customer&&(c.value=!1)),e.addEditType=="add")e.addEditData.user_type=="staff_members"?i.value={...e.addEditData,warehouse_id:v.value.xid,warehouses:[v.value.xid]}:i.value={...e.addEditData,warehouse_id:v.value.xid,warehouses:[]};else{var W=e.data.warehouse&&e.data.warehouse.xid?e.data.warehouse.xid:void 0,E=[];if(e.addEditData.user_type=="staff_members"){var F=e.data.user_warehouses;Z(F,P=>{E.push(P.x_warehouse_id)})}i.value={...e.addEditData,role_id:e.data.role&&e.data.role.xid?e.data.role.xid:void 0,warehouse_id:W,warehouses:E,opening_balance:e.data.details&&e.data.details.opening_balance?e.data.details.opening_balance:void 0,opening_balance_type:e.data.details&&e.data.details.opening_balance_type?e.data.details.opening_balance_type:void 0,credit_period:e.data.details&&e.data.details.credit_period?e.data.details.credit_period:void 0,credit_limit:e.data.details&&e.data.details.credit_limit?e.data.details.credit_limit:void 0,_method:"PUT"}}}),{loading:o,rules:u,onClose:B,onSubmit:I,roles:n,warehouses:m,formData:i,roleAdded:R,warehouseAdded:U,permsArray:y,appSetting:D,selectedWarehouse:v,warehousesChanged:T,drawerWidth:window.innerWidth<=991?"90%":"45%",warehouseVisible:c,roleChanged:s}}}),we={key:0,style:{display:"flex"}},ye={key:1},$e={style:{display:"flex"}},De={key:0,class:"small-text-message"};function Se(e,t,y,$,D,v){const g=k("Upload"),o=x,u=ee,n=ae,m=le,i=k("WarehouseAddButton"),f=se,A=k("RoleAddButton"),S=te,c=de,I=oe,B=ue,R=k("SaveOutlined"),U=re,T=ne;return d(),p(T,{title:e.pageTitle,width:e.drawerWidth,open:e.visible,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},maskClosable:!1,onClose:e.onClose},{footer:a(()=>[l(U,{type:"primary",onClick:e.onSubmit,style:{"margin-right":"8px"},loading:e.loading},{icon:a(()=>[l(R)]),default:a(()=>[h(" "+_(e.addEditType=="add"?e.$t("common.create"):e.$t("common.update")),1)]),_:1},8,["onClick","loading"]),l(U,{onClick:e.onClose},{default:a(()=>[h(_(e.$t("common.cancel")),1)]),_:1},8,["onClick"])]),default:a(()=>[l(B,{layout:"vertical"},{default:a(()=>[l(f,null,{default:a(()=>[l(u,{xs:24,sm:24,md:6,lg:6},{default:a(()=>[l(o,{label:e.$t("user.profile_image"),name:"profile_image",help:e.rules.profile_image?e.rules.profile_image.message:null,validateStatus:e.rules.profile_image?"error":null},{default:a(()=>[l(g,{formData:e.formData,folder:"user",imageField:"profile_image",onOnFileUploaded:t[0]||(t[0]=s=>{e.formData.profile_image=s.file,e.formData.profile_image_url=s.file_url})},null,8,["formData"])]),_:1},8,["label","help","validateStatus"])]),_:1}),l(u,{xs:24,sm:24,md:18,lg:18},{default:a(()=>[e.warehouseVisible?(d(),p(f,{key:0,gutter:16},{default:a(()=>[l(u,{xs:24,sm:24,md:24,lg:24},{default:a(()=>[l(o,{name:"warehouse_id",help:e.rules.warehouse_id?e.rules.warehouse_id.message:null,validateStatus:e.rules.warehouse_id?"error":null,class:"required"},{label:a(()=>[h(_(e.$t("warehouse.warehouse")),1)]),default:a(()=>[e.permsArray.includes("admin")?(d(),w("span",we,[e.formData.user_type=="staff_members"?(d(),p(m,{key:0,value:e.formData.warehouses,"onUpdate:value":t[1]||(t[1]=s=>e.formData.warehouses=s),placeholder:e.$t("common.select_default_text",[e.$t("warehouse.warehouse")]),mode:"multiple",onChange:e.warehousesChanged},{default:a(()=>[(d(!0),w(q,null,N(e.warehouses,s=>(d(),p(n,{key:s.xid,value:s.xid},{default:a(()=>[h(_(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","onChange"])):(d(),p(m,{key:1,value:e.formData.warehouse_id,"onUpdate:value":t[2]||(t[2]=s=>e.formData.warehouse_id=s),placeholder:e.$t("common.select_default_text",[e.$t("warehouse.warehouse")])},{default:a(()=>[(d(!0),w(q,null,N(e.warehouses,s=>(d(),p(n,{key:s.xid,value:s.xid},{default:a(()=>[h(_(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])),l(i,{onOnAddSuccess:e.warehouseAdded},null,8,["onOnAddSuccess"])])):(d(),w("span",ye,[l(m,{value:e.selectedWarehouse.xid,placeholder:e.$t("common.select_default_text",[e.$t("warehouse.warehouse")]),disabled:""},{default:a(()=>[l(n,{value:e.selectedWarehouse.xid},{default:a(()=>[h(_(e.selectedWarehouse.name),1)]),_:1},8,["value"])]),_:1},8,["value","placeholder"])]))]),_:1},8,["help","validateStatus"])]),_:1})]),_:1})):C("",!0),e.formData.user_type=="staff_members"&&e.permsArray.includes("admin")?(d(),p(f,{key:1,gutter:16},{default:a(()=>[l(u,{xs:24,sm:24,md:24,lg:24},{default:a(()=>[l(o,{label:e.$t("user.role"),name:"role_id",help:e.rules.role_id?e.rules.role_id.message:null,validateStatus:e.rules.role_id?"error":null,class:"required"},{default:a(()=>[X("span",$e,[l(m,{value:e.formData.role_id,"onUpdate:value":t[3]||(t[3]=s=>e.formData.role_id=s),placeholder:e.$t("common.select_default_text",[e.$t("user.role")]),allowClear:!0,onChange:e.roleChanged},{default:a(()=>[(d(!0),w(q,null,N(e.roles,s=>(d(),p(n,{key:s.xid,value:s.xid,title:s.name},{default:a(()=>[h(_(s.display_name),1)]),_:2},1032,["value","title"]))),128))]),_:1},8,["value","placeholder","onChange"]),l(A,{onOnAddSuccess:e.roleAdded},null,8,["onOnAddSuccess"])])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1})):C("",!0),l(f,{gutter:16},{default:a(()=>[l(u,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[l(o,{label:e.$t("user.name"),name:"name",help:e.rules.name?e.rules.name.message:null,validateStatus:e.rules.name?"error":null,class:"required"},{default:a(()=>[l(S,{value:e.formData.name,"onUpdate:value":t[4]||(t[4]=s=>e.formData.name=s),placeholder:e.$t("common.placeholder_default_text",[e.$t("user.name")])},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1}),l(u,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[l(o,{label:"NRC Number",name:"phone",help:e.rules.phone?e.rules.phone.message:null,validateStatus:e.rules.phone?"error":null,class:"required"},{default:a(()=>[l(S,{value:e.formData.phone,"onUpdate:value":t[5]||(t[5]=s=>e.formData.phone=s),placeholder:e.$t("common.placeholder_default_text",[e.$t("user.phone")])},null,8,["value","placeholder"])]),_:1},8,["help","validateStatus"])]),_:1})]),_:1}),l(f,{gutter:16},{default:a(()=>[l(u,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[l(o,{label:e.$t("user.email"),name:"email",help:e.rules.email?e.rules.email.message:null,validateStatus:e.rules.email?"error":null,class:M({required:e.formData.user_type=="staff_members"})},{default:a(()=>[l(S,{value:e.formData.email,"onUpdate:value":t[6]||(t[6]=s=>e.formData.email=s),placeholder:e.$t("common.placeholder_default_text",[e.$t("user.email")])},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus","class"])]),_:1}),l(u,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[l(o,{label:e.$t("user.status"),name:"status",help:e.rules.status?e.rules.status.message:null,validateStatus:e.rules.status?"error":null,class:"required"},{default:a(()=>[l(m,{value:e.formData.status,"onUpdate:value":t[7]||(t[7]=s=>e.formData.status=s),placeholder:e.$t("common.select_default_text",[e.$t("user.status")])},{default:a(()=>[l(n,{value:"enabled"},{default:a(()=>[h(_(e.$t("common.enabled")),1)]),_:1}),l(n,{value:"disabled"},{default:a(()=>[h(_(e.$t("common.disabled")),1)]),_:1})]),_:1},8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),e.formData.user_type=="staff_members"||e.formData.user_type=="customers"?(d(),p(f,{key:2},{default:a(()=>[l(u,{span:24},{default:a(()=>[l(o,{label:e.$t("user.password"),name:"password",help:e.rules.password?e.rules.password.message:null,validateStatus:e.rules.password?"error":null,class:M(e.formData.user_type=="staff_members"?"required":"")},{default:a(()=>[l(c,{value:e.formData.password,"onUpdate:value":t[8]||(t[8]=s=>e.formData.password=s),placeholder:e.$t("common.placeholder_default_text",[e.$t("user.password")])},null,8,["value","placeholder"]),e.addEditType=="edit"?(d(),w("small",De,_(e.$t("user.password_blank")),1)):C("",!0)]),_:1},8,["label","help","validateStatus","class"])]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1}),l(f,{gutter:16},{default:a(()=>[l(u,{xs:24,sm:24,md:24,lg:24},{default:a(()=>[l(o,{label:e.formData.user_type=="staff_members"?e.$t("user.address"):e.$t("user.billing_address"),name:"address",help:e.rules.address?e.rules.address.message:null,validateStatus:e.rules.address?"error":null},{default:a(()=>[l(I,{value:e.formData.address,"onUpdate:value":t[9]||(t[9]=s=>e.formData.address=s),placeholder:e.$t("common.placeholder_default_text",[e.formData.user_type=="staff_members"?e.$t("user.address"):e.$t("user.billing_address")]),"auto-size":{minRows:2,maxRows:3}},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),e.formData.user_type!="staff_members"?(d(),p(f,{key:0,gutter:16},{default:a(()=>[l(u,{xs:24,sm:24,md:24,lg:24},{default:a(()=>[l(o,{label:e.$t("user.shipping_address"),name:"shipping_address",help:e.rules.shipping_address?e.rules.shipping_address.message:null,validateStatus:e.rules.shipping_address?"error":null},{default:a(()=>[l(I,{value:e.formData.shipping_address,"onUpdate:value":t[10]||(t[10]=s=>e.formData.shipping_address=s),placeholder:e.$t("common.placeholder_default_text",[e.$t("user.shipping_address")]),"auto-size":{minRows:2,maxRows:3}},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1},8,["title","width","open","onClose"])}const Oe=V(be,[["render",Se]]),Be=()=>{const{t:e}=ie(),t="users",y="customers",$="suppliers",D={warehouse_id:void 0,warehouses:[],name:"",email:"",profile_image:void 0,profile_image_url:void 0,phone:"",address:"",status:"enabled"},v={shipping_address:"",opening_balance:"",opening_balance_type:"receive",credit_period:"30",credit_limit:"",tax_number:void 0},g={user_type:"customers",...D,...v},o={...g,user_type:"staff_members",role_id:void 0,password:""},u={user_type:"suppliers",...g,...v},n=[{title:e("user.name"),dataIndex:"name",key:"name"},{title:e("user.email"),dataIndex:"email"},{title:e("user.created_at"),dataIndex:"created_at"},{title:e("user.status"),dataIndex:"status",key:"status"},{title:e("common.action"),dataIndex:"action"}],m=[{title:e("user.name"),dataIndex:"name",key:"name",sorter:!0},{title:e("NRC No"),dataIndex:"phone",sorter:!0},{title:e("user.address"),dataIndex:"address",sorter:!0,sorter_field:"user_details.opening_balance"},{title:e("user.created_at"),dataIndex:"created_at",sorter:!0,sorter_field:"user_details.created_at"},{title:e("user.status"),dataIndex:"status",key:"status"},{title:e("common.action"),dataIndex:"action"}],i=[{key:"users.name",value:e("user.name")},{key:"email",value:e("user.email")},{key:"phone",value:e("NRC")}];return{customerInitData:g,staffMemberInitData:o,supplierInitData:u,columns:n,supplierCustomerColumns:m,filterableColumns:i,staffMemberAddEditUrl:t,customerAddEditUrl:y,supplierAddEditUrl:$}};export{Oe as A,Be as f};

import{_ as Z,d as se,r,o as l,i,w as t,a as n,X as re,aw as ie,R as ue,az as de,aA as me,Y as _e,b as ce,z as pe,f as b,E as fe,a6 as Q,V as ye,c as w,G as D,l as p,t as f,k as _,M as X,j as ge,ab as ve,ay as be,aB as he,aC as Ce,B as ke,a0 as we,q as Te,aD as Ue,aE as De,aF as Ae,h as Oe,an as Se,ao as Ee,ar as Ke,bk as Ie,aL as Ve,aM as Be,H as Pe,aN as Fe,J as Me,aG as Ne}from"./app-HdXSdTOu.js";import{c as ze}from"./crud-C3WIpcJe.js";import{A as He,f as Re}from"./fields-Clp4rBmf.js";import{U as Le}from"./UserInfo-0DA0bNrn.js";import{S as We}from"./StateWidget-DHsq3jFM.js";import{A as je}from"./AdminPageHeader-CKAPlPNc.js";import{T as qe,U as Ge,a as Je}from"./View-SEJze1eV.js";import{I as Xe}from"./Import-DHRy7asB.js";import{a as Ye}from"./apiAdmin-jek4HXdt.js";import{A as $e,a as Qe}from"./ArrowUpOutlined-CBRwW9ra.js";import"./datatable-V5kmrzHQ.js";import"./filter-DfbYrfQW.js";import"./Upload-iMmlPBEo.js";import"./AddButton-B_ZPOMMa.js";import"./AddEdit-CQ5OL_Tz.js";import"./SaveOutlined-8JMskt8c.js";import"./SettingOutlined-CHtKDXtI.js";import"./AddButton-DYO7K_vk.js";import"./AddEdit-yvjCRIYz.js";import"./index-BZA6vCQE.js";import"./UploadFile-CywWHn_d.js";import"./CloudDownloadOutlined-qmdBnD60.js";const Ze=se({props:["visible","user"],components:{Transactions:qe},setup(e,{emit:u}){const{loading:I,rules:a}=Ye();return{loading:I,rules:a,onClose:()=>{u("closed")}}}});function xe(e,u,I,a,P,W){const V=r("Transactions"),B=re;return l(),i(B,{open:e.visible,centered:!0,title:e.$t("payments.transactions"),onCancel:e.onClose,width:"40%",footer:!1},{default:t(()=>[n(V,{user_id:e.user.xid,result_type:e.user.user_type=="staff_members"?"staff_member":"customer_supplier"},null,8,["user_id","result_type"])]),_:1},8,["open","title","onCancel"])}const ea=Z(Ze,[["render",xe]]),aa={components:{EyeOutlined:ie,PlusOutlined:ue,EditOutlined:de,DeleteOutlined:me,ArrowUpOutlined:$e,ArrowDownOutlined:Qe,AddEdit:He,UserInfo:Le,StateWidget:We,AdminPageHeader:je,UserBalance:Ge,UserView:Je,ImportUsers:Xe,UserTransaction:ea},setup(){const{t:e}=_e(),{statusColors:u,userStatus:I,permsArray:a,formatDateTime:P,user:W,selectedWarehouse:V,formatAmountCurrency:B}=ce(),{supplierInitData:A,customerInitData:F,staffMemberInitData:M,columns:j,supplierCustomerColumns:C,filterableColumns:N}=Re(),s=ze(),h=pe(),d=b(h.meta.menuKey),z="?fields=id,district,xid,user_type,name,email,profile_image,profile_image_url,is_walkin_customer,phone,address,shipping_address,status,tax_number,created_at,details{opening_balance,opening_balance_type,credit_period,credit_limit,due_amount,warehouse_id,x_warehouse_id},details:warehouse{id,xid,name},role_id,role{id,xid,name,display_name},warehouse_id,x_warehouse_id,warehouse{xid,name},userWarehouses{user_id,x_user_id,warehouse_id,x_warehouse_id}",k=b(void 0),q=b("all"),T=b("all"),y=b([]),O=b(""),S=b(""),g=b(""),E=b(!1),H=b(""),R=m=>{E.value=!0,H.value=m},G=()=>{E.value=!1};fe(()=>{K(),s.table.filterableColumns=N,L()});const L=()=>{d.value=="suppliers"?(s.initData.value={...A},s.formData.value={...A},s.langKey.value="supplier",y.value=C,O.value=window.config.supplier_sample_file,S.value=e("supplier.import_suppliers"),g.value="suppliers/import"):d.value=="customers"?(s.initData.value={...F},s.formData.value={...F},s.langKey.value="customer",y.value=C,O.value=window.config.customer_sample_file,S.value=e("customer.import_customers"),g.value="customers/import"):(s.initData.value={...M},s.formData.value={...M},s.langKey.value="staff_member",y.value=j,O.value=window.config.staff_member_sample_file,S.value=e("staff_member.import_staff_members"),g.value="users/import"),s.restFormData()},K=()=>{s.crudUrl.value=d.value;var m="",c={};k.value!=null&&k.value!="all"&&(m+=`status eq "${k.value}"`),T.value!=null&&T.value!="all"&&d.value!="users"&&(c.search_due_type=T.value),s.tableUrl.value={url:`${d.value}${z}`,filterString:m,extraFilters:c},s.fetch({page:1})};Q(()=>h.meta.menuKey,(m,c)=>{(h.meta.menuKey=="users"||h.meta.menuKey=="customers"||h.meta.menuKey=="suppliers")&&(d.value=h.meta.menuKey,k.value=void 0,s.table.searchColumn=void 0,s.table.searchString="",T.value="all",K(),L())}),Q(V,(m,c)=>{K()});const J=ye(()=>{let m=0;return s.table.data.forEach(c=>{c&&c.details&&c.details.due_amount&&(m+=c.details.due_amount)}),{totalOpeningBalance:m}});return{statusColors:u,userStatus:I,filterableColumns:N,userType:d,tableColumns:y,searchStatus:k,setUrlData:K,searchDueType:T,activeTabKey:q,...s,permsArray:a,transactionVisible:E,formatDateTime:P,user:W,formatAmountCurrency:B,sampleFileUrl:O,importPageTitle:S,importUrl:g,totals:J,onCloseTransactions:G,openTransactions:R,modelData:H}}},na={class:"table-responsive"},ta={key:0};function oa(e,u,I,a,P,W){const V=be,B=r("router-link"),A=he,F=Ce,M=r("AdminPageHeader"),j=r("PlusOutlined"),C=ke,N=r("ImportUsers"),s=we,h=r("DeleteOutlined"),d=Te,z=Ne,k=Ue,q=De,T=Ae,y=Oe,O=r("admin-page-filters"),S=r("AddEdit"),g=Se,E=Ee,H=r("user-info"),R=Ke,G=Ie,L=r("UserBalance"),K=r("EyeOutlined"),J=r("EditOutlined"),m=Ve,c=Be,x=r("ArrowUpOutlined"),Y=Pe,ee=r("ArrowDownOutlined"),ae=Fe,ne=Me,te=r("UserView"),oe=r("UserTransaction"),le=r("admin-page-table-content");return l(),w(D,null,[n(M,null,{header:t(()=>[n(V,{title:e.$t(`menu.${e.langKey}s`),class:"p-0"},null,8,["title"])]),breadcrumb:t(()=>[n(F,{separator:"-",style:{"font-size":"12px"}},{default:t(()=>[n(A,null,{default:t(()=>[n(B,{to:{name:"admin.dashboard.index"}},{default:t(()=>[p(f(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),n(A,null,{default:t(()=>[p(f(e.$t("menu.parties")),1)]),_:1}),n(A,null,{default:t(()=>[p(f(e.$t(`menu.${e.langKey}s`)),1)]),_:1})]),_:1})]),_:1}),n(O,null,{default:t(()=>[n(y,{gutter:[16,16]},{default:t(()=>[n(d,{xs:24,sm:24,md:12,lg:10,xl:10},{default:t(()=>[n(s,null,{default:t(()=>[a.permsArray.includes(`${a.userType}_create`)||a.permsArray.includes("admin")?(l(),i(s,{key:0},{default:t(()=>[n(C,{type:"primary",onClick:e.addItem},{default:t(()=>[n(j),p(" "+f(e.$t(`${e.langKey}.add`)),1)]),_:1},8,["onClick"]),n(N,{pageTitle:a.importPageTitle,sampleFileUrl:a.sampleFileUrl,importUrl:a.importUrl,onOnUploadSuccess:a.setUrlData},null,8,["pageTitle","sampleFileUrl","importUrl","onOnUploadSuccess"])]),_:1})):_("",!0),e.table.selectedRowKeys.length>0&&(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))?(l(),i(C,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:t(()=>[n(h)]),default:t(()=>[p(" "+f(e.$t("common.delete")),1)]),_:1},8,["onClick"])):_("",!0)]),_:1})]),_:1}),n(d,{xs:24,sm:24,md:12,lg:14,xl:14},{default:t(()=>[n(y,{gutter:[16,16],justify:"end"},{default:t(()=>[n(d,{xs:24,sm:24,md:12,lg:8,xl:8},{default:t(()=>[n(T,{compact:""},{default:t(()=>[n(k,{style:{width:"25%"},value:e.table.searchColumn,"onUpdate:value":u[0]||(u[0]=o=>e.table.searchColumn=o),placeholder:e.$t("common.select_default_text",[""])},{default:t(()=>[(l(!0),w(D,null,X(a.filterableColumns,o=>(l(),i(z,{key:o.key},{default:t(()=>[p(f(o.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),n(q,{style:{width:"75%"},value:e.table.searchString,"onUpdate:value":u[1]||(u[1]=o=>e.table.searchString=o),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,loading:e.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1}),a.userType&&a.userType!="users"?(l(),i(d,{key:0,xs:24,sm:24,md:12,lg:6,xl:6},{default:t(()=>[n(k,{value:a.searchStatus,"onUpdate:value":u[2]||(u[2]=o=>a.searchStatus=o),onChange:a.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("user.status")]),allowClear:!0,optionFilterProp:"label"},{default:t(()=>[(l(!0),w(D,null,X(a.userStatus,o=>(l(),i(z,{key:o.key,value:o.key,label:o.value},{default:t(()=>[p(f(o.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):_("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n(le,null,{default:t(()=>[n(S,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,addEditData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","addEditData","data","pageTitle","successMessage"]),a.userType&&a.userType=="users"?(l(),i(y,{key:0},{default:t(()=>[n(d,{span:24},{default:t(()=>[n(E,{activeKey:a.searchStatus,"onUpdate:activeKey":u[3]||(u[3]=o=>a.searchStatus=o),onChange:a.setUrlData},{default:t(()=>[n(g,{key:"all",tab:`${e.$t("common.all")} ${e.$t("menu.users")}`},null,8,["tab"]),(l(!0),w(D,null,X(a.userStatus,o=>(l(),i(g,{key:o.key,tab:`${o.value} ${e.$t("menu.users")}`},null,8,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):_("",!0),a.userType&&a.userType!="users"?(l(),i(y,{key:1},{default:t(()=>[n(d,{span:24},{default:t(()=>[n(E,{activeKey:a.searchDueType,"onUpdate:activeKey":u[4]||(u[4]=o=>a.searchDueType=o),onChange:a.setUrlData},{default:t(()=>[n(g,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),n(g,{key:"receive",tab:`${e.$t("user.to_receive")}`},null,8,["tab"]),n(g,{key:"pay",tab:`${e.$t("user.to_pay")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):_("",!0),n(y,{gutter:[15,15]},{default:t(()=>[n(d,{span:24},{default:t(()=>[ge("div",na,[n(ne,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:o=>({disabled:!!(a.user.xid==o.xid||o.is_walkin_customer),name:o.xid})},columns:a.tableColumns,"row-key":o=>o.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},ve({bodyCell:t(({column:o,text:$,record:v})=>[o.dataIndex==="name"?(l(),i(R,{key:0,type:"primary",onClick:U=>e.viewItem(v)},{default:t(()=>[n(H,{user:v},null,8,["user"])]),_:2},1032,["onClick"])):_("",!0),o.dataIndex==="status"?(l(),i(G,{key:1,color:a.statusColors[$]},{default:t(()=>[p(f(e.$t(`common.${$}`)),1)]),_:2},1032,["color"])):_("",!0),o.dataIndex==="created_at"?(l(),w(D,{key:2},[p(f(a.formatDateTime(v.created_at)),1)],64)):_("",!0),o.dataIndex==="balance"?(l(),w(D,{key:3},[a.userType&&a.userType!="users"?(l(),i(R,{key:0,type:"primary",onClick:U=>a.openTransactions(v)},{default:t(()=>{var U;return[n(L,{amount:(U=v.details)==null?void 0:U.due_amount},null,8,["amount"])]}),_:2},1032,["onClick"])):_("",!0)],64)):_("",!0),o.dataIndex==="action"?(l(),w(D,{key:4},[n(C,{type:"primary",onClick:U=>e.viewItem(v),style:{"margin-left":"4px"}},{icon:t(()=>[n(K)]),_:2},1032,["onClick"]),a.permsArray.includes(`${a.userType}_edit`)||a.permsArray.includes("admin")?(l(),i(C,{key:0,type:"primary",onClick:U=>e.editItem(v),style:{"margin-left":"4px"}},{icon:t(()=>[n(J)]),_:2},1032,["onClick"])):_("",!0),(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))&&a.user.xid!=v.xid&&!v.is_walkin_customer?(l(),i(C,{key:1,type:"primary",onClick:U=>e.showDeleteConfirm(v.xid),style:{"margin-left":"4px"}},{icon:t(()=>[n(h)]),_:2},1032,["onClick"])):_("",!0)],64)):_("",!0)]),_:2},[a.userType&&a.userType!="users"?{name:"summary",fn:t(()=>[n(ae,null,{default:t(()=>[n(m,{"col-span":1}),n(m,{"col-span":2}),n(m,{"col-span":1},{default:t(()=>[n(c,{strong:""},{default:t(()=>[p(f(e.$t("common.total")),1)]),_:1})]),_:1}),n(m,{"col-span":1},{default:t(()=>[n(c,{strong:""},{default:t(()=>[a.totals.totalOpeningBalance<0?(l(),i(Y,{key:0},{default:t(()=>[n(x,{style:{color:"red"}}),p(" "+f(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1})):(l(),i(Y,{key:1},{default:t(()=>[a.totals.totalOpeningBalance>0?(l(),w("span",ta,[n(ee,{style:{color:"green"}})])):_("",!0),p(" "+f(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),n(te,{user:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["user","visible","onClosed"]),n(oe,{user:a.modelData,visible:a.transactionVisible,onClosed:a.onCloseTransactions},null,8,["user","visible","onClosed"])]),_:1})],64)}const Aa=Z(aa,[["render",oa]]);export{Aa as default};

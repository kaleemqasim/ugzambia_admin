import{Y as H,f as F,_ as L,d as ne,R as z,aT as oe,b as N,E as W,a6 as de,r as D,o as d,i as h,w as t,a,l as i,t as u,j as q,c as g,M as V,G as b,k as c,aD as j,n as se,q as G,be as ie,h as J,cw as ue,I as re,bx as _e,bv as me,b5 as ce,F as pe,B as Q,a0 as X,ap as fe,aG as Z,az as ke,aA as ve,ay as ye,aB as ge,aC as be,bH as he,an as De,ao as Ae,bk as Se,J as Ce}from"./app-D3eloUX2.js";import{c as $e}from"./crud-D6aIAN0x.js";import{a as we}from"./apiAdmin-B60GDIU8.js";import{S as Te}from"./StaffAddButton-3OrXm8Ly.js";import{D as Ue}from"./DateTimePicker-CaqXsncS.js";import{L as Ie}from"./AddButton-BuoMDVOc.js";import{h as K}from"./hrmManagement-fW1R_DsR.js";import{S as Ee}from"./SaveOutlined-B_YtmicC.js";import{A as Oe}from"./AdminPageHeader-BkRYIxZf.js";import{A as Be}from"./AttendanceSidebar-DnlEUwbk.js";import{A as Me}from"./AttendanceStatus-Bh2y3Pmr.js";import"./datatable-BRMuZcLF.js";import"./filter--sE1IjVM.js";import"./fields-CYo6T7m5.js";import"./Upload-BEuZnvgX.js";import"./AddButton-Blg05Etw.js";import"./AddEdit-DItSI2Ql.js";import"./SettingOutlined-DEIrfDnA.js";import"./AddButton-DFHvta5m.js";import"./AddEdit-DMmf-rrz.js";import"./fields-BbJF1OBY.js";import"./index-Cm_k0kzj.js";import"./ScheduleOutlined-Mcdb3Gik.js";import"./TabletOutlined-DhQavf0r.js";import"./CarOutlined-6OjCM_u0.js";const Pe=()=>{const e="attendances?fields=id,xid,user_id,x_user_id,reason,leave_type_id,x_leave_type_id,date,clock_in_time,clock_out_time,total_duration,user{id,xid,name},is_late,is_half_day,clock_in_date_time,clock_out_date_time,clock_in_ip_address,clock_out_ip_address",n="attendances",{t:p}=H(),l=["user_id","leave_type_id"],U={user_id:void 0,leave_type_id:void 0,date:void 0,clock_in_time:void 0,clock_out_time:void 0,clock_in_ip_address:"",clock_out_ip_address:"",is_late:0,is_half_day:0,reason:""},M=F([{title:p("attendance.user_id"),dataIndex:"user_id"},{title:p("attendance.date"),dataIndex:"date"},{title:p("attendance.clock_in_date_time"),dataIndex:"clock_in_date_time"},{title:p("attendance.clock_out_date_time"),dataIndex:"clock_out_date_time"},{title:p("attendance.clock_in_ip_address"),dataIndex:"clock_in_ip_address"},{title:p("attendance.clock_out_ip_address"),dataIndex:"clock_out_ip_address"},{title:p("attendance.total_duration"),dataIndex:"total_duration"},{title:p("attendance.is_late"),dataIndex:"is_late"},{title:p("common.status"),dataIndex:"status"}]),T=[{key:"name",value:p("common.name")}];return{addEditUrl:n,initData:U,columns:M,filterableColumns:T,hashableColumns:l,url:e}},Fe=ne({props:["formData","data","visible","url","addEditType","pageTitle","successMessage"],components:{PlusOutlined:z,LoadingOutlined:oe,SaveOutlined:Ee,UserAddButton:Te,DateTimePicker:Ue,LeaveTypeAddButton:Ie,hrmManagement:K},setup(e,{emit:n}){const{addEditRequestAdmin:p,loading:l,rules:U}=we(),{appSetting:M,disabledDate:T,permsArray:f}=N(),A=F([]),k="users?limit=10000",r=F([]),S="leave-types?fields=id,xid,name&limit=10000",{formatShiftTime24Hours:_,formatShiftTime12Hours:C}=K(),$=()=>{let y=_(e.formData.clock_in_time),I=_(e.formData.clock_out_time);p({url:e.url,data:{...e.formData,clock_in_time:e.formData.clock_in_time?y:"",clock_out_time:e.formData.clock_out_time?I:""},successMessage:e.successMessage,success:m=>{n("addEditSuccess",m.xid)}})};W(()=>{const y=axiosAdmin.get(k),I=axiosAdmin.get(S);Promise.all([y,I]).then(([m,B])=>{A.value=m.data,r.value=B.data})});const w=()=>{U.value={},n("closed")},E=()=>{axiosAdmin.get(k).then(y=>{A.value=y.data})},O=()=>{axiosAdmin.get(S).then(y=>{r.value=y.data})};return de(()=>e.visible,(y,I)=>{e.addEditType=="edit"?(e.formData.clock_in_time=C(e.data.clock_in_time)!=null?C(e.data.clock_in_time):void 0,e.formData.clock_out_time=C(e.data.clock_out_time)!=null?C(e.data.clock_out_time):void 0):(e.formData.clock_in_time=void 0,e.formData.clock_out_time=void 0)}),{loading:l,rules:U,onClose:w,onSubmit:$,appSetting:M,disabledDate:T,permsArray:f,users:A,userAdded:E,allLeaveTypes:r,leaveTypeAdded:O,drawerWidth:window.innerWidth<=991?"90%":"45%"}}}),Ye={style:{display:"flex"}},qe={style:{display:"flex"}};function Ve(e,n,p,l,U,M){const T=Z,f=j,A=D("UserAddButton"),k=se,r=G,S=ie,_=J,C=ue,$=re,w=_e,E=me,O=D("LeaveTypeAddButton"),y=ce,I=pe,m=D("SaveOutlined"),B=Q,Y=X,P=fe;return d(),h(P,{title:e.pageTitle,width:e.drawerWidth,open:e.visible,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},maskClosable:!1,onClose:e.onClose},{footer:t(()=>[a(Y,null,{default:t(()=>[a(B,{key:"submit",type:"primary",loading:e.loading,onClick:e.onSubmit},{icon:t(()=>[a(m)]),default:t(()=>[i(" "+u(e.addEditType=="add"?e.$t("common.create"):e.$t("common.update")),1)]),_:1},8,["loading","onClick"]),a(B,{key:"back",onClick:e.onClose},{default:t(()=>[i(u(e.$t("common.cancel")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[a(I,{layout:"vertical"},{default:t(()=>[a(_,{gutter:16},{default:t(()=>[a(r,{xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(k,{label:e.$t("attendance.user"),name:"user_id",help:e.rules.user_id?e.rules.user_id.message:null,validateStatus:e.rules.user_id?"error":null,class:"required"},{default:t(()=>[q("span",Ye,[a(f,{value:e.formData.user_id,"onUpdate:value":n[0]||(n[0]=o=>e.formData.user_id=o),placeholder:e.$t("common.select_default_text",[e.$t("attendance.user")]),allowClear:!0},{default:t(()=>[(d(!0),g(b,null,V(e.users,o=>(d(),h(T,{key:o.xid,value:o.xid},{default:t(()=>[i(u(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"]),a(A,{onOnAddSuccess:e.userAdded},null,8,["onOnAddSuccess"])])]),_:1},8,["label","help","validateStatus"])]),_:1}),a(r,{xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(k,{label:e.$t("attendance.date"),name:"date",help:e.rules.date?e.rules.date.message:null,validateStatus:e.rules.date?"error":null,class:"required"},{default:t(()=>[a(S,{value:e.formData.date,"onUpdate:value":n[1]||(n[1]=o=>e.formData.date=o),format:e.appSetting.date_format,valueFormat:"YYYY-MM-DD",style:{width:"100%"}},null,8,["value","format"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),a(_,{gutter:16},{default:t(()=>[a(r,{xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(k,{label:e.$t("shift.clock_in_time"),name:"clock_in_time",help:e.rules.clock_in_time?e.rules.clock_in_time.message:null,validateStatus:e.rules.clock_in_time?"error":null,class:"required"},{default:t(()=>[a(C,{value:e.formData.clock_in_time,"onUpdate:value":n[2]||(n[2]=o=>e.formData.clock_in_time=o),valueFormat:"h:mm A",style:{width:"100%"},"use12-hours":""},null,8,["value"])]),_:1},8,["label","help","validateStatus"])]),_:1}),a(r,{xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(k,{label:e.$t("attendance.clock_in_ip_address"),name:"clock_in_ip_address",help:e.rules.clock_in_ip_address?e.rules.clock_in_ip_address.message:null,validateStatus:e.rules.clock_in_ip_address?"error":null},{default:t(()=>[a($,{value:e.formData.clock_in_ip_address,"onUpdate:value":n[3]||(n[3]=o=>e.formData.clock_in_ip_address=o),placeholder:e.$t("common.placeholder_default_text",[e.$t("attendance.clock_in_ip_address")])},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),a(_,{gutter:16},{default:t(()=>[a(r,{xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(k,{label:e.$t("shift.clock_out_time"),name:"clock_out_time",help:e.rules.clock_out_time?e.rules.clock_out_time.message:null,validateStatus:e.rules.clock_out_time?"error":null,class:"required"},{default:t(()=>[a(C,{value:e.formData.clock_out_time,"onUpdate:value":n[4]||(n[4]=o=>e.formData.clock_out_time=o),valueFormat:"h:mm A",style:{width:"100%"},"use12-hours":""},null,8,["value"])]),_:1},8,["label","help","validateStatus"])]),_:1}),a(r,{xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(k,{label:e.$t("attendance.clock_out_ip_address"),name:"clock_out_ip_address",help:e.rules.clock_out_ip_address?e.rules.clock_out_ip_address.message:null,validateStatus:e.rules.clock_out_ip_address?"error":null},{default:t(()=>[a($,{value:e.formData.clock_out_ip_address,"onUpdate:value":n[5]||(n[5]=o=>e.formData.clock_out_ip_address=o),placeholder:e.$t("common.placeholder_default_text",[e.$t("attendance.clock_out_ip_address")])},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),a(_,{gutter:16},{default:t(()=>[a(r,{xs:24,sm:24,md:6,lg:6},{default:t(()=>[a(k,{label:e.$t("attendance.is_late"),name:"is_late",help:e.rules.is_late?e.rules.is_late.message:null,validateStatus:e.rules.is_late?"error":null},{default:t(()=>[a(E,{value:e.formData.is_late,"onUpdate:value":n[6]||(n[6]=o=>e.formData.is_late=o),"button-style":"solid",size:"small"},{default:t(()=>[a(w,{value:1},{default:t(()=>[i(u(e.$t("common.yes")),1)]),_:1}),a(w,{value:0},{default:t(()=>[i(u(e.$t("common.no")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label","help","validateStatus"])]),_:1}),a(r,{xs:24,sm:24,md:6,lg:6},{default:t(()=>[a(k,{label:e.$t("attendance.is_half_day"),name:"is_half_day",help:e.rules.is_half_day?e.rules.is_half_day.message:null,validateStatus:e.rules.is_half_day?"error":null},{default:t(()=>[a(E,{value:e.formData.is_half_day,"onUpdate:value":n[7]||(n[7]=o=>e.formData.is_half_day=o),"button-style":"solid",size:"small"},{default:t(()=>[a(w,{value:1},{default:t(()=>[i(u(e.$t("common.yes")),1)]),_:1}),a(w,{value:0},{default:t(()=>[i(u(e.$t("common.no")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label","help","validateStatus"])]),_:1}),e.formData.is_half_day==1?(d(),h(r,{key:0,xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(k,{label:e.$t("attendance.leave_type"),name:"leave_type_id",help:e.rules.leave_type_id?e.rules.leave_type_id.message:null,validateStatus:e.rules.leave_type_id?"error":null,class:"required"},{default:t(()=>[q("span",qe,[a(f,{value:e.formData.leave_type_id,"onUpdate:value":n[8]||(n[8]=o=>e.formData.leave_type_id=o),placeholder:e.$t("common.select_default_text",[e.$t("attendance.leave_type")]),allowClear:!0},{default:t(()=>[(d(!0),g(b,null,V(e.allLeaveTypes,o=>(d(),h(T,{key:o.xid,value:o.xid},{default:t(()=>[i(u(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"]),a(O,{onOnAddSuccess:e.leaveTypeAdded},null,8,["onOnAddSuccess"])])]),_:1},8,["label","help","validateStatus"])]),_:1})):c("",!0)]),_:1}),e.formData.is_half_day==1?(d(),h(_,{key:0,gutter:16},{default:t(()=>[a(r,{xs:24,sm:24,md:24,lg:24},{default:t(()=>[a(k,{label:e.$t("attendance.reason"),name:"reason",help:e.rules.reason?e.rules.reason.message:null,validateStatus:e.rules.reason?"error":null,class:"required"},{default:t(()=>[a(y,{value:e.formData.reason,"onUpdate:value":n[9]||(n[9]=o=>e.formData.reason=o),placeholder:e.$t("common.placeholder_default_text",[e.$t("attendance.reason")]),rows:4},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1})):c("",!0)]),_:1})]),_:1},8,["title","width","open","onClose"])}const Ke=L(Fe,[["render",Ve]]),Re={components:{PlusOutlined:z,EditOutlined:ke,DeleteOutlined:ve,AddEdit:Ke,AdminPageHeader:Oe,AttendanceSidebar:Be,AttendanceStatus:Me},setup(){const{t:e}=H(),{addEditUrl:n,initData:p,columns:l,filterableColumns:U,url:M,hashableColumns:T}=Pe(),f=$e(),A=F([]),k="users?limit=10000",r=F({user_id:void 0,date:void 0,status:"all"}),{permsArray:S,appSetting:_,formatDate:C,formatTime:$,formatDateTime:w}=N(),{formatMinutes:E}=K();W(()=>{(S.value.includes("attendances_edit")||S.value.includes("attendances_delete")||S.value.includes("admin"))&&(l.value=[...l.value,{title:e("common.action"),dataIndex:"action"}]),y(),O()});const O=()=>{f.tableUrl.value={url:M,extraFilters:r},f.table.filterableColumns=U,f.crudUrl.value=n,f.langKey.value="attendance",f.initData.value={...p},f.formData.value={...p},f.hashableColumns.value=[...T],f.table.sorter={field:"date",order:"desc"},f.fetch({page:1})},y=()=>{const m=axiosAdmin.get(k);Promise.all([m]).then(([B])=>{A.value=B.data})};return{extraFilters:r,users:A,columns:l,...f,filterableColumns:U,permsArray:S,appSetting:_,formatDate:C,formatTime:$,formatDateTime:w,formatMinutes:E,setUrlData:O,getAttendanceStatus:m=>{if(m.is_half_day)return"half_day";if(m.x_leave_type_id)return"on_leave";if(m.clock_in_date_time&&m.clock_out_date_time)return"present"}}}},He={class:"table-responsive"};function Le(e,n,p,l,U,M){const T=ye,f=D("router-link"),A=ge,k=be,r=D("AdminPageHeader"),S=D("AttendanceSidebar"),_=G,C=D("PlusOutlined"),$=Q,w=D("DeleteOutlined"),E=X,O=Z,y=j,I=he,m=J,B=D("admin-page-filters"),Y=D("AddEdit"),P=De,o=Ae,R=Se,x=D("AttendanceStatus"),ee=D("EditOutlined"),ae=Ce,te=D("admin-page-table-content");return d(),g(b,null,[a(r,null,{header:t(()=>[a(T,{title:e.$t("menu.attendances"),class:"p-0"},null,8,["title"])]),breadcrumb:t(()=>[a(k,{separator:"-",style:{"font-size":"12px"}},{default:t(()=>[a(A,null,{default:t(()=>[a(f,{to:{name:"admin.dashboard.index"}},{default:t(()=>[i(u(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),a(A,null,{default:t(()=>[i(u(e.$t("menu.hrm")),1)]),_:1}),a(A,null,{default:t(()=>[i(u(e.$t("menu.attendances")),1)]),_:1})]),_:1})]),_:1}),a(m,null,{default:t(()=>[a(_,{xs:24,sm:24,md:24,lg:4,xl:4,class:"bg-setting-sidebar"},{default:t(()=>[a(S)]),_:1}),a(_,{xs:24,sm:24,md:24,lg:20,xl:20},{default:t(()=>[a(B,null,{default:t(()=>[a(m,{gutter:[16,16]},{default:t(()=>[a(_,{xs:24,sm:24,md:12,lg:10,xl:10},{default:t(()=>[a(E,null,{default:t(()=>[l.permsArray.includes("attendances_create")||l.permsArray.includes("admin")?(d(),h($,{key:0,type:"primary",onClick:e.addItem},{default:t(()=>[a(C),i(" "+u(e.$t("attendance.add")),1)]),_:1},8,["onClick"])):c("",!0),e.table.selectedRowKeys.length>0&&(l.permsArray.includes("attendances_delete")||l.permsArray.includes("admin"))?(d(),h($,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:t(()=>[a(w)]),default:t(()=>[i(" "+u(e.$t("common.delete")),1)]),_:1},8,["onClick"])):c("",!0)]),_:1})]),_:1}),a(_,{xs:24,sm:24,md:12,lg:14,xl:14},{default:t(()=>[a(m,{gutter:[16,16],justify:"end"},{default:t(()=>[l.permsArray.includes("attendances_view")||l.permsArray.includes("admin")?(d(),h(_,{key:0,xs:24,sm:24,md:12,lg:12,xl:8},{default:t(()=>[a(y,{value:l.extraFilters.user_id,"onUpdate:value":n[0]||(n[0]=s=>l.extraFilters.user_id=s),onChange:l.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("attendance.user")]),allowClear:!0},{default:t(()=>[(d(!0),g(b,null,V(l.users,s=>(d(),h(O,{key:s.xid,value:s.xid,title:s.name},{default:t(()=>[i(u(s.name),1)]),_:2},1032,["value","title"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):c("",!0),a(_,{xs:24,sm:24,md:12,lg:12,xl:8},{default:t(()=>[a(I,{value:l.extraFilters.date,"onUpdate:value":n[1]||(n[1]=s=>l.extraFilters.date=s),valueFormat:"YYYY-MM-DD",style:{width:"100%"},onChange:l.setUrlData},null,8,["value","onChange"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(te,null,{default:t(()=>[a(Y,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,formData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","formData","data","pageTitle","successMessage"]),a(m,null,{default:t(()=>[a(_,{span:24},{default:t(()=>[a(o,{activeKey:l.extraFilters.status,"onUpdate:activeKey":n[2]||(n[2]=s=>l.extraFilters.status=s),onChange:l.setUrlData},{default:t(()=>[a(P,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),a(P,{key:"on_leave",tab:`${e.$t("attendance.on_leave")}`},null,8,["tab"]),a(P,{key:"present",tab:`${e.$t("attendance.present")}`},null,8,["tab"]),a(P,{key:"half_day",tab:`${e.$t("attendance.half_day")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1}),a(m,null,{default:t(()=>[a(_,{span:24},{default:t(()=>[q("div",He,[a(ae,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:s=>({disabled:!1,name:s.xid})},columns:l.columns,"row-key":s=>s.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},{bodyCell:t(({column:s,record:v})=>[s.dataIndex==="date"?(d(),g(b,{key:0},[i(u(l.formatDate(v.date)),1)],64)):c("",!0),s.dataIndex==="clock_in_date_time"?(d(),g(b,{key:1},[i(u(l.formatTime(v.clock_in_date_time)),1)],64)):c("",!0),s.dataIndex==="clock_out_date_time"?(d(),g(b,{key:2},[i(u(l.formatTime(v.clock_out_date_time)),1)],64)):c("",!0),s.dataIndex==="user_id"?(d(),g(b,{key:3},[i(u(v.user.name),1)],64)):c("",!0),s.dataIndex==="total_duration"?(d(),g(b,{key:4},[i(u(l.formatMinutes(v.total_duration)),1)],64)):c("",!0),s.dataIndex==="is_late"?(d(),g(b,{key:5},[v.is_late==0?(d(),h(R,{key:0,color:"success"},{default:t(()=>[i(u(e.$t("common.no")),1)]),_:1})):(d(),h(R,{key:1,color:"error"},{default:t(()=>[i(u(e.$t("common.yes")),1)]),_:1}))],64)):c("",!0),s.dataIndex==="is_half_day"?(d(),g(b,{key:6},[i(u(v.is_half_day==0?e.$t("common.no"):e.$t("common.yes")),1)],64)):c("",!0),s.dataIndex==="clock_in_ip_address"?(d(),g(b,{key:7},[i(u(v.clock_in_ip_address?v.clock_in_ip_address:"-"),1)],64)):c("",!0),s.dataIndex==="clock_out_ip_address"?(d(),g(b,{key:8},[i(u(v.clock_out_ip_address?v.clock_out_ip_address:"-"),1)],64)):c("",!0),s.dataIndex==="status"?(d(),h(x,{key:9,status:l.getAttendanceStatus(v)},null,8,["status"])):c("",!0),s.dataIndex==="action"?(d(),g(b,{key:10},[(l.permsArray.includes("attendances_edit")||l.permsArray.includes("admin"))&&l.getAttendanceStatus(v)!="on_leave"?(d(),h($,{key:0,type:"primary",onClick:le=>e.editItem(v),style:{"margin-left":"4px"}},{icon:t(()=>[a(ee)]),_:2},1032,["onClick"])):c("",!0),l.permsArray.includes("attendances_delete")||l.permsArray.includes("admin")?(d(),h($,{key:1,type:"primary",onClick:le=>e.showDeleteConfirm(v.xid),style:{"margin-left":"4px"}},{icon:t(()=>[a(w)]),_:2},1032,["onClick"])):c("",!0)],64)):c("",!0)]),_:1},8,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)}const fa=L(Re,[["render",Le]]);export{fa as default};

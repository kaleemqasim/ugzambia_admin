import{_ as le,d as ie,r as i,o as s,i as m,w as t,a as n,X as ue,aw as de,R as me,az as ce,aA as pe,at as _e,aT as ye,Y as fe,f as _,b as ge,z as ve,E as be,a6 as se,V as he,c as y,G as g,ax as q,l as u,t as f,k as c,M as te,j as Ce,ab as ke,ay as we,aB as Te,aC as De,B as Se,a0 as Ue,q as Ae,aD as Ee,aE as Oe,aF as Ke,h as Ve,an as Be,ao as Ie,ar as Me,bk as Pe,aL as Fe,aM as Re,H as Le,aN as Ne,J as ze,aG as He}from"./app-DNGk_6GD.js";import{c as We}from"./crud-BEffIfKw.js";import{A as je,f as qe}from"./fields-rqCdd5xM.js";import{U as Ge}from"./UserInfo-CBdPfgZa.js";import{S as Ye}from"./StateWidget-Cz3aoZTi.js";import{A as Je}from"./AdminPageHeader-DXDBHvzw.js";import{T as Xe,U as Qe,a as Ze}from"./View-DMR8tLCD.js";import{I as $e}from"./Import-DC9xAofc.js";import{a as xe}from"./apiAdmin-ql1wx3BI.js";import{A as ea,a as aa}from"./ArrowUpOutlined-D31XZI46.js";import{S as na}from"./SaveOutlined-BLIX12Rs.js";import{C as ta}from"./CloudDownloadOutlined-BaZxtSmP.js";import"./datatable-DhkIWLHB.js";import"./filter-DRkyOZCd.js";import"./Upload-DdN-v99I.js";import"./AddButton-B-4X2TUS.js";import"./AddEdit-CfKHYT0J.js";import"./SettingOutlined-CMs8CoTt.js";import"./AddButton-BR0SWbXb.js";import"./AddEdit-CoWHiYUh.js";import"./index-DJ6nEruo.js";import"./UploadFile-CNemkptJ.js";const oa=ie({props:["visible","user"],components:{Transactions:Xe},setup(e,{emit:r}){const{loading:w,rules:a}=xe();return{loading:w,rules:a,onClose:()=>{r("closed")}}}});function sa(e,r,w,a,z,G){const I=i("Transactions"),M=ue;return s(),m(M,{open:e.visible,centered:!0,title:e.$t("payments.transactions"),onCancel:e.onClose,width:"40%",footer:!1},{default:t(()=>[n(I,{user_id:e.user.xid,result_type:e.user.user_type=="staff_members"?"staff_member":"customer_supplier"},null,8,["user_id","result_type"])]),_:1},8,["open","title","onCancel"])}const la=le(oa,[["render",sa]]),ra={components:{EyeOutlined:de,PlusOutlined:me,EditOutlined:ce,DeleteOutlined:pe,ArrowUpOutlined:ea,ArrowDownOutlined:aa,AddEdit:je,UserInfo:Ge,StateWidget:Ye,AdminPageHeader:Je,UserBalance:Qe,UserView:Ze,ImportUsers:$e,UserTransaction:la,SyncOutlined:_e,SaveOutlined:na,LoadingOutlined:ye,CloudDownloadOutlined:ta},setup(){const{t:e}=fe(),r=_(!1),w=_(!1),a=_(0),{statusColors:z,userStatus:G,permsArray:I,formatDateTime:M,user:P,selectedWarehouse:Y,formatAmountCurrency:J}=ge(),{supplierInitData:F,customerInitData:H,staffMemberInitData:b,columns:X,supplierCustomerColumns:R,filterableColumns:L}=qe(),l=We(),k=ve(),h=_(k.meta.menuKey),Q="?fields=id,district,ministry,province,nrc_no,man_no,employee,xid,user_type,name,email,profile_image,profile_image_url,is_walkin_customer,phone,address,shipping_address,status,tax_number,created_at,details{opening_balance,opening_balance_type,credit_period,credit_limit,due_amount,warehouse_id,x_warehouse_id},details:warehouse{id,xid,name},role_id,role{id,xid,name,display_name},warehouse_id,x_warehouse_id,warehouse{xid,name},userWarehouses{user_id,x_user_id,warehouse_id,x_warehouse_id}",T=_(void 0),D=_("all"),S=_("all"),E=_([]),C=_(""),U=_(""),O=_(""),K=_(!1),W=_(""),Z=d=>{K.value=!0,W.value=d},$=()=>{K.value=!1},x=async()=>{r.value=!0;const d=new Date,p=d.getFullYear(),ee=d.getMonth()+1,ae=`${p}${ee.toString().padStart(2,"0")}`;try{axiosAdmin.get(`period-api-data-import-session/${ae}`).then(ne=>{q.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully fetched in session"}),r.value=!1})}catch{q.success({placement:"topRight",message:e("common.error"),description:"Something went wrong"}),r.value=!1}},V=async()=>{w.value=!0;try{axiosAdmin.get("process-session-import-data").then(d=>{q.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully saved in database"}),w.value=!1})}catch{q.success({placement:"topRight",message:e("common.error"),description:"Please fetch employee data first"}),w.value=!1}};be(()=>{B(),l.table.filterableColumns=L,N()});const N=()=>{h.value=="suppliers"?(l.initData.value={...F},l.formData.value={...F},l.langKey.value="supplier",E.value=R,C.value=window.config.supplier_sample_file,U.value=e("supplier.import_suppliers"),O.value="suppliers/import"):h.value=="customers"?(l.initData.value={...H},l.formData.value={...H},l.langKey.value="customer",E.value=R,C.value=window.config.customer_sample_file,U.value=e("customer.import_customers"),O.value="customers/import"):(l.initData.value={...b},l.formData.value={...b},l.langKey.value="staff_member",E.value=X,C.value=window.config.staff_member_sample_file,U.value=e("staff_member.import_staff_members"),O.value="users/import"),l.restFormData()},B=()=>{l.crudUrl.value=h.value;var d="",p={};T.value!=null&&T.value!="all"&&(d+=`status eq "${T.value}"`),S.value!=null&&S.value!="all"&&h.value!="users"&&(p.search_due_type=S.value),l.tableUrl.value={url:`${h.value}${Q}`,filterString:d,extraFilters:p},l.fetch({page:1})};se(()=>k.meta.menuKey,(d,p)=>{(k.meta.menuKey=="users"||k.meta.menuKey=="customers"||k.meta.menuKey=="suppliers")&&(h.value=k.meta.menuKey,T.value=void 0,l.table.searchColumn=void 0,l.table.searchString="",S.value="all",B(),N())}),se(Y,(d,p)=>{B()});const j=he(()=>{let d=0;return l.table.data.forEach(p=>{p&&p.details&&p.details.due_amount&&(d+=p.details.due_amount)}),{totalOpeningBalance:d}});return{statusColors:z,userStatus:G,filterableColumns:L,userType:h,tableColumns:E,searchStatus:T,setUrlData:B,searchDueType:S,activeTabKey:D,...l,permsArray:I,transactionVisible:K,formatDateTime:M,user:P,formatAmountCurrency:J,sampleFileUrl:C,importPageTitle:U,importUrl:O,totals:j,onCloseTransactions:$,openTransactions:Z,modelData:W,syncEmployees:x,updateEmployees:V,isSyncing:r,isUpdating:w,totalMembers:a}}},ia={class:"table-responsive"},ua={key:0};function da(e,r,w,a,z,G){const I=we,M=i("router-link"),P=Te,Y=De,J=i("AdminPageHeader"),F=i("LoadingOutlined"),H=i("SyncOutlined"),b=Se,X=i("CloudDownloadOutlined"),R=Ue,L=i("DeleteOutlined"),l=Ae,k=He,h=Ee,Q=Oe,T=Ke,D=Ve,S=i("admin-page-filters"),E=i("AddEdit"),C=Be,U=Ie,O=i("user-info"),K=Me,W=Pe,Z=i("UserBalance"),$=i("EyeOutlined"),x=i("EditOutlined"),V=Fe,N=Re,B=i("ArrowUpOutlined"),j=Le,d=i("ArrowDownOutlined"),p=Ne,ee=ze,ae=i("UserView"),ne=i("UserTransaction"),re=i("admin-page-table-content");return s(),y(g,null,[n(J,null,{header:t(()=>[n(I,{title:e.$t(`menu.${e.langKey}s`),class:"p-0"},null,8,["title"])]),breadcrumb:t(()=>[n(Y,{separator:"-",style:{"font-size":"12px"}},{default:t(()=>[n(P,null,{default:t(()=>[n(M,{to:{name:"admin.dashboard.index"}},{default:t(()=>[u(f(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),n(P,null,{default:t(()=>[u(f(e.$t("menu.parties")),1)]),_:1}),n(P,null,{default:t(()=>[u(f(e.$t(`menu.${e.langKey}s`)),1)]),_:1})]),_:1})]),_:1}),n(S,null,{default:t(()=>[n(D,{gutter:[16,16]},{default:t(()=>[n(l,{xs:24,sm:24,md:12,lg:10,xl:10},{default:t(()=>[n(R,null,{default:t(()=>[a.permsArray.includes(`${a.userType}_create`)||a.permsArray.includes("admin")?(s(),m(R,{key:0},{default:t(()=>[n(b,{type:"primary",onClick:a.syncEmployees,loading:a.isSyncing},{default:t(()=>[a.isSyncing?(s(),y(g,{key:0},[n(F),u(" Syncing ")],64)):(s(),y(g,{key:1},[n(H),u(" Sync Employees ")],64))]),_:1},8,["onClick","loading"]),n(b,{type:"primary",onClick:a.updateEmployees,loading:e.isSaving},{default:t(()=>[a.isUpdating?(s(),y(g,{key:0},[n(F),u(" Updating ")],64)):(s(),y(g,{key:1},[n(X),u(" Update Employees ")],64))]),_:1},8,["onClick","loading"]),n(b,{type:"primary"},{default:t(()=>[u(f(a.totalMembers)+" Members ",1)]),_:1})]),_:1})):c("",!0),e.table.selectedRowKeys.length>0&&(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))?(s(),m(b,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:t(()=>[n(L)]),default:t(()=>[u(" "+f(e.$t("common.delete")),1)]),_:1},8,["onClick"])):c("",!0)]),_:1})]),_:1}),n(l,{xs:24,sm:24,md:12,lg:14,xl:14},{default:t(()=>[n(D,{gutter:[16,16],justify:"end"},{default:t(()=>[n(l,{xs:24,sm:24,md:12,lg:8,xl:8},{default:t(()=>[n(T,{compact:""},{default:t(()=>[n(h,{style:{width:"25%"},value:e.table.searchColumn,"onUpdate:value":r[0]||(r[0]=o=>e.table.searchColumn=o),placeholder:e.$t("common.select_default_text",[""])},{default:t(()=>[(s(!0),y(g,null,te(a.filterableColumns,o=>(s(),m(k,{key:o.key},{default:t(()=>[u(f(o.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),n(Q,{style:{width:"75%"},value:e.table.searchString,"onUpdate:value":r[1]||(r[1]=o=>e.table.searchString=o),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,loading:e.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1}),a.userType&&a.userType!="users"?(s(),m(l,{key:0,xs:24,sm:24,md:12,lg:6,xl:6},{default:t(()=>[n(h,{value:a.searchStatus,"onUpdate:value":r[2]||(r[2]=o=>a.searchStatus=o),onChange:a.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("user.status")]),allowClear:!0,optionFilterProp:"label"},{default:t(()=>[(s(!0),y(g,null,te(a.userStatus,o=>(s(),m(k,{key:o.key,value:o.key,label:o.value},{default:t(()=>[u(f(o.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):c("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n(re,null,{default:t(()=>[n(E,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,addEditData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","addEditData","data","pageTitle","successMessage"]),a.userType&&a.userType=="users"?(s(),m(D,{key:0},{default:t(()=>[n(l,{span:24},{default:t(()=>[n(U,{activeKey:a.searchStatus,"onUpdate:activeKey":r[3]||(r[3]=o=>a.searchStatus=o),onChange:a.setUrlData},{default:t(()=>[n(C,{key:"all",tab:`${e.$t("common.all")} ${e.$t("menu.users")}`},null,8,["tab"]),(s(!0),y(g,null,te(a.userStatus,o=>(s(),m(C,{key:o.key,tab:`${o.value} ${e.$t("menu.users")}`},null,8,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):c("",!0),a.userType&&a.userType!="users"?(s(),m(D,{key:1},{default:t(()=>[n(l,{span:24},{default:t(()=>[n(U,{activeKey:a.searchDueType,"onUpdate:activeKey":r[4]||(r[4]=o=>a.searchDueType=o),onChange:a.setUrlData},{default:t(()=>[n(C,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),n(C,{key:"receive",tab:`${e.$t("user.to_receive")}`},null,8,["tab"]),n(C,{key:"pay",tab:`${e.$t("user.to_pay")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):c("",!0),n(D,{gutter:[15,15]},{default:t(()=>[n(l,{span:24},{default:t(()=>[Ce("div",ia,[n(ee,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:o=>({disabled:!!(a.user.xid==o.xid||o.is_walkin_customer),name:o.xid})},columns:a.tableColumns,"row-key":o=>o.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},ke({bodyCell:t(({column:o,text:oe,record:v})=>[o.dataIndex==="name"?(s(),m(K,{key:0,type:"primary",onClick:A=>e.viewItem(v)},{default:t(()=>[n(O,{user:v},null,8,["user"])]),_:2},1032,["onClick"])):c("",!0),o.dataIndex==="status"?(s(),m(W,{key:1,color:a.statusColors[oe]},{default:t(()=>[u(f(e.$t(`common.${oe}`)),1)]),_:2},1032,["color"])):c("",!0),o.dataIndex==="district"?(s(),y(g,{key:2},[u(f(v.district),1)],64)):c("",!0),o.dataIndex==="created_at"?(s(),y(g,{key:3},[u(f(a.formatDateTime(v.created_at)),1)],64)):c("",!0),o.dataIndex==="balance"?(s(),y(g,{key:4},[a.userType&&a.userType!="users"?(s(),m(K,{key:0,type:"primary",onClick:A=>a.openTransactions(v)},{default:t(()=>{var A;return[n(Z,{amount:(A=v.details)==null?void 0:A.due_amount},null,8,["amount"])]}),_:2},1032,["onClick"])):c("",!0)],64)):c("",!0),o.dataIndex==="action"?(s(),y(g,{key:5},[n(b,{type:"primary",onClick:A=>e.viewItem(v),style:{"margin-left":"4px"}},{icon:t(()=>[n($)]),_:2},1032,["onClick"]),a.permsArray.includes(`${a.userType}_edit`)||a.permsArray.includes("admin")?(s(),m(b,{key:0,type:"primary",onClick:A=>e.editItem(v),style:{"margin-left":"4px"}},{icon:t(()=>[n(x)]),_:2},1032,["onClick"])):c("",!0),(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))&&a.user.xid!=v.xid&&!v.is_walkin_customer?(s(),m(b,{key:1,type:"primary",onClick:A=>e.showDeleteConfirm(v.xid),style:{"margin-left":"4px"}},{icon:t(()=>[n(L)]),_:2},1032,["onClick"])):c("",!0)],64)):c("",!0)]),_:2},[a.userType&&a.userType!="users"?{name:"summary",fn:t(()=>[n(p,null,{default:t(()=>[n(V,{"col-span":1}),n(V,{"col-span":2}),n(V,{"col-span":1},{default:t(()=>[n(N,{strong:""},{default:t(()=>[u(f(e.$t("common.total")),1)]),_:1})]),_:1}),n(V,{"col-span":1},{default:t(()=>[n(N,{strong:""},{default:t(()=>[a.totals.totalOpeningBalance<0?(s(),m(j,{key:0},{default:t(()=>[n(B,{style:{color:"red"}}),u(" "+f(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1})):(s(),m(j,{key:1},{default:t(()=>[a.totals.totalOpeningBalance>0?(s(),y("span",ua,[n(d,{style:{color:"green"}})])):c("",!0),u(" "+f(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),n(ae,{user:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["user","visible","onClosed"]),n(ne,{user:a.modelData,visible:a.transactionVisible,onClosed:a.onCloseTransactions},null,8,["user","visible","onClosed"])]),_:1})],64)}const Ba=le(ra,[["render",da]]);export{Ba as default};

import{_ as le,d as de,r as f,o as s,i as u,w as n,a as o,X as me,aw as ce,R as pe,az as _e,aA as ye,at as fe,aT as ge,Y as ve,f as y,z as oe,b as he,E as be,a6 as ne,V as se,c as g,G as v,ax as x,l as p,t as _,M as G,k as i,j as Ce,ay as ke,aB as we,aC as Te,aD as De,B as Se,a0 as Ee,q as Ue,aE as Ae,aF as Oe,h as Ie,an as Ke,ao as Ve,ar as Me,bk as Pe,J as Be,aG as Fe}from"./app-DEGc35fG.js";import{c as Re}from"./crud-_VG7jHeH.js";import{A as Ne,f as ze}from"./fields-blzPxU4j.js";import{U as He}from"./UserInfo-xr3pkOq7.js";import{S as Le}from"./StateWidget-CrE_fa0U.js";import{A as We}from"./AdminPageHeader-xgYaoUxS.js";import{T as Ye,U as je,a as qe}from"./View-C8Mswyl5.js";import{I as xe}from"./Import-Cg45oLSC.js";import{a as Ge}from"./apiAdmin-ChTOV1AZ.js";import{A as Je,a as Xe}from"./ArrowUpOutlined-CkhIDbOF.js";import{S as $e}from"./SaveOutlined-CN8q81Od.js";import{C as Qe}from"./CloudDownloadOutlined-DbfQ9kjz.js";import"./datatable-olxzEWY8.js";import"./filter-C51YitDG.js";import"./Upload-DnSHELiI.js";import"./AddButton-CMTSJmcr.js";import"./AddEdit-D0LZu0TR.js";import"./SettingOutlined-CvJdFKOR.js";import"./AddButton-rMERWMh9.js";import"./AddEdit-BSwfNgT7.js";import"./index-CJVjyWpv.js";import"./UploadFile--_m4qN3L.js";const Ze=de({props:["visible","user"],components:{Transactions:Ye},setup(e,{emit:d}){const{loading:D,rules:a}=Ge();return{loading:D,rules:a,onClose:()=>{d("closed")}}}});function ea(e,d,D,a,w,K){const V=f("Transactions"),M=me;return s(),u(M,{open:e.visible,centered:!0,title:e.$t("payments.transactions"),onCancel:e.onClose,width:"40%",footer:!1},{default:n(()=>[o(V,{user_id:e.user.xid,result_type:e.user.user_type=="staff_members"?"staff_member":"customer_supplier"},null,8,["user_id","result_type"])]),_:1},8,["open","title","onCancel"])}const aa=le(Ze,[["render",ea]]),ta={components:{EyeOutlined:ce,PlusOutlined:pe,EditOutlined:_e,DeleteOutlined:ye,ArrowUpOutlined:Je,ArrowDownOutlined:Xe,AddEdit:Ne,UserInfo:He,StateWidget:Le,AdminPageHeader:We,UserBalance:je,UserView:qe,ImportUsers:xe,UserTransaction:aa,SyncOutlined:fe,SaveOutlined:$e,LoadingOutlined:ge,CloudDownloadOutlined:Qe},setup(){const{t:e}=ve(),d=y(!1),D=y(!1),a=y(0),w=y(!1),K=y(null);oe();const{statusColors:V,userStatus:M,permsArray:P,formatDateTime:J,user:X,selectedWarehouse:B,formatAmountCurrency:F}=he(),{supplierInitData:Y,customerInitData:h,staffMemberInitData:j,columns:$,supplierCustomerColumns:R,filterableColumns:N}=ze(),l=Re(),C=oe(),k=y(C.meta.menuKey),S="?fields=id,district,ministry,province,total,period,nrc_no,man_no,employee_no,xid,user_type,name,email,profile_image,profile_image_url,is_walkin_customer,phone,address,shipping_address,status,tax_number,created_at,details{opening_balance,opening_balance_type,credit_period,credit_limit,due_amount,warehouse_id,x_warehouse_id},details:warehouse{id,xid,name},role_id,role{id,xid,name,display_name},warehouse_id,x_warehouse_id,warehouse{xid,name},userWarehouses{user_id,x_user_id,warehouse_id,x_warehouse_id}",E=y(void 0),Q=y("all"),b=y("all"),U=y([]),A=y(""),O=y(""),I=y(""),z=y(!1),q=y(""),Z=r=>{z.value=!0,q.value=r},ee=()=>{z.value=!1},ae=async()=>{d.value=!0;let r=K.value;if(!K){const c=new Date,T=c.getFullYear(),W=c.getMonth()+1;r=`${T}${W.toString().padStart(2,"0")}`}try{const c=await axiosAdmin.get(`period-api-data-import-session/${r}`);x.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully fetched in session"})}catch{x.error({placement:"topRight",message:e("common.error"),description:"Something went wrong"})}finally{d.value=!1}},te=async()=>{D.value=!0;try{const r=await axiosAdmin.get("process-session-import-data");x.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully saved in the database"})}catch{x.error({placement:"topRight",message:e("common.error"),description:"No employees found in session"})}finally{D.value=!1}};be(()=>{let r=window.location.href;console.log(r),r.includes("admin/customers")?w.value=!0:w.value=!1,m(),l.table.filterableColumns=N,H(),t()});const t=async()=>{try{axiosAdmin.get("total-member").then(r=>{a.value=r.data.data??0})}catch{console.log("something went wrong")}},H=()=>{k.value=="suppliers"?(l.initData.value={...Y},l.formData.value={...Y},l.langKey.value="supplier",U.value=R,A.value=window.config.supplier_sample_file,O.value=e("supplier.import_suppliers"),I.value="suppliers/import"):k.value=="customers"?(l.initData.value={...h},l.formData.value={...h},l.langKey.value="customer",U.value=R,A.value=window.config.customer_sample_file,O.value=e("customer.import_customers"),I.value="customers/import"):(l.initData.value={...j},l.formData.value={...j},l.langKey.value="staff_member",U.value=$,A.value=window.config.staff_member_sample_file,O.value=e("staff_member.import_staff_members"),I.value="users/import"),l.restFormData()},m=()=>{l.crudUrl.value=k.value;var r="",c={};E.value!=null&&E.value!="all"&&(r+=`status eq "${E.value}"`),b.value!=null&&b.value!="all"&&k.value!="users"&&(c.search_due_type=b.value),l.tableUrl.value={url:`${k.value}${S}`,filterString:r,extraFilters:c},l.fetch({page:1})};ne(()=>C.meta.menuKey,(r,c)=>{(C.meta.menuKey=="users"||C.meta.menuKey=="customers"||C.meta.menuKey=="suppliers")&&(k.value=C.meta.menuKey,E.value=void 0,l.table.searchColumn=void 0,l.table.searchString="",b.value="all",m(),H())}),ne(B,(r,c)=>{m()}),ne(C,(r,c)=>{let T=r.path;console.log({current_url:T}),T.includes("admin/customers")?w.value=!0:w.value=!1});const L=se(()=>{let r=0;return l.table.data.forEach(c=>{c&&c.details&&c.details.due_amount&&(r+=c.details.due_amount)}),{totalOpeningBalance:r}}),re=se(()=>{const r=[],c=new Date;for(let T=0;T<12;T++){const W=new Date(c);W.setMonth(c.getMonth()-T);const ie=W.getFullYear(),ue=(W.getMonth()+1).toString().padStart(2,"0");r.push(`${ie}${ue}`)}return r});return{statusColors:V,userStatus:M,filterableColumns:N,userType:k,tableColumns:U,searchStatus:E,setUrlData:m,searchDueType:b,activeTabKey:Q,...l,permsArray:P,transactionVisible:z,formatDateTime:J,user:X,formatAmountCurrency:F,sampleFileUrl:A,importPageTitle:O,importUrl:I,totals:L,months:re,onCloseTransactions:ee,openTransactions:Z,modelData:q,syncEmployees:ae,updateEmployees:te,isSyncing:d,isUpdating:D,totalMembers:a,employeesPage:w,selectedMonth:K}}},na={class:"table-responsive"};function oa(e,d,D,a,w,K){const V=ke,M=f("router-link"),P=we,J=Te,X=f("AdminPageHeader"),B=Fe,F=De,Y=f("SyncOutlined"),h=Se,j=f("SaveOutlined"),$=f("PlusOutlined"),R=Ee,N=f("DeleteOutlined"),l=Ue,C=Ae,k=Oe,S=Ie,E=f("admin-page-filters"),Q=f("AddEdit"),b=Ke,U=Ve,A=f("user-info"),O=Me,I=Pe,z=f("EyeOutlined"),q=f("EditOutlined"),Z=Be,ee=f("UserView"),ae=f("UserTransaction"),te=f("admin-page-table-content");return s(),g(v,null,[o(X,null,{header:n(()=>[o(V,{title:e.$t(`menu.${e.langKey}s`),class:"p-0"},null,8,["title"])]),breadcrumb:n(()=>[o(J,{separator:"-",style:{"font-size":"12px"}},{default:n(()=>[o(P,null,{default:n(()=>[o(M,{to:{name:"admin.dashboard.index"}},{default:n(()=>[p(_(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),o(P,null,{default:n(()=>[p(_(e.$t("menu.parties")),1)]),_:1}),o(P,null,{default:n(()=>[p(_(e.$t(`menu.${e.langKey}s`)),1)]),_:1})]),_:1})]),_:1}),o(E,null,{default:n(()=>[o(S,{gutter:[16,16]},{default:n(()=>[o(l,{xs:24,sm:24,md:12,lg:10,xl:10},{default:n(()=>[o(R,null,{default:n(()=>[a.permsArray.includes(`${a.userType}_create`)||a.permsArray.includes("admin")?(s(),u(R,{key:0},{default:n(()=>[a.employeesPage?(s(),u(F,{key:0,modelValue:a.selectedMonth,"onUpdate:modelValue":d[0]||(d[0]=t=>a.selectedMonth=t),style:{width:"150px","margin-left":"10px"}},{default:n(()=>[(s(!0),g(v,null,G(a.months,t=>(s(),u(B,{key:t,value:t},{default:n(()=>[p(_(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):i("",!0),a.employeesPage?(s(),u(h,{key:1,type:"primary",onClick:a.syncEmployees,loading:a.isSyncing},{default:n(()=>[a.isSyncing?i("",!0):(s(),u(Y,{key:0})),p(" Sync Employees ")]),_:1},8,["onClick","loading"])):i("",!0),a.employeesPage?(s(),u(h,{key:2,type:"primary",onClick:a.updateEmployees,loading:a.isUpdating},{default:n(()=>[a.isUpdating?i("",!0):(s(),u(j,{key:0})),p(" Update Employees ")]),_:1},8,["onClick","loading"])):i("",!0),a.employeesPage?(s(),u(h,{key:3,type:"primary"},{default:n(()=>[p(_(a.totalMembers)+" Members ",1)]),_:1})):i("",!0),a.employeesPage?i("",!0):(s(),u(h,{key:4,type:"primary",onClick:e.addItem},{default:n(()=>[o($)]),_:1},8,["onClick"]))]),_:1})):i("",!0),e.table.selectedRowKeys.length>0&&(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))?(s(),u(h,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:n(()=>[o(N)]),default:n(()=>[p(" "+_(e.$t("common.delete")),1)]),_:1},8,["onClick"])):i("",!0)]),_:1})]),_:1}),o(l,{xs:24,sm:24,md:12,lg:14,xl:14},{default:n(()=>[o(S,{gutter:[16,16],justify:"end"},{default:n(()=>[o(l,{xs:24,sm:24,md:12,lg:8,xl:8},{default:n(()=>[o(k,{compact:""},{default:n(()=>[o(F,{style:{width:"25%"},value:e.table.searchColumn,"onUpdate:value":d[1]||(d[1]=t=>e.table.searchColumn=t),placeholder:e.$t("common.select_default_text",[""])},{default:n(()=>[(s(!0),g(v,null,G(a.filterableColumns,t=>(s(),u(B,{key:t.key},{default:n(()=>[p(_(t.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),o(C,{style:{width:"75%"},value:e.table.searchString,"onUpdate:value":d[2]||(d[2]=t=>e.table.searchString=t),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,loading:e.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1}),a.userType&&a.userType!="users"?(s(),u(l,{key:0,xs:24,sm:24,md:12,lg:6,xl:6},{default:n(()=>[o(F,{value:a.searchStatus,"onUpdate:value":d[3]||(d[3]=t=>a.searchStatus=t),onChange:a.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("user.status")]),allowClear:!0,optionFilterProp:"label"},{default:n(()=>[(s(!0),g(v,null,G(a.userStatus,t=>(s(),u(B,{key:t.key,value:t.key,label:t.value},{default:n(()=>[p(_(t.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):i("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),o(te,null,{default:n(()=>[o(Q,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,addEditData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","addEditData","data","pageTitle","successMessage"]),a.userType&&a.userType=="users"?(s(),u(S,{key:0},{default:n(()=>[o(l,{span:24},{default:n(()=>[o(U,{activeKey:a.searchStatus,"onUpdate:activeKey":d[4]||(d[4]=t=>a.searchStatus=t),onChange:a.setUrlData},{default:n(()=>[o(b,{key:"all",tab:`${e.$t("common.all")} ${e.$t("menu.users")}`},null,8,["tab"]),(s(!0),g(v,null,G(a.userStatus,t=>(s(),u(b,{key:t.key,tab:`${t.value} ${e.$t("menu.users")}`},null,8,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):i("",!0),a.userType&&a.userType!="users"?(s(),u(S,{key:1},{default:n(()=>[o(l,{span:24},{default:n(()=>[o(U,{activeKey:a.searchDueType,"onUpdate:activeKey":d[5]||(d[5]=t=>a.searchDueType=t),onChange:a.setUrlData},{default:n(()=>[o(b,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),o(b,{key:"receive",tab:`${e.$t("user.to_receive")}`},null,8,["tab"]),o(b,{key:"pay",tab:`${e.$t("user.to_pay")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):i("",!0),o(S,{gutter:[15,15]},{default:n(()=>[o(l,{span:24},{default:n(()=>[Ce("div",na,[o(Z,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:t=>({disabled:!!(a.user.xid==t.xid||t.is_walkin_customer),name:t.xid})},columns:a.tableColumns,"row-key":t=>t.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},{bodyCell:n(({column:t,text:H,record:m})=>[t.dataIndex==="name"?(s(),u(O,{key:0,type:"primary",onClick:L=>e.viewItem(m)},{default:n(()=>[o(A,{user:m},null,8,["user"])]),_:2},1032,["onClick"])):i("",!0),t.dataIndex==="status"?(s(),u(I,{key:1,color:a.statusColors[H]},{default:n(()=>[p(_(e.$t(`common.${H}`)),1)]),_:2},1032,["color"])):i("",!0),t.dataIndex==="ministry"?(s(),g(v,{key:2},[p(_(m.ministry),1)],64)):i("",!0),t.dataIndex==="nrc_no"?(s(),g(v,{key:3},[p(_(m.nrc_no),1)],64)):i("",!0),t.dataIndex==="man_no"?(s(),g(v,{key:4},[p(_(m.man_no),1)],64)):i("",!0),t.dataIndex==="employee_id"?(s(),g(v,{key:5},[p(_(m.employee_id),1)],64)):i("",!0),t.dataIndex==="total"?(s(),g(v,{key:6},[p(_(m.total),1)],64)):i("",!0),t.dataIndex==="period"?(s(),g(v,{key:7},[p(_(m.period),1)],64)):i("",!0),t.dataIndex==="created_at"?(s(),g(v,{key:8},[p(_(a.formatDateTime(m.created_at)),1)],64)):i("",!0),t.dataIndex==="action"?(s(),g(v,{key:9},[o(h,{type:"primary",onClick:L=>e.viewItem(m),style:{"margin-left":"4px"}},{icon:n(()=>[o(z)]),_:2},1032,["onClick"]),a.permsArray.includes(`${a.userType}_edit`)||a.permsArray.includes("admin")?(s(),u(h,{key:0,type:"primary",onClick:L=>e.editItem(m),style:{"margin-left":"4px"}},{icon:n(()=>[o(q)]),_:2},1032,["onClick"])):i("",!0),(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))&&a.user.xid!=m.xid&&!m.is_walkin_customer?(s(),u(h,{key:1,type:"primary",onClick:L=>e.showDeleteConfirm(m.xid),style:{"margin-left":"4px"}},{icon:n(()=>[o(N)]),_:2},1032,["onClick"])):i("",!0)],64)):i("",!0)]),_:1},8,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),o(ee,{user:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["user","visible","onClosed"]),o(ae,{user:a.modelData,visible:a.transactionVisible,onClosed:a.onCloseTransactions},null,8,["user","visible","onClosed"])]),_:1})],64)}const Ea=le(ta,[["render",oa]]);export{Ea as default};

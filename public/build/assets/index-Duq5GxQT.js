import{_ as ne,d as le,r as _,o as s,i as u,w as t,a as n,X as re,aw as ie,R as ue,az as de,aA as me,at as ce,aT as pe,Y as _e,f as y,z as te,b as ye,E as fe,a6 as ee,V as ge,c as g,G as v,ax as L,l as m,t as p,k as r,M as ae,j as ve,ay as be,aB as he,aC as Ce,B as ke,a0 as we,q as Te,aD as De,aE as Se,aF as Ee,h as Ue,an as Ae,ao as Oe,ar as Ie,bk as Ke,J as Ve,aG as Pe}from"./app-BAsX81lw.js";import{c as Me}from"./crud-oEXq8XNn.js";import{A as Be,f as Fe}from"./fields-D7cBwt82.js";import{U as Re}from"./UserInfo-CTqNKeuC.js";import{S as Ne}from"./StateWidget-BZz4mg9N.js";import{A as ze}from"./AdminPageHeader-DcKmZbdv.js";import{T as He,U as Le,a as We}from"./View-D602h1_8.js";import{I as $e}from"./Import-DYFjy4jP.js";import{a as je}from"./apiAdmin-9cDr0xk8.js";import{A as qe,a as Ge}from"./ArrowUpOutlined-aqF5N7ka.js";import{S as Ye}from"./SaveOutlined-C_3n1iuF.js";import{C as Je}from"./CloudDownloadOutlined-_mehtXho.js";import"./datatable-pkEjtTTj.js";import"./filter-BhsIG-i2.js";import"./Upload-o7baCr0v.js";import"./AddButton-DTHWDQs-.js";import"./AddEdit-CYU_mQBH.js";import"./SettingOutlined-BfKQObfw.js";import"./AddButton-Dvx-lb23.js";import"./AddEdit-CwnWuvVq.js";import"./index-LnAgdau1.js";import"./UploadFile-DdfV8CuH.js";const Xe=le({props:["visible","user"],components:{Transactions:He},setup(e,{emit:d}){const{loading:S,rules:a}=je();return{loading:S,rules:a,onClose:()=>{d("closed")}}}});function xe(e,d,S,a,D,W){const K=_("Transactions"),V=re;return s(),u(V,{open:e.visible,centered:!0,title:e.$t("payments.transactions"),onCancel:e.onClose,width:"40%",footer:!1},{default:t(()=>[n(K,{user_id:e.user.xid,result_type:e.user.user_type=="staff_members"?"staff_member":"customer_supplier"},null,8,["user_id","result_type"])]),_:1},8,["open","title","onCancel"])}const Qe=ne(Xe,[["render",xe]]),Ze={components:{EyeOutlined:ie,PlusOutlined:ue,EditOutlined:de,DeleteOutlined:me,ArrowUpOutlined:qe,ArrowDownOutlined:Ge,AddEdit:Be,UserInfo:Re,StateWidget:Ne,AdminPageHeader:ze,UserBalance:Le,UserView:We,ImportUsers:$e,UserTransaction:Qe,SyncOutlined:ce,SaveOutlined:Ye,LoadingOutlined:pe,CloudDownloadOutlined:Je},setup(){const{t:e}=_e(),d=y(!1),S=y(!1),a=y(0),D=y(!1);te();const{statusColors:W,userStatus:K,permsArray:V,formatDateTime:P,user:$,selectedWarehouse:j,formatAmountCurrency:q}=ye(),{supplierInitData:b,customerInitData:F,staffMemberInitData:R,columns:N,supplierCustomerColumns:M,filterableColumns:C}=Fe(),i=Me(),k=te(),T=y(k.meta.menuKey),G="?fields=id,district,ministry,province,total,period,nrc_no,man_no,employee_no,xid,user_type,name,email,profile_image,profile_image_url,is_walkin_customer,phone,address,shipping_address,status,tax_number,created_at,details{opening_balance,opening_balance_type,credit_period,credit_limit,due_amount,warehouse_id,x_warehouse_id},details:warehouse{id,xid,name},role_id,role{id,xid,name,display_name},warehouse_id,x_warehouse_id,warehouse{xid,name},userWarehouses{user_id,x_user_id,warehouse_id,x_warehouse_id}",h=y(void 0),Y=y("all"),E=y("all"),w=y([]),U=y(""),O=y(""),I=y(""),B=y(!1),z=y(""),J=l=>{B.value=!0,z.value=l},X=()=>{B.value=!1},x=async()=>{d.value=!0;const l=new Date,f=l.getFullYear(),H=l.getMonth()+1,oe=`${f}${H.toString().padStart(2,"0")}`;try{const se=await axiosAdmin.get(`period-api-data-import-session/${oe}`);L.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully fetched in session"})}catch{L.error({placement:"topRight",message:e("common.error"),description:"Something went wrong"})}finally{d.value=!1}},Q=async()=>{S.value=!0;try{const l=await axiosAdmin.get("process-session-import-data");L.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully saved in the database"})}catch{L.error({placement:"topRight",message:e("common.error"),description:"No employees found in session"})}finally{S.value=!1}};fe(()=>{let l=window.location.href;console.log(l),l.includes("admin/customers")?D.value=!0:D.value=!1,A(),i.table.filterableColumns=C,o(),Z()});const Z=async()=>{try{axiosAdmin.get("total-member").then(l=>{a.value=l.data.data??0})}catch{console.log("something went wrong")}},o=()=>{T.value=="suppliers"?(i.initData.value={...b},i.formData.value={...b},i.langKey.value="supplier",w.value=M,U.value=window.config.supplier_sample_file,O.value=e("supplier.import_suppliers"),I.value="suppliers/import"):T.value=="customers"?(i.initData.value={...F},i.formData.value={...F},i.langKey.value="customer",w.value=M,U.value=window.config.customer_sample_file,O.value=e("customer.import_customers"),I.value="customers/import"):(i.initData.value={...R},i.formData.value={...R},i.langKey.value="staff_member",w.value=N,U.value=window.config.staff_member_sample_file,O.value=e("staff_member.import_staff_members"),I.value="users/import"),i.restFormData()},A=()=>{i.crudUrl.value=T.value;var l="",f={};h.value!=null&&h.value!="all"&&(l+=`status eq "${h.value}"`),E.value!=null&&E.value!="all"&&T.value!="users"&&(f.search_due_type=E.value),i.tableUrl.value={url:`${T.value}${G}`,filterString:l,extraFilters:f},i.fetch({page:1})};ee(()=>k.meta.menuKey,(l,f)=>{(k.meta.menuKey=="users"||k.meta.menuKey=="customers"||k.meta.menuKey=="suppliers")&&(T.value=k.meta.menuKey,h.value=void 0,i.table.searchColumn=void 0,i.table.searchString="",E.value="all",A(),o())}),ee(j,(l,f)=>{A()}),ee(k,(l,f)=>{let H=l.path;console.log({current_url:H}),H.includes("admin/customers")?D.value=!0:D.value=!1});const c=ge(()=>{let l=0;return i.table.data.forEach(f=>{f&&f.details&&f.details.due_amount&&(l+=f.details.due_amount)}),{totalOpeningBalance:l}});return{statusColors:W,userStatus:K,filterableColumns:C,userType:T,tableColumns:w,searchStatus:h,setUrlData:A,searchDueType:E,activeTabKey:Y,...i,permsArray:V,transactionVisible:B,formatDateTime:P,user:$,formatAmountCurrency:q,sampleFileUrl:U,importPageTitle:O,importUrl:I,totals:c,onCloseTransactions:X,openTransactions:J,modelData:z,syncEmployees:x,updateEmployees:Q,isSyncing:d,isUpdating:S,totalMembers:a,employeesPage:D}}},ea={class:"table-responsive"};function aa(e,d,S,a,D,W){const K=be,V=_("router-link"),P=he,$=Ce,j=_("AdminPageHeader"),q=_("SyncOutlined"),b=ke,F=_("SaveOutlined"),R=_("PlusOutlined"),N=we,M=_("DeleteOutlined"),C=Te,i=Pe,k=De,T=Se,G=Ee,h=Ue,Y=_("admin-page-filters"),E=_("AddEdit"),w=Ae,U=Oe,O=_("user-info"),I=Ie,B=Ke,z=_("EyeOutlined"),J=_("EditOutlined"),X=Ve,x=_("UserView"),Q=_("UserTransaction"),Z=_("admin-page-table-content");return s(),g(v,null,[n(j,null,{header:t(()=>[n(K,{title:e.$t(`menu.${e.langKey}s`),class:"p-0"},null,8,["title"])]),breadcrumb:t(()=>[n($,{separator:"-",style:{"font-size":"12px"}},{default:t(()=>[n(P,null,{default:t(()=>[n(V,{to:{name:"admin.dashboard.index"}},{default:t(()=>[m(p(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),n(P,null,{default:t(()=>[m(p(e.$t("menu.parties")),1)]),_:1}),n(P,null,{default:t(()=>[m(p(e.$t(`menu.${e.langKey}s`)),1)]),_:1})]),_:1})]),_:1}),n(Y,null,{default:t(()=>[n(h,{gutter:[16,16]},{default:t(()=>[n(C,{xs:24,sm:24,md:12,lg:10,xl:10},{default:t(()=>[n(N,null,{default:t(()=>[a.permsArray.includes(`${a.userType}_create`)||a.permsArray.includes("admin")?(s(),u(N,{key:0},{default:t(()=>[a.employeesPage?(s(),u(b,{key:0,type:"primary",onClick:a.syncEmployees,loading:a.isSyncing},{default:t(()=>[a.isSyncing?r("",!0):(s(),u(q,{key:0})),m(" Sync Employees ")]),_:1},8,["onClick","loading"])):r("",!0),a.employeesPage?(s(),u(b,{key:1,type:"primary",onClick:a.updateEmployees,loading:a.isUpdating},{default:t(()=>[a.isUpdating?r("",!0):(s(),u(F,{key:0})),m(" Update Employees ")]),_:1},8,["onClick","loading"])):r("",!0),a.employeesPage?(s(),u(b,{key:2,type:"primary"},{default:t(()=>[m(p(a.totalMembers)+" Members ",1)]),_:1})):r("",!0),a.employeesPage?r("",!0):(s(),u(b,{key:3,type:"primary",onClick:e.addItem},{default:t(()=>[n(R)]),_:1},8,["onClick"]))]),_:1})):r("",!0),e.table.selectedRowKeys.length>0&&(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))?(s(),u(b,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:t(()=>[n(M)]),default:t(()=>[m(" "+p(e.$t("common.delete")),1)]),_:1},8,["onClick"])):r("",!0)]),_:1})]),_:1}),n(C,{xs:24,sm:24,md:12,lg:14,xl:14},{default:t(()=>[n(h,{gutter:[16,16],justify:"end"},{default:t(()=>[n(C,{xs:24,sm:24,md:12,lg:8,xl:8},{default:t(()=>[n(G,{compact:""},{default:t(()=>[n(k,{style:{width:"25%"},value:e.table.searchColumn,"onUpdate:value":d[0]||(d[0]=o=>e.table.searchColumn=o),placeholder:e.$t("common.select_default_text",[""])},{default:t(()=>[(s(!0),g(v,null,ae(a.filterableColumns,o=>(s(),u(i,{key:o.key},{default:t(()=>[m(p(o.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),n(T,{style:{width:"75%"},value:e.table.searchString,"onUpdate:value":d[1]||(d[1]=o=>e.table.searchString=o),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,loading:e.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1}),a.userType&&a.userType!="users"?(s(),u(C,{key:0,xs:24,sm:24,md:12,lg:6,xl:6},{default:t(()=>[n(k,{value:a.searchStatus,"onUpdate:value":d[2]||(d[2]=o=>a.searchStatus=o),onChange:a.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("user.status")]),allowClear:!0,optionFilterProp:"label"},{default:t(()=>[(s(!0),g(v,null,ae(a.userStatus,o=>(s(),u(i,{key:o.key,value:o.key,label:o.value},{default:t(()=>[m(p(o.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):r("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n(Z,null,{default:t(()=>[n(E,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,addEditData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","addEditData","data","pageTitle","successMessage"]),a.userType&&a.userType=="users"?(s(),u(h,{key:0},{default:t(()=>[n(C,{span:24},{default:t(()=>[n(U,{activeKey:a.searchStatus,"onUpdate:activeKey":d[3]||(d[3]=o=>a.searchStatus=o),onChange:a.setUrlData},{default:t(()=>[n(w,{key:"all",tab:`${e.$t("common.all")} ${e.$t("menu.users")}`},null,8,["tab"]),(s(!0),g(v,null,ae(a.userStatus,o=>(s(),u(w,{key:o.key,tab:`${o.value} ${e.$t("menu.users")}`},null,8,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):r("",!0),a.userType&&a.userType!="users"?(s(),u(h,{key:1},{default:t(()=>[n(C,{span:24},{default:t(()=>[n(U,{activeKey:a.searchDueType,"onUpdate:activeKey":d[4]||(d[4]=o=>a.searchDueType=o),onChange:a.setUrlData},{default:t(()=>[n(w,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),n(w,{key:"receive",tab:`${e.$t("user.to_receive")}`},null,8,["tab"]),n(w,{key:"pay",tab:`${e.$t("user.to_pay")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):r("",!0),n(h,{gutter:[15,15]},{default:t(()=>[n(C,{span:24},{default:t(()=>[ve("div",ea,[n(X,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:o=>({disabled:!!(a.user.xid==o.xid||o.is_walkin_customer),name:o.xid})},columns:a.tableColumns,"row-key":o=>o.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},{bodyCell:t(({column:o,text:A,record:c})=>[o.dataIndex==="name"?(s(),u(I,{key:0,type:"primary",onClick:l=>e.viewItem(c)},{default:t(()=>[n(O,{user:c},null,8,["user"])]),_:2},1032,["onClick"])):r("",!0),o.dataIndex==="status"?(s(),u(B,{key:1,color:a.statusColors[A]},{default:t(()=>[m(p(e.$t(`common.${A}`)),1)]),_:2},1032,["color"])):r("",!0),o.dataIndex==="ministry"?(s(),g(v,{key:2},[m(p(c.ministry),1)],64)):r("",!0),o.dataIndex==="nrc_no"?(s(),g(v,{key:3},[m(p(c.nrc_no),1)],64)):r("",!0),o.dataIndex==="man_no"?(s(),g(v,{key:4},[m(p(c.man_no),1)],64)):r("",!0),o.dataIndex==="employee_id"?(s(),g(v,{key:5},[m(p(c.employee_id),1)],64)):r("",!0),o.dataIndex==="total"?(s(),g(v,{key:6},[m(p(c.total),1)],64)):r("",!0),o.dataIndex==="period"?(s(),g(v,{key:7},[m(p(c.period),1)],64)):r("",!0),o.dataIndex==="created_at"?(s(),g(v,{key:8},[m(p(a.formatDateTime(c.created_at)),1)],64)):r("",!0),o.dataIndex==="action"?(s(),g(v,{key:9},[n(b,{type:"primary",onClick:l=>e.viewItem(c),style:{"margin-left":"4px"}},{icon:t(()=>[n(z)]),_:2},1032,["onClick"]),a.permsArray.includes(`${a.userType}_edit`)||a.permsArray.includes("admin")?(s(),u(b,{key:0,type:"primary",onClick:l=>e.editItem(c),style:{"margin-left":"4px"}},{icon:t(()=>[n(J)]),_:2},1032,["onClick"])):r("",!0),(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))&&a.user.xid!=c.xid&&!c.is_walkin_customer?(s(),u(b,{key:1,type:"primary",onClick:l=>e.showDeleteConfirm(c.xid),style:{"margin-left":"4px"}},{icon:t(()=>[n(M)]),_:2},1032,["onClick"])):r("",!0)],64)):r("",!0)]),_:1},8,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),n(x,{user:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["user","visible","onClosed"]),n(Q,{user:a.modelData,visible:a.transactionVisible,onClosed:a.onCloseTransactions},null,8,["user","visible","onClosed"])]),_:1})],64)}const Ta=ne(Ze,[["render",aa]]);export{Ta as default};

import{_ as le,d as re,r as m,o as s,i as y,w as t,a as n,X as ie,aw as ue,R as de,az as me,aA as ce,at as pe,aT as _e,Y as ye,f as v,b as fe,z as ge,E as ve,a6 as se,V as be,c as p,G as _,ax as j,l as r,t as u,k as d,M as te,j as he,ab as Ce,ay as ke,aB as we,aC as Te,B as De,a0 as Se,q as Ae,aD as Ue,aE as Ee,aF as Oe,h as Ke,an as Ie,ao as Ve,ar as Be,bk as Me,aL as Pe,aM as Fe,H as Re,aN as Le,J as Ne,aG as ze}from"./app-CXajSIJN.js";import{c as He}from"./crud-CydXdSUh.js";import{A as We,f as je}from"./fields-CCknBX8d.js";import{U as qe}from"./UserInfo-R4lQF8wf.js";import{S as Ge}from"./StateWidget-C4StFKqy.js";import{A as Ye}from"./AdminPageHeader-CLpphX8z.js";import{T as Je,U as Xe,a as $e}from"./View-BifJsNmk.js";import{I as Qe}from"./Import-DDf3kNZu.js";import{a as Ze}from"./apiAdmin-Dhq5SQLb.js";import{A as xe,a as ea}from"./ArrowUpOutlined-BRQKF1E7.js";import{S as aa}from"./SaveOutlined-Ba1zpIZL.js";import{C as na}from"./CloudDownloadOutlined-DTtApPMX.js";import"./datatable-BwALyFLJ.js";import"./filter-Buzvu9Uk.js";import"./Upload-DiifK2mq.js";import"./AddButton-CnXHVpCr.js";import"./AddEdit-BDHvfK3O.js";import"./SettingOutlined-a8sYS9Bt.js";import"./AddButton-BIkLSYbF.js";import"./AddEdit-BFQpbLlj.js";import"./index-CDZHKPbx.js";import"./UploadFile-Dep2tHAy.js";const ta=re({props:["visible","user"],components:{Transactions:Je},setup(e,{emit:i}){const{loading:w,rules:a}=Ze();return{loading:w,rules:a,onClose:()=>{i("closed")}}}});function oa(e,i,w,a,L,q){const I=m("Transactions"),V=ie;return s(),y(V,{open:e.visible,centered:!0,title:e.$t("payments.transactions"),onCancel:e.onClose,width:"40%",footer:!1},{default:t(()=>[n(I,{user_id:e.user.xid,result_type:e.user.user_type=="staff_members"?"staff_member":"customer_supplier"},null,8,["user_id","result_type"])]),_:1},8,["open","title","onCancel"])}const sa=le(ta,[["render",oa]]),la={components:{EyeOutlined:ue,PlusOutlined:de,EditOutlined:me,DeleteOutlined:ce,ArrowUpOutlined:xe,ArrowDownOutlined:ea,AddEdit:We,UserInfo:qe,StateWidget:Ge,AdminPageHeader:Ye,UserBalance:Xe,UserView:$e,ImportUsers:Qe,UserTransaction:sa,SyncOutlined:pe,SaveOutlined:aa,LoadingOutlined:_e,CloudDownloadOutlined:na},setup(){const{t:e}=ye(),i=v(!1),w=v(!1),a=v(0),{statusColors:L,userStatus:q,permsArray:I,formatDateTime:V,user:B,selectedWarehouse:G,formatAmountCurrency:Y}=fe(),{supplierInitData:M,customerInitData:N,staffMemberInitData:b,columns:J,supplierCustomerColumns:P,filterableColumns:F}=je(),l=He(),k=ge(),h=v(k.meta.menuKey),X="?fields=id,district,ministry,province,nrc_no,man_no,employee_no,xid,user_type,name,email,profile_image,profile_image_url,is_walkin_customer,phone,address,shipping_address,status,tax_number,created_at,details{opening_balance,opening_balance_type,credit_period,credit_limit,due_amount,warehouse_id,x_warehouse_id},details:warehouse{id,xid,name},role_id,role{id,xid,name,display_name},warehouse_id,x_warehouse_id,warehouse{xid,name},userWarehouses{user_id,x_user_id,warehouse_id,x_warehouse_id}",T=v(void 0),D=v("all"),S=v("all"),E=v([]),C=v(""),A=v(""),O=v(""),R=v(!1),z=v(""),$=c=>{R.value=!0,z.value=c},Q=()=>{R.value=!1},K=async()=>{i.value=!0;const c=new Date,f=c.getFullYear(),x=c.getMonth()+1,ee=`${f}${x.toString().padStart(2,"0")}`;try{axiosAdmin.get(`period-api-data-import-session/${ee}`).then(ae=>{j.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully fetched in session"}),i.value=!1})}catch{j.success({placement:"topRight",message:e("common.error"),description:"Something went wrong"}),i.value=!1}},H=async()=>{w.value=!0;try{axiosAdmin.get("process-session-import-data").then(c=>{j.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully saved in database"}),w.value=!1})}catch{j.success({placement:"topRight",message:e("common.error"),description:"Please fetch employee data first"}),w.value=!1}};ve(()=>{U(),l.table.filterableColumns=F,W()});const W=()=>{h.value=="suppliers"?(l.initData.value={...M},l.formData.value={...M},l.langKey.value="supplier",E.value=P,C.value=window.config.supplier_sample_file,A.value=e("supplier.import_suppliers"),O.value="suppliers/import"):h.value=="customers"?(l.initData.value={...N},l.formData.value={...N},l.langKey.value="customer",E.value=P,C.value=window.config.customer_sample_file,A.value=e("customer.import_customers"),O.value="customers/import"):(l.initData.value={...b},l.formData.value={...b},l.langKey.value="staff_member",E.value=J,C.value=window.config.staff_member_sample_file,A.value=e("staff_member.import_staff_members"),O.value="users/import"),l.restFormData()},U=()=>{l.crudUrl.value=h.value;var c="",f={};T.value!=null&&T.value!="all"&&(c+=`status eq "${T.value}"`),S.value!=null&&S.value!="all"&&h.value!="users"&&(f.search_due_type=S.value),l.tableUrl.value={url:`${h.value}${X}`,filterString:c,extraFilters:f},l.fetch({page:1})};se(()=>k.meta.menuKey,(c,f)=>{(k.meta.menuKey=="users"||k.meta.menuKey=="customers"||k.meta.menuKey=="suppliers")&&(h.value=k.meta.menuKey,T.value=void 0,l.table.searchColumn=void 0,l.table.searchString="",S.value="all",U(),W())}),se(G,(c,f)=>{U()});const Z=be(()=>{let c=0;return l.table.data.forEach(f=>{f&&f.details&&f.details.due_amount&&(c+=f.details.due_amount)}),{totalOpeningBalance:c}});return{statusColors:L,userStatus:q,filterableColumns:F,userType:h,tableColumns:E,searchStatus:T,setUrlData:U,searchDueType:S,activeTabKey:D,...l,permsArray:I,transactionVisible:R,formatDateTime:V,user:B,formatAmountCurrency:Y,sampleFileUrl:C,importPageTitle:A,importUrl:O,totals:Z,onCloseTransactions:Q,openTransactions:$,modelData:z,syncEmployees:K,updateEmployees:H,isSyncing:i,isUpdating:w,totalMembers:a}}},ra={class:"table-responsive"},ia={key:0};function ua(e,i,w,a,L,q){const I=ke,V=m("router-link"),B=we,G=Te,Y=m("AdminPageHeader"),M=m("LoadingOutlined"),N=m("SyncOutlined"),b=De,J=m("CloudDownloadOutlined"),P=Se,F=m("DeleteOutlined"),l=Ae,k=ze,h=Ue,X=Ee,T=Oe,D=Ke,S=m("admin-page-filters"),E=m("AddEdit"),C=Ie,A=Ve,O=m("user-info"),R=Be,z=Me,$=m("EyeOutlined"),Q=m("EditOutlined"),K=Pe,H=Fe,W=m("ArrowUpOutlined"),U=Re,Z=m("ArrowDownOutlined"),c=Le,f=Ne,x=m("UserView"),ee=m("UserTransaction"),ae=m("admin-page-table-content");return s(),p(_,null,[n(Y,null,{header:t(()=>[n(I,{title:e.$t(`menu.${e.langKey}s`),class:"p-0"},null,8,["title"])]),breadcrumb:t(()=>[n(G,{separator:"-",style:{"font-size":"12px"}},{default:t(()=>[n(B,null,{default:t(()=>[n(V,{to:{name:"admin.dashboard.index"}},{default:t(()=>[r(u(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),n(B,null,{default:t(()=>[r(u(e.$t("menu.parties")),1)]),_:1}),n(B,null,{default:t(()=>[r(u(e.$t(`menu.${e.langKey}s`)),1)]),_:1})]),_:1})]),_:1}),n(S,null,{default:t(()=>[n(D,{gutter:[16,16]},{default:t(()=>[n(l,{xs:24,sm:24,md:12,lg:10,xl:10},{default:t(()=>[n(P,null,{default:t(()=>[a.permsArray.includes(`${a.userType}_create`)||a.permsArray.includes("admin")?(s(),y(P,{key:0},{default:t(()=>[n(b,{type:"primary",onClick:a.syncEmployees,loading:a.isSyncing},{default:t(()=>[a.isSyncing?(s(),p(_,{key:0},[n(M),r(" Syncing ")],64)):(s(),p(_,{key:1},[n(N),r(" Sync Employees ")],64))]),_:1},8,["onClick","loading"]),n(b,{type:"primary",onClick:a.updateEmployees,loading:a.isUpdating},{default:t(()=>[a.isUpdating?(s(),p(_,{key:0},[n(M),r(" Updating ")],64)):(s(),p(_,{key:1},[n(J),r(" Update Employees ")],64))]),_:1},8,["onClick","loading"]),n(b,{type:"primary"},{default:t(()=>[r(u(a.totalMembers)+" Members ",1)]),_:1})]),_:1})):d("",!0),e.table.selectedRowKeys.length>0&&(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))?(s(),y(b,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:t(()=>[n(F)]),default:t(()=>[r(" "+u(e.$t("common.delete")),1)]),_:1},8,["onClick"])):d("",!0)]),_:1})]),_:1}),n(l,{xs:24,sm:24,md:12,lg:14,xl:14},{default:t(()=>[n(D,{gutter:[16,16],justify:"end"},{default:t(()=>[n(l,{xs:24,sm:24,md:12,lg:8,xl:8},{default:t(()=>[n(T,{compact:""},{default:t(()=>[n(h,{style:{width:"25%"},value:e.table.searchColumn,"onUpdate:value":i[0]||(i[0]=o=>e.table.searchColumn=o),placeholder:e.$t("common.select_default_text",[""])},{default:t(()=>[(s(!0),p(_,null,te(a.filterableColumns,o=>(s(),y(k,{key:o.key},{default:t(()=>[r(u(o.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),n(X,{style:{width:"75%"},value:e.table.searchString,"onUpdate:value":i[1]||(i[1]=o=>e.table.searchString=o),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,loading:e.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1}),a.userType&&a.userType!="users"?(s(),y(l,{key:0,xs:24,sm:24,md:12,lg:6,xl:6},{default:t(()=>[n(h,{value:a.searchStatus,"onUpdate:value":i[2]||(i[2]=o=>a.searchStatus=o),onChange:a.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("user.status")]),allowClear:!0,optionFilterProp:"label"},{default:t(()=>[(s(!0),p(_,null,te(a.userStatus,o=>(s(),y(k,{key:o.key,value:o.key,label:o.value},{default:t(()=>[r(u(o.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):d("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n(ae,null,{default:t(()=>[n(E,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,addEditData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","addEditData","data","pageTitle","successMessage"]),a.userType&&a.userType=="users"?(s(),y(D,{key:0},{default:t(()=>[n(l,{span:24},{default:t(()=>[n(A,{activeKey:a.searchStatus,"onUpdate:activeKey":i[3]||(i[3]=o=>a.searchStatus=o),onChange:a.setUrlData},{default:t(()=>[n(C,{key:"all",tab:`${e.$t("common.all")} ${e.$t("menu.users")}`},null,8,["tab"]),(s(!0),p(_,null,te(a.userStatus,o=>(s(),y(C,{key:o.key,tab:`${o.value} ${e.$t("menu.users")}`},null,8,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):d("",!0),a.userType&&a.userType!="users"?(s(),y(D,{key:1},{default:t(()=>[n(l,{span:24},{default:t(()=>[n(A,{activeKey:a.searchDueType,"onUpdate:activeKey":i[4]||(i[4]=o=>a.searchDueType=o),onChange:a.setUrlData},{default:t(()=>[n(C,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),n(C,{key:"receive",tab:`${e.$t("user.to_receive")}`},null,8,["tab"]),n(C,{key:"pay",tab:`${e.$t("user.to_pay")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):d("",!0),n(D,{gutter:[15,15]},{default:t(()=>[n(l,{span:24},{default:t(()=>[he("div",ra,[n(f,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:o=>({disabled:!!(a.user.xid==o.xid||o.is_walkin_customer),name:o.xid})},columns:a.tableColumns,"row-key":o=>o.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},Ce({bodyCell:t(({column:o,text:oe,record:g})=>[o.dataIndex==="name"?(s(),y(R,{key:0,type:"primary",onClick:ne=>e.viewItem(g)},{default:t(()=>[n(O,{user:g},null,8,["user"])]),_:2},1032,["onClick"])):d("",!0),o.dataIndex==="status"?(s(),y(z,{key:1,color:a.statusColors[oe]},{default:t(()=>[r(u(e.$t(`common.${oe}`)),1)]),_:2},1032,["color"])):d("",!0),o.dataIndex==="ministry"?(s(),p(_,{key:2},[r(u(g.ministry),1)],64)):d("",!0),o.dataIndex==="nrc_no"?(s(),p(_,{key:3},[r(u(g.nrc_no),1)],64)):d("",!0),o.dataIndex==="man_no"?(s(),p(_,{key:4},[r(u(g.man_no),1)],64)):d("",!0),o.dataIndex==="employee_id"?(s(),p(_,{key:5},[r(u(g.employee_id),1)],64)):d("",!0),o.dataIndex==="total"?(s(),p(_,{key:6},[r(u(g.total),1)],64)):d("",!0),o.dataIndex==="created_at"?(s(),p(_,{key:7},[r(u(a.formatDateTime(g.created_at)),1)],64)):d("",!0),o.dataIndex==="action"?(s(),p(_,{key:8},[n(b,{type:"primary",onClick:ne=>e.viewItem(g),style:{"margin-left":"4px"}},{icon:t(()=>[n($)]),_:2},1032,["onClick"]),a.permsArray.includes(`${a.userType}_edit`)||a.permsArray.includes("admin")?(s(),y(b,{key:0,type:"primary",onClick:ne=>e.editItem(g),style:{"margin-left":"4px"}},{icon:t(()=>[n(Q)]),_:2},1032,["onClick"])):d("",!0),(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))&&a.user.xid!=g.xid&&!g.is_walkin_customer?(s(),y(b,{key:1,type:"primary",onClick:ne=>e.showDeleteConfirm(g.xid),style:{"margin-left":"4px"}},{icon:t(()=>[n(F)]),_:2},1032,["onClick"])):d("",!0)],64)):d("",!0)]),_:2},[a.userType&&a.userType!="users"?{name:"summary",fn:t(()=>[n(c,null,{default:t(()=>[n(K,{"col-span":1}),n(K,{"col-span":2}),n(K,{"col-span":1},{default:t(()=>[n(H,{strong:""},{default:t(()=>[r(u(e.$t("common.total")),1)]),_:1})]),_:1}),n(K,{"col-span":1},{default:t(()=>[n(H,{strong:""},{default:t(()=>[a.totals.totalOpeningBalance<0?(s(),y(U,{key:0},{default:t(()=>[n(W,{style:{color:"red"}}),r(" "+u(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1})):(s(),y(U,{key:1},{default:t(()=>[a.totals.totalOpeningBalance>0?(s(),p("span",ia,[n(Z,{style:{color:"green"}})])):d("",!0),r(" "+u(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),n(x,{user:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["user","visible","onClosed"]),n(ee,{user:a.modelData,visible:a.transactionVisible,onClosed:a.onCloseTransactions},null,8,["user","visible","onClosed"])]),_:1})],64)}const Ia=le(la,[["render",ua]]);export{Ia as default};

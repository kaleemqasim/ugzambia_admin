import{_ as F,d as ee,b as H,f as I,g as te,a6 as W,r as p,o,i as g,w as n,a,l as m,t as s,c as l,M as K,G as v,aG as L,aD as j,q as z,h as G,ap as ae,e as ne,cg as oe,E as se,V as re,k as y,j as le,ay as ue,aB as ie,aC as de,aE as _e,aF as me,an as pe,ao as ce,aL as ye,aM as fe,H as ve,aN as ge,J as be}from"./app-0t5sL0S-.js";import{c as he}from"./crud-BVwi8JuA.js";import{E as ke,a as we}from"./ExportTable-DSniMgFq.js";import{U as Ce}from"./UserInfo-q80PEcrT.js";import{O as Ae}from"./OrderTable-j1_7_M5N.js";import{D as Te}from"./DateRangePicker-CS5-Sxud.js";import{A as Ue}from"./AdminPageHeader-fM7vcA7n.js";import{U as De}from"./View-DcQKzT5z.js";import{A as Oe,a as Pe}from"./ArrowUpOutlined-BWhVfHkn.js";import"./datatable-Dtwj48pe.js";import"./filter-d8xDbKOw.js";import"./PrinterOutlined-zNvDScMx.js";import"./fields-CugC8knZ.js";import"./fields-x11CV5RX.js";import"./PaymentStatus-B1QP9Hpb.js";import"./OrderDetails-UK28KAC6.js";import"./cart-BW7Tc8IZ.js";import"./apiAdmin-BoX2lu14.js";import"./AddButton-YbmvQ5m2.js";import"./AddEdit-t413XTe2.js";import"./SaveOutlined-CcDAZVAd.js";import"./Invoice-DE0OAliR.js";import"./BarcodeGenerator-BWxxbH3V.js";import"./SendOutlined-BkAeKue4.js";import"./WalletOutlined-BZermp0H.js";import"./ShoppingCartOutlined-DGuqkqj3.js";import"./DollarCircleOutlined-bwA85l3g.js";import"./index-PjfsGoV_.js";const Se=ee({props:["data","orderType","visible"],components:{OrderTable:Ae,DateRangePicker:Te},setup(t,{emit:u}){const{paymentStatus:T,permsArray:e}=H(),C=I("sales"),b=te({payment_status:"all",user_id:void 0,dates:[]}),c=I(null),d=()=>{b.payment_status="all",u("closed")};return W(()=>t.visible,(h,k)=>{h==!0&&(t.data.user_type=="suppliers"?C.value=t.orderType==""?"purchases":"purchase-returns":C.value=t.orderType==""?"sales":"sales-returns",b.user_id=t.data.xid,b.dates=[],c&&c.value&&c.value.resetPicker())}),{onClose:d,paymentStatus:T,filters:b,activeOrderType:C,drawerWidth:window.innerWidth<=991?"90%":"70%",serachDateRangePicker:c,permsArray:e}}});function Ve(t,u,T,e,C,b){const c=L,d=j,h=z,k=p("DateRangePicker"),O=G,U=p("OrderTable"),f=ae;return o(),g(f,{title:t.data.name,width:t.drawerWidth,open:t.visible,"body-style":{paddingBottom:"80px"},maskClosable:!0,destroyOnClose:!0,onClose:t.onClose},{default:n(()=>[a(O,{gutter:[8,8],class:"mb-20"},{default:n(()=>[a(h,{xs:24,sm:24,md:12,lg:5,xl:5},{default:n(()=>[a(d,{value:t.filters.payment_status,"onUpdate:value":u[0]||(u[0]=_=>t.filters.payment_status=_),placeholder:t.$t("common.select_default_text",[t.$t("payments.payment_status")]),allowClear:!0,style:{width:"100%"},optionFilterProp:"title","show-search":""},{default:n(()=>[a(c,{title:t.$t("common.all"),value:"all"},{default:n(()=>[m(s(t.$t("common.all")),1)]),_:1},8,["title"]),(o(!0),l(v,null,K(t.paymentStatus,_=>(o(),g(c,{key:_.key,title:_.value,value:_.key},{default:n(()=>[m(s(_.value),1)]),_:2},1032,["title","value"]))),128))]),_:1},8,["value","placeholder"])]),_:1}),a(h,{xs:24,sm:24,md:12,lg:6,xl:6},{default:n(()=>[a(k,{ref:"serachDateRangePicker",onDateTimeChanged:u[1]||(u[1]=_=>t.filters.dates=_)},null,512)]),_:1})]),_:1}),a(U,{orderType:t.activeOrderType,filters:t.filters,perPageItems:10},null,8,["orderType","filters"])]),_:1},8,["title","width","open","onClose"])}const Ie=F(Se,[["render",Ve]]),Be={components:{UserInfo:Ce,Details:Ie,AdminPageHeader:Ue,UserBalance:De,ExprotTable:ke,ArrowUpOutlined:Oe,ArrowDownOutlined:Pe},setup(){const{userType:t,columns:u,filterableColumns:T}=we(),e=he(),{formatAmountCurrency:C,getOrderTypeFromstring:b,statusColors:c,permsArray:d,convertToPositive:h,selectedWarehouse:k,willSubscriptionModuleVisible:O}=H(),U=I(!1),f=I({}),_=I("sales"),R=ne();oe(()=>{(!(d.value.includes("customers_view")||d.value.includes("suppliers_view")||d.value.includes("admin"))||!O("reports"))&&R.push("admin.dashboard.index"),d.value.includes("customers_view")||d.value.includes("admin")?t.value="customers":(d.value.includes("suppliers_view")||d.value.includes("admin"))&&(t.value="suppliers")}),se(()=>{P()});const P=()=>{e.tableUrl.value={url:`${t.value}?fields=id,xid,user_type,name,email,profile_image,profile_image_url,phone,details{purchase_order_count,purchase_return_count,sales_order_count,sales_return_count,total_amount,paid_amount,due_amount}`,filters:""},e.table.filterableColumns=T,e.exportDetails.value={allowExport:!0,exportType:"user_reports"},e.fetch({page:1})},E=(A,w)=>{f.value=w,_.value=A,U.value=!0};W(k,(A,w)=>{P()});const D=re(()=>{let A=0,w=0,B=0;return e.table.data.forEach(S=>{A+=S.details.total_amount,w+=S.details.due_amount,B+=S.details.paid_amount}),{totalAmount:A,dueAmount:w,paidAmount:B}});return{columns:u,...e,filterableColumns:T,statusColors:c,userType:t,formatAmountCurrency:C,convertToPositive:h,getOrderTypeFromstring:b,setUrlData:P,permsArray:d,detailsVisible:U,openUserReportDrawer:E,selectedUser:f,activeOrderType:_,totals:D}}},Re={class:"table-responsive"},Ee=["onClick"],xe={key:1},Ne=["onClick"],Me={key:1},Fe=["onClick"],He={key:1},We=["onClick"],Ke={key:1},Le={key:0};function je(t,u,T,e,C,b){const c=p("ExprotTable"),d=ue,h=p("router-link"),k=ie,O=de,U=p("AdminPageHeader"),f=z,_=L,R=j,P=_e,E=me,D=G,A=p("admin-page-filters"),w=pe,B=ce,S=p("UserInfo"),q=p("UserBalance"),V=ye,x=fe,J=p("ArrowUpOutlined"),M=ve,Q=p("ArrowDownOutlined"),X=ge,Y=be,Z=p("Details"),$=p("admin-page-table-content");return o(),l(v,null,[a(U,null,{header:n(()=>[a(d,{title:t.$t("menu.users_reports"),class:"p-0"},{extra:n(()=>[a(c,{exportType:"user_reports",tableName:"users-reports-table",title:t.$t("menu.users_reports")},null,8,["title"])]),_:1},8,["title"])]),breadcrumb:n(()=>[a(O,{separator:"-",style:{"font-size":"12px"}},{default:n(()=>[a(k,null,{default:n(()=>[a(h,{to:{name:"admin.dashboard.index"}},{default:n(()=>[m(s(t.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),a(k,null,{default:n(()=>[m(s(t.$t("menu.reports")),1)]),_:1}),a(k,null,{default:n(()=>[m(s(t.$t("menu.users_reports")),1)]),_:1})]),_:1})]),_:1}),a(A,null,{default:n(()=>[a(D,{gutter:[16,16]},{default:n(()=>[a(f,{xs:24,sm:24,md:12,lg:10,xl:10}),a(f,{xs:24,sm:24,md:12,lg:14,xl:14},{default:n(()=>[a(D,{gutter:[16,16],justify:"end"},{default:n(()=>[a(f,{xs:24,sm:24,md:24,lg:10,xl:10},{default:n(()=>[a(E,{compact:""},{default:n(()=>[a(R,{style:{width:"35%"},value:t.table.searchColumn,"onUpdate:value":u[0]||(u[0]=r=>t.table.searchColumn=r),placeholder:t.$t("common.select_default_text",[""])},{default:n(()=>[(o(!0),l(v,null,K(e.filterableColumns,r=>(o(),g(_,{key:r.key},{default:n(()=>[m(s(r.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),a(P,{style:{width:"65%"},value:t.table.searchString,"onUpdate:value":u[1]||(u[1]=r=>t.table.searchString=r),"show-search":"",onChange:t.onTableSearch,onSearch:t.onTableSearch,loading:t.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a($,null,{default:n(()=>[a(D,null,{default:n(()=>[a(f,{span:24},{default:n(()=>[a(B,{activeKey:e.userType,"onUpdate:activeKey":u[2]||(u[2]=r=>e.userType=r),onChange:e.setUrlData},{default:n(()=>[e.permsArray.includes("customers_view")||e.permsArray.includes("admin")?(o(),g(w,{key:"customers",tab:t.$t("menu.customers")},null,8,["tab"])):y("",!0),e.permsArray.includes("suppliers_view")||e.permsArray.includes("admin")?(o(),g(w,{key:"suppliers",tab:t.$t("menu.suppliers")},null,8,["tab"])):y("",!0)]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1}),a(D,{gutter:[16,16]},{default:n(()=>[a(f,{span:24},{default:n(()=>[le("div",Re,[a(Y,{columns:e.columns,"row-key":r=>r.xid,"data-source":t.table.data,pagination:t.table.pagination,loading:t.table.loading,onChange:t.handleTableChange,id:"users-reports-table",bordered:"",size:"middle"},{bodyCell:n(({column:r,text:ze,record:i})=>[r.dataIndex==="name"?(o(),g(S,{key:0,user:i},null,8,["user"])):y("",!0),r.dataIndex==="user_details.purchase_order_count"?(o(),l(v,{key:1},[e.permsArray.includes("purchases_view")||e.permsArray.includes("admin")?(o(),l("a",{key:0,onClick:N=>e.openUserReportDrawer("",i)},s(i.details.purchase_order_count),9,Ee)):(o(),l("span",xe,s(i.details.purchase_order_count),1))],64)):y("",!0),r.dataIndex==="user_details.purchase_return_count"?(o(),l(v,{key:2},[e.permsArray.includes("purchase_returns_view")||e.permsArray.includes("admin")?(o(),l("a",{key:0,onClick:N=>e.openUserReportDrawer("returns",i)},s(i.details.purchase_return_count),9,Ne)):(o(),l("span",Me,s(i.details.purchase_return_count),1))],64)):y("",!0),r.dataIndex==="user_details.sales_order_count"?(o(),l(v,{key:3},[e.permsArray.includes("sales_view")||e.permsArray.includes("admin")?(o(),l("a",{key:0,onClick:N=>e.openUserReportDrawer("",i)},s(i.details.sales_order_count),9,Fe)):(o(),l("span",He,s(i.details.sales_order_count),1))],64)):y("",!0),r.dataIndex==="user_details.sales_return_count"?(o(),l(v,{key:4},[e.permsArray.includes("sales_returns_view")||e.permsArray.includes("admin")?(o(),l("a",{key:0,onClick:N=>e.openUserReportDrawer("returns",i)},s(i.details.sales_return_count),9,We)):(o(),l("span",Ke,s(i.details.sales_return_count),1))],64)):y("",!0),r.dataIndex==="user_details.total_amount"?(o(),l(v,{key:5},[m(s(e.formatAmountCurrency(e.convertToPositive(i.details.total_amount))),1)],64)):y("",!0),r.dataIndex==="user_details.paid_amount"?(o(),l(v,{key:6},[m(s(e.formatAmountCurrency(e.convertToPositive(i.details.paid_amount))),1)],64)):y("",!0),r.dataIndex==="user_details.due_amount"?(o(),g(q,{key:7,amount:i.details.due_amount},null,8,["amount"])):y("",!0)]),summary:n(()=>[a(X,null,{default:n(()=>[a(V,{"col-span":4}),a(V,{"col-span":1},{default:n(()=>[a(x,{strong:""},{default:n(()=>[m(s(t.$t("common.total")),1)]),_:1})]),_:1}),a(V,{"col-span":1},{default:n(()=>[a(x,{strong:""},{default:n(()=>[m(s(e.formatAmountCurrency(e.totals.totalAmount)),1)]),_:1})]),_:1}),a(V,{"col-span":1},{default:n(()=>[a(x,{strong:""},{default:n(()=>[m(s(e.formatAmountCurrency(e.totals.paidAmount)),1)]),_:1})]),_:1}),a(V,{"col-span":1},{default:n(()=>[e.totals.dueAmount<0?(o(),g(M,{key:0,title:t.$t("payments.you_will_pay")},{default:n(()=>[a(J,{style:{color:"red"}}),m(" "+s(e.formatAmountCurrency(e.totals.dueAmount)),1)]),_:1},8,["title"])):(o(),g(M,{key:1,title:t.$t("payments.you_will_receive")},{default:n(()=>[e.totals.dueAmount>0?(o(),l("span",Le,[a(Q,{style:{color:"green"}})])):y("",!0),m(" "+s(e.formatAmountCurrency(e.totals.dueAmount)),1)]),_:1},8,["title"]))]),_:1})]),_:1})]),_:1},8,["columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),a(Z,{visible:e.detailsVisible,onClosed:u[3]||(u[3]=r=>e.detailsVisible=!1),data:e.selectedUser,orderType:e.activeOrderType,destroyOnClose:!0},null,8,["visible","data","orderType"])]),_:1})],64)}const ht=F(Be,[["render",je]]);export{ht as default};

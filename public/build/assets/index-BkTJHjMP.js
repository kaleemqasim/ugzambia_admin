import{aJ as Pe,aK as _e,a as t,y as Te,_ as M,o as r,c as _,j as E,t as n,k as d,a1 as me,Y as ne,d as B,b as L,E as re,i as h,w as a,G as f,l as s,J as Y,q as W,h as G,V as ye,aL as fe,aM as ge,aN as be,f as q,r as I,an as he,ao as ve,al as Ve,m as ke,aO as De,aP as Ee,x as He,ap as Me,B as Ce,X as Ue,aw as qe,R as Fe,az as Ne,aA as Be,a6 as ze,M as Ke,ab as je,ay as Re,aB as Le,aC as We,a0 as Ge,aE as Qe,aD as Je,aQ as Xe,aR as Ye,aS as Ze,ar as et,aG as tt}from"./app-B-s70ZVW.js";import{c as at}from"./crud-BPuBpR3E.js";import{A as ot,S as nt,f as rt}from"./SubscriptionModuleVisibility-CyCmdrwf.js";import{d as we}from"./datatable-D1qGK3Sr.js";import{A as it}from"./AdminPageHeader-BZo8VabB.js";import{I as st}from"./Import-OIHOotcW.js";import{F as dt}from"./FormOutlined-BAhiXr92.js";import{a as lt}from"./apiAdmin-DOfeiOwh.js";import{A as ut}from"./AppstoreAddOutlined-qvi9NVVq.js";import{s as ct}from"./sumBy-DrqiNg5f.js";import"./Upload-DbsTse7P.js";import"./UserInfo-BrzR8PBV.js";import"./FormItemHeading-Bg4z9im3.js";import"./BarcodeGenerator-CR_4tBnL.js";import"./BarcodeOutlined-6TnuTl2D.js";import"./PrinterOutlined-C86DeXTS.js";import"./fields-CGtgz-bn.js";import"./SaveOutlined-Om_ryCLQ.js";import"./AddEdit-D2B39nwP.js";import"./AddEdit-CK1NNSUF.js";import"./AddEdit-D3Pk7U4s.js";import"./some-CsrSZymV.js";import"./_isIterateeCall-CBx_YKUG.js";import"./filter-DWexaTG8.js";import"./AddButton-CK1rhJES.js";import"./AddEdit-5Yq_9LTv.js";import"./SettingOutlined-BhKAltex.js";import"./index-Dyp5BMap.js";import"./UploadFile-Chv4S9t1.js";import"./CloudDownloadOutlined-YT_mGbld.js";function pt(e,i){return e>i}function _t(e,i){return e<i}function Ie(e,i,u){for(var o=-1,g=e.length;++o<g;){var $=e[o],m=i($);if(m!=null&&(c===void 0?m===m&&!Pe(m):u(m,c)))var c=m,A=$}return A}function ue(e,i){return e&&e.length?Ie(e,_e(i),pt):void 0}function ce(e,i){return e&&e.length?Ie(e,_e(i),_t):void 0}var mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 680h-54V540H546v-92h238c8.8 0 16-7.2 16-16V168c0-8.8-7.2-16-16-16H240c-8.8 0-16 7.2-16 16v264c0 8.8 7.2 16 16 16h238v92H190v140h-54c-4.4 0-8 3.6-8 8v176c0 4.4 3.6 8 8 8h176c4.4 0 8-3.6 8-8V688c0-4.4-3.6-8-8-8h-54v-72h220v72h-54c-4.4 0-8 3.6-8 8v176c0 4.4 3.6 8 8 8h176c4.4 0 8-3.6 8-8V688c0-4.4-3.6-8-8-8h-54v-72h220v72h-54c-4.4 0-8 3.6-8 8v176c0 4.4 3.6 8 8 8h176c4.4 0 8-3.6 8-8V688c0-4.4-3.6-8-8-8zM256 805.3c0 1.5-1.2 2.7-2.7 2.7h-58.7c-1.5 0-2.7-1.2-2.7-2.7v-58.7c0-1.5 1.2-2.7 2.7-2.7h58.7c1.5 0 2.7 1.2 2.7 2.7v58.7zm288 0c0 1.5-1.2 2.7-2.7 2.7h-58.7c-1.5 0-2.7-1.2-2.7-2.7v-58.7c0-1.5 1.2-2.7 2.7-2.7h58.7c1.5 0 2.7 1.2 2.7 2.7v58.7zM288 384V216h448v168H288zm544 421.3c0 1.5-1.2 2.7-2.7 2.7h-58.7c-1.5 0-2.7-1.2-2.7-2.7v-58.7c0-1.5 1.2-2.7 2.7-2.7h58.7c1.5 0 2.7 1.2 2.7 2.7v58.7zM360 300a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"cluster",theme:"outlined"};const yt=mt;function pe(e){for(var i=1;i<arguments.length;i++){var u=arguments[i]!=null?Object(arguments[i]):{},o=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(u).filter(function(g){return Object.getOwnPropertyDescriptor(u,g).enumerable}))),o.forEach(function(g){ft(e,g,u[g])})}return e}function ft(e,i,u){return i in e?Object.defineProperty(e,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):e[i]=u,e}var ie=function(i,u){var o=pe({},i,u.attrs);return t(Te,pe({},o,{icon:yt}),null)};ie.displayName="ClusterOutlined";ie.inheritAttrs=!1;const gt=ie,bt={props:["product"]},ht={class:"user-info"},vt={class:"user-name"},kt={key:0,class:"user-designation"};function Ct(e,i,u,o,g,$){const m=me;return r(),_("div",ht,[E("figure",null,[t(m,{size:40,src:u.product.image_url},null,8,["src"])]),E("figcaption",null,[E("h1",vt,n(u.product.name),1),u.product.category_id?(r(),_("span",kt,n(u.product.category.name),1)):d("",!0)])])}const wt=M(bt,[["render",Ct]]),$e=()=>{const{t:e}=ne(),i=["product_id"],u=["product_id"],o=[{title:e("stock.order_date"),dataIndex:"order_date"},{title:e("stock.order_type"),dataIndex:"order_type"},{title:e("product.quantity"),dataIndex:"quantity"},{title:e("product.unit_price"),dataIndex:"single_unit_price"},{title:e("product.discount"),dataIndex:"total_discount"},{title:e("product.tax"),dataIndex:"total_tax"},{title:e("product.subtotal"),dataIndex:"subtotal"}],g=[{title:e("common.date"),dataIndex:"created_at"},{title:e("stock.order_type"),dataIndex:"order_type"},{title:e("product.quantity"),dataIndex:"quantity"},{title:e("product.stocks"),dataIndex:"stock_type"},{title:e("stock.remarks"),dataIndex:"action_type"}];return{productOrderColumns:o,stockHistoryColumns:g,stockHistoryHashableColumns:i,orderItemsHashableColumns:u}},It=B({props:["product"],setup(e){const{stockHistoryColumns:i,stockHistoryHashableColumns:u}=$e(),{formatDate:o,formatDateTime:g,formatAmountCurrency:$,getOrderTypeFromstring:m}=L(),c=we();return re(()=>{c.tableUrl.value={url:"stock-history?fields=id,xid,created_at,order_type,quantity,stock_type,action_type",filters:{product_id:e.product.xid}},c.hashable.value=[...u],c.fetch({page:1})}),{stockHistoryColumns:i,...c,formatDate:o,formatDateTime:g,formatAmountCurrency:$,getOrderTypeFromstring:m}}}),$t={key:0,class:"table-responsive"};function At(e,i,u,o,g,$){const m=Y,c=W,A=G;return r(),h(A,null,{default:a(()=>[t(c,{span:24},{default:a(()=>[e.table.loading?d("",!0):(r(),_("div",$t,[t(m,{columns:e.stockHistoryColumns,"row-key":w=>w.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange},{bodyCell:a(({column:w,record:p})=>[w.dataIndex==="created_at"?(r(),_(f,{key:0},[s(n(e.formatDateTime(p.created_at)),1)],64)):d("",!0),w.dataIndex==="order_type"?(r(),_(f,{key:1},[s(n(e.getOrderTypeFromstring(p.order_type)),1)],64)):d("",!0)]),_:1},8,["columns","row-key","data-source","pagination","loading","onChange"])]))]),_:1})]),_:1})}const St=M(It,[["render",At]]),Ot=B({props:["product"],setup(e){const{productOrderColumns:i,orderItemsHashableColumns:u}=$e(),{formatDate:o,formatDateTime:g,formatAmountCurrency:$,getOrderTypeFromstring:m}=L(),c=we();re(()=>{c.tableUrl.value={url:"order-items?fields=id,xid,quantity,single_unit_price,unit_price,total_discount,discount_rate,total_tax,tax_rate,subtotal,order_id,x_order_id,order{id,xid,order_type,order_date},unit_id,x_unit_id,unit{id,xid,short_name},product_id,x_product_id,product{id,xid,unit_id,x_unit_id},product:unit{id,xid,short_name}",filters:{product_id:e.product.xid}},c.hashable.value=[...u],c.table.sorter={field:"orders.order_date",order:"asc"},c.fetch({page:1})});const A=ye(()=>{let w=0,p=0,D=0,v=0;return c.table.data.forEach(b=>{w+=b.subtotal,p+=b.total_tax,D+=b.total_discount,v+=b.quantity}),{totalAmount:w,totalTax:p,totalDiscount:D,totalQuantity:v}});return{productOrderColumns:i,orderItemsHashableColumns:u,...c,totals:A,formatDate:o,formatDateTime:g,formatAmountCurrency:$,getOrderTypeFromstring:m}}}),xt={key:0,class:"table-responsive"};function Pt(e,i,u,o,g,$){const m=fe,c=ge,A=be,w=Y,p=W,D=G;return r(),h(D,null,{default:a(()=>[t(p,{span:24},{default:a(()=>[e.table.loading?d("",!0):(r(),_("div",xt,[t(w,{columns:e.productOrderColumns,"row-key":v=>v.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange},{bodyCell:a(({column:v,record:b})=>[v.dataIndex==="order_type"?(r(),_(f,{key:0},[s(n(e.getOrderTypeFromstring(b.order.order_type)),1)],64)):d("",!0),v.dataIndex==="order_date"?(r(),_(f,{key:1},[s(n(e.formatDateTime(b.order.order_date)),1)],64)):d("",!0),v.dataIndex==="quantity"?(r(),_(f,{key:2},[s(n(b.quantity)+" "+n(b.product&&b.product.unit&&b.product.unit.short_name?b.product.unit.short_name:""),1)],64)):d("",!0),v.dataIndex==="single_unit_price"?(r(),_(f,{key:3},[s(n(e.formatAmountCurrency(b.single_unit_price)),1)],64)):d("",!0),v.dataIndex==="total_discount"?(r(),_(f,{key:4},[s(n(e.formatAmountCurrency(b.total_discount))+" ("+n(b.discount_rate)+"%) ",1)],64)):d("",!0),v.dataIndex==="total_tax"?(r(),_(f,{key:5},[s(n(e.formatAmountCurrency(b.total_tax))+" ("+n(b.tax_rate)+"%) ",1)],64)):d("",!0),v.dataIndex==="subtotal"?(r(),_(f,{key:6},[s(n(e.formatAmountCurrency(b.subtotal)),1)],64)):d("",!0)]),summary:a(()=>[t(A,null,{default:a(()=>[t(m,{"col-span":1}),e.productType=="variable"?(r(),h(m,{key:0,"col-span":1})):d("",!0),t(m,{"col-span":1},{default:a(()=>[t(c,{strong:""},{default:a(()=>[s(n(e.$t("common.total")),1)]),_:1})]),_:1}),t(m,{"col-span":1},{default:a(()=>[t(c,{strong:""},{default:a(()=>[s(n(e.totals.totalQuantity),1)]),_:1})]),_:1}),t(m,{"col-span":1}),t(m,{"col-span":1},{default:a(()=>[t(c,{strong:""},{default:a(()=>[s(n(e.formatAmountCurrency(e.totals.totalDiscount)),1)]),_:1})]),_:1}),t(m,{"col-span":1},{default:a(()=>[t(c,{strong:""},{default:a(()=>[s(n(e.formatAmountCurrency(e.totals.totalTax)),1)]),_:1})]),_:1}),t(m,{"col-span":1},{default:a(()=>[t(c,{strong:""},{default:a(()=>[s(n(e.formatAmountCurrency(e.totals.totalAmount)),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","row-key","data-source","pagination","loading","onChange"])]))]),_:1})]),_:1})}const Ae=M(Ot,[["render",Pt]]),Tt=B({props:["product"],components:{StockHistory:St,ProductOrderItems:Ae},setup(){return{activeKey:q("product_order_items")}}});function Vt(e,i,u,o,g,$){const m=I("ProductOrderItems"),c=he,A=I("StockHistory"),w=ve;return r(),h(w,{activeKey:e.activeKey,"onUpdate:activeKey":i[0]||(i[0]=p=>e.activeKey=p)},{default:a(()=>[t(c,{key:"product_order_items",tab:e.$t("product.product_orders")},{default:a(()=>[t(m,{product:e.product},null,8,["product"])]),_:1},8,["tab"]),e.product.product_type!="service"?(r(),h(c,{key:"stock_history",tab:e.$t("product.stock_history")},{default:a(()=>[t(A,{product:e.product},null,8,["product"])]),_:1},8,["tab"])):d("",!0)]),_:1},8,["activeKey"])}const Dt=M(Tt,[["render",Vt]]),Et=B({props:["product","visible"],emits:["closed"],components:{ProductDetails:Dt},setup(e,{emit:i}){const{formatAmountCurrency:u}=L(),{t:o}=ne(),g=q([{title:o("variations.variation"),dataIndex:"variant_id"},{title:o("product.item_code"),dataIndex:"item_code"},{title:o("product.purchase_price"),dataIndex:"purchase_price"},{title:o("product.sales_price"),dataIndex:"sales_price"},{title:o("product.mrp"),dataIndex:"mrp"}]);return{formatAmountCurrency:u,onClose:()=>{i("closed")},variantTableColumns:g,drawerWidth:window.innerWidth<=991?"90%":"60%"}}}),Ht={class:"product-details"},Mt=["innerHTML"];function Ut(e,i,u,o,g,$){const m=Ve,c=W,A=ke,w=G,p=De,D=Ee,v=He,b=Y,z=I("ProductDetails"),F=Me;return r(),h(F,{title:e.product.name,width:e.drawerWidth,open:e.visible,"body-style":{paddingBottom:"80px"},maskClosable:!1,onClose:e.onClose,destroyOnClose:!0},{default:a(()=>[E("div",Ht,[t(w,{gutter:[16,16]},{default:a(()=>[e.product.product_type=="single"||e.product.product_type=="service"?(r(),h(c,{key:0,xs:24,sm:24,md:4,lg:4},{default:a(()=>[t(m,{src:e.product.image_url},null,8,["src"])]),_:1})):d("",!0),t(c,{xs:24,sm:24,md:e.product.product_type=="single"?20:24,lg:e.product.product_type=="single"?20:24},{default:a(()=>[e.product.details&&e.product.details.status=="out_of_stock"?(r(),h(w,{key:0,class:"mb-10 mt-10"},{default:a(()=>[t(c,{xs:24,sm:24,md:24,lg:24},{default:a(()=>[t(A,{type:"error"},{message:a(()=>[E("span",{innerHTML:e.$t("messages.product_out_of_stock",[e.product.details.current_stock,e.product.details.stock_quantitiy_alert])},null,8,Mt)]),_:1})]),_:1})]),_:1})):d("",!0),t(w,{class:"mb-10 mt-10"},{default:a(()=>[t(c,{xs:24,sm:24,md:24,lg:24},{default:a(()=>[t(D,{title:e.$t("product.details"),layout:"vertical",contentStyle:{fontWeight:500,marginBottom:"20px"}},{default:a(()=>[t(p,{label:e.$t("product.name")},{default:a(()=>[s(n(e.product.name),1)]),_:1},8,["label"]),e.product.product_type=="single"?(r(),h(p,{key:0,label:e.$t("product.item_code")},{default:a(()=>[s(n(e.product.item_code),1)]),_:1},8,["label"])):d("",!0),t(p,{label:e.$t("product.category")},{default:a(()=>[s(n(e.product.category&&e.product.category.xid?e.product.category.name:"-"),1)]),_:1},8,["label"]),t(p,{label:e.$t("product.brand")},{default:a(()=>[s(n(e.product.brand&&e.product.brand.xid?e.product.brand.name:"-"),1)]),_:1},8,["label"]),e.product.product_type=="single"?(r(),_(f,{key:1},[t(p,{label:e.$t("product.current_stock")},{default:a(()=>[s(n(e.product.details&&e.product.details.current_stock?`${e.product.details.current_stock} ${e.product.unit.short_name}`:"-"),1)]),_:1},8,["label"]),t(p,{label:e.$t("product.quantitiy_alert")},{default:a(()=>[s(n(e.product.details&&e.product.details.stock_quantitiy_alert?`${e.product.details.stock_quantitiy_alert} ${e.product.unit.short_name}`:"-"),1)]),_:1},8,["label"]),t(p,{label:e.$t("product.sales_price")},{default:a(()=>[s(n(e.product.details&&e.product.details.sales_price?e.formatAmountCurrency(e.product.details.sales_price):"-")+" "+n(e.product.details&&e.product.details.sales_tax_type=="inclusive"?` (${e.$t("common.with_tax")})`:` (${e.$t("common.without_tax")})`),1)]),_:1},8,["label"]),t(p,{label:e.$t("product.purchase_price")},{default:a(()=>[s(n(e.product.details&&e.product.details.purchase_price?e.formatAmountCurrency(e.product.details.purchase_price):"-")+" "+n(e.product.details&&e.product.details.purchase_tax_type=="inclusive"?` (${e.$t("common.with_tax")})`:` (${e.$t("common.without_tax")})`),1)]),_:1},8,["label"]),t(p,{label:e.$t("product.mrp")},{default:a(()=>[s(n(e.product.details&&e.product.details.mrp?e.formatAmountCurrency(e.product.details.mrp):"-"),1)]),_:1},8,["label"]),t(p,{label:e.$t("tax.rate")},{default:a(()=>[s(n(e.product.details&&e.product.details.tax&&e.product.details.tax.rate?`${e.product.details.tax.rate}%`:"-"),1)]),_:1},8,["label"]),t(p,{label:e.$t("product.opening_stock")},{default:a(()=>[s(n(e.product.details&&e.product.details.opening_stock?`${e.product.details.opening_stock} ${e.product.unit.short_name}`:"-"),1)]),_:1},8,["label"])],64)):d("",!0)]),_:1},8,["title"])]),_:1})]),_:1})]),_:1},8,["md","lg"])]),_:1})]),e.product.product_type=="variable"?(r(),_(f,{key:0},[t(v,{orientation:"left"},{default:a(()=>[s(n(e.$t("menu.variations")),1)]),_:1}),t(b,{dataSource:e.product.variations,columns:e.variantTableColumns,"row-key":O=>O.xid,pagination:!1,size:"middle",class:"mb-20"},{bodyCell:a(({column:O,text:x,record:H})=>[O.dataIndex==="variant_id"?(r(),_(f,{key:0},[s(n(H.name),1)],64)):d("",!0),O.dataIndex==="purchase_price"?(r(),_(f,{key:1},[s(n(e.formatAmountCurrency(H.details.purchase_price)),1)],64)):d("",!0),O.dataIndex==="sales_price"?(r(),_(f,{key:2},[s(n(e.formatAmountCurrency(H.details.sales_price)),1)],64)):d("",!0),O.dataIndex==="mrp"?(r(),_(f,{key:3},[s(n(e.formatAmountCurrency(H.details.mrp)),1)],64)):d("",!0)]),_:1},8,["dataSource","columns","row-key"])],64)):(r(),h(z,{key:1,product:e.product},null,8,["product"]))]),_:1},8,["title","width","open","onClose"])}const qt=M(Et,[["render",Ut]]),Ft=B({props:["moduleName"],components:{FormOutlined:dt},setup(e){const{visibleSubscriptionModules:i,appSetting:u,user:o}=L();return{visibleSubscriptionModules:i,appSetting:u,user:o}}});function Nt(e,i,u,o,g,$){const m=I("FormOutlined"),c=Ce,A=ke,w=W,p=G;return e.visibleSubscriptionModules&&!e.visibleSubscriptionModules.includes(e.moduleName)&&e.appSetting.x_admin_id==e.user.xid?(r(),h(p,{key:0,gutter:[15,15],class:"mb-20"},{default:a(()=>[t(w,{span:24},{default:a(()=>[t(A,{message:e.$t("subscription_plans.limit_exceed"),description:e.$t("subscription_plans.upgrade_your_plan"),type:"error","show-icon":"",onClose:i[0]||(i[0]=()=>e.$router.push({name:"admin.subscription.change_plan"}))},{closeText:a(()=>[t(c,{type:"primary"},{icon:a(()=>[t(m)]),default:a(()=>[s(" "+n(e.$t("subscription_plans.upgrade_plan")),1)]),_:1})]),_:1},8,["message","description"])]),_:1})]),_:1})):d("",!0)}const Bt=M(Ft,[["render",Nt]]),zt=B({props:["visible","product"],emits:["closed"],components:{ProductOrderItems:Ae},setup(e,{emit:i}){const{loading:u,rules:o}=lt();return{loading:u,rules:o,onClose:()=>{o.value={},i("closed")}}}});function Kt(e,i,u,o,g,$){const m=I("ProductOrderItems"),c=Ue;return r(),h(c,{open:e.visible,centered:!0,title:e.$t("product.product_history"),onCancel:e.onClose,width:"40%",footer:!1},{default:a(()=>[t(m,{product:e.product},null,8,["product"])]),_:1},8,["open","title","onCancel"])}const jt=M(zt,[["render",Kt]]),Rt={components:{EyeOutlined:qe,PlusOutlined:Fe,EditOutlined:Ne,DeleteOutlined:Be,ClusterOutlined:gt,AppstoreAddOutlined:ut,AddEdit:ot,ProductView:qt,ProductInfo:wt,AdminPageHeader:it,ImportProducts:st,ProductHistory:jt,SubscriptionModuleVisibility:nt,SubscriptionModuleVisibilityMessage:Bt},setup(){const{t:e}=ne(),{addEditUrl:i,initData:u,productType:o,columns:g,columnsNames:$,variantColumns:m,filterableColumns:c,hashableColumns:A,multiDimensalObjectColumns:w}=rt(),p=at(),{appSetting:D,permsArray:v,formatAmountCurrency:b,getRecursiveCategories:z,filterTreeNode:F,selectedWarehouse:O}=L(),x=q({category_id:void 0,brand_id:void 0}),H=window.config.product_sample_file,Q=q([]),J=q([]),K=q(!1),U=q(""),Z=k=>{K.value=!0,U.value=k},ee=()=>{K.value=!1};re(()=>{te(),j(),p.crudUrl.value=i,p.langKey.value="product",p.initData.value={...u},p.formData.value={...u},p.hashableColumns.value=[...A],p.multiDimensalObjectColumns.value={...w}});const j=()=>{if(o.value=="single"?g.value=[...$,{title:e("product.sales_price"),dataIndex:"sales_price",sorter:o.value=="single",sorter_field:"product_details.sales_price"},{title:e("product.purchase_price"),dataIndex:"purchase_price",sorter:o.value=="single",sorter_field:"product_details.purchase_price"},{title:e("product.current_stock"),dataIndex:"current_stock",sorter:!0,sorter_field:"product_details.current_stock"},{title:e("common.action"),dataIndex:"action"}]:o.value=="service"?(g.value=[...$,{title:e("common.action"),dataIndex:"action"}],p.table.sorter={}):o.value=="variable"&&(g.value=[...$,{title:e("product.sales_price"),dataIndex:"sales_price",sorter:!1,sorter_field:"product_details.sales_price"},{title:e("product.purchase_price"),dataIndex:"purchase_price",sorter:!1,sorter_field:"product_details.purchase_price"},{title:e("product.current_stock"),dataIndex:"current_stock",sorter:!1,sorter_field:"product_details.current_stock"},{title:e("common.action"),dataIndex:"action"}]),o.value=="single")var k="products?fields=id,xid,name,slug,product_type,barcode_symbology,item_code,image,image_url,category_id,x_category_id,category{id,xid,name},brand_id,x_brand_id,brand{id,xid,name},unit_id,x_unit_id,unit{id,xid,name,short_name},description,details{stock_quantitiy_alert,opening_stock,opening_stock_date,wholesale_price,wholesale_quantity,mrp,purchase_price,sales_price,tax_id,x_tax_id,purchase_tax_type,sales_tax_type,current_stock,warehouse_id,x_warehouse_id,status},details:tax{id,xid,name,rate},details:warehouse{id,xid,name},customFields{id,xid,field_name,field_value},warehouse_id,x_warehouse_id,warehouse{id,xid}";o.value=="variable"&&(k="products?fields=id,xid,name,product_type,slug,barcode_symbology,item_code,image,image_url,category_id,x_category_id,category{id,xid,name},brand_id,x_brand_id,brand{id,xid,name},unit_id,x_unit_id,unit{id,xid,name,short_name},description,details{stock_quantitiy_alert,opening_stock,opening_stock_date,wholesale_price,wholesale_quantity,mrp,purchase_price,sales_price,tax_id,x_tax_id,purchase_tax_type,sales_tax_type,current_stock,warehouse_id,x_warehouse_id,status},details:tax{id,xid,name,rate},details:warehouse{id,xid,name},customFields{id,xid,field_name,field_value},warehouse_id,x_warehouse_id,warehouse{id,xid},parent_id,x_parent_id,variations.limit(10000).offset(0){id,xid,name,slug,item_code,product_type,barcode_symbology,item_code,image,image_url,category_id,x_category_id,unit_id,x_unit_id,brand_id,x_brand_id},variations:productVariations{id,xid,product_id,x_product_id,variant_id,x_variant_id,variant_value_id,x_variant_value_id},variations:category{id,xid,name},variations:brand{id,xid,name},variations:unit{id,xid,name,short_name},variations:productVariations:variation{id,xid,name},variations:productVariations:variationType{id,xid,name},variations:details{stock_quantitiy_alert,opening_stock,opening_stock_date,wholesale_price,wholesale_quantity,mrp,purchase_price,sales_price,tax_id,x_tax_id,purchase_tax_type,sales_tax_type,current_stock,warehouse_id,x_warehouse_id,status},variations:details:tax{id,xid,name,rate},variations:details:warehouse{id,xid,name}"),o.value=="service"&&(k="products?fields=id,xid,name,slug,product_type,barcode_symbology,item_code,image,image_url,category_id,x_category_id,category{id,xid,name},brand_id,x_brand_id,brand{id,xid,name},unit_id,x_unit_id,unit{id,xid,name,short_name},description,details{stock_quantitiy_alert,opening_stock,opening_stock_date,wholesale_price,wholesale_quantity,mrp,purchase_price,sales_price,tax_id,x_tax_id,purchase_tax_type,sales_tax_type,current_stock,warehouse_id,x_warehouse_id,status},details:tax{id,xid,name,rate},details:warehouse{id,xid,name},customFields{id,xid,field_name,field_value},warehouse_id,x_warehouse_id,warehouse{id,xid}"),p.tableUrl.value={url:k,filters:x,extraFilters:{product_type:o.value}},p.table.filterableColumns=c,p.fetch({page:1})},te=()=>{const k=axiosAdmin.get("categories?limit=10000"),C=axiosAdmin.get("brands?limit=10000");Promise.all([k,C]).then(([P,T])=>{Q.value=z(P),J.value=T.data})},ae=k=>{var C="";const P=ce(k.variations,V=>V.details.sales_price),T=ue(k.variations,V=>V.details.sales_price);return P&&P.details.sales_price&&(C+=b(P.details.sales_price)),T&&T.details.sales_price&&(C+=" - "+b(T.details.sales_price)),C},oe=k=>{var C="";const P=ce(k.variations,V=>V.details.purchase_price),T=ue(k.variations,V=>V.details.purchase_price);return P&&P.details.sales_price&&(C+=b(P.details.purchase_price)),T&&T.details.sales_price&&(C+=" - "+b(T.details.purchase_price)),C},N=k=>ct(k.variations,C=>C.details.current_stock);ze(O,(k,C)=>{j()});const X=ye(()=>{let k=0;return p.table.data.forEach(C=>{o.value=="variable"&&C.variations?k+=N(C):o.value=="single"&&C.details&&C.details.current_stock&&(k+=C.details.current_stock)}),{totalCurrentStock:k}});return{columns:g,variantColumns:m,appSetting:D,...p,permsArray:v,formatAmountCurrency:b,categories:Q,brands:J,filters:x,filterTreeNode:F,setUrlData:j,sampleFileUrl:H,productType:o,getVariableProductSalePrice:ae,getVariableProductPurchasePrice:oe,getVariableProductStockSum:N,totals:X,productDetailsVisible:K,modelData:U,openProductDetails:Z,onCloseProductDetails:ee}}},Lt={class:"table-responsive"},Wt={key:0},Gt={key:1},Qt={key:0},Jt={key:1};function Xt(e,i,u,o,g,$){const m=Re,c=I("router-link"),A=Le,w=We,p=I("AdminPageHeader"),D=I("PlusOutlined"),v=Ce,b=I("SubscriptionModuleVisibility"),z=I("ImportProducts"),F=I("DeleteOutlined"),O=Ge,x=W,H=Qe,Q=tt,J=Je,K=Xe,U=G,Z=I("admin-page-filters"),ee=I("AddEdit"),j=I("ProductView"),te=I("ProductHistory"),ae=I("SubscriptionModuleVisibilityMessage"),oe=I("AppstoreAddOutlined"),N=he,X=I("ClusterOutlined"),k=ve,C=Ye,P=Ze,T=me,V=et,se=I("EyeOutlined"),Se=I("EditOutlined"),de=Y,R=fe,le=ge,Oe=be,xe=I("admin-page-table-content");return r(),_(f,null,[t(p,null,{header:a(()=>[t(m,{title:e.$t("menu.products"),class:"p-0"},null,8,["title"])]),breadcrumb:a(()=>[t(w,{separator:"-",style:{"font-size":"12px"}},{default:a(()=>[t(A,null,{default:a(()=>[t(c,{to:{name:"admin.dashboard.index"}},{default:a(()=>[s(n(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),t(A,null,{default:a(()=>[s(n(e.$t("menu.product_manager")),1)]),_:1}),t(A,null,{default:a(()=>[s(n(e.$t("menu.products")),1)]),_:1})]),_:1})]),_:1}),t(Z,null,{default:a(()=>[t(U,{gutter:[16,16]},{default:a(()=>[t(x,{xs:24,sm:24,md:12,lg:10,xl:10},{default:a(()=>[t(O,null,{default:a(()=>[o.permsArray.includes("products_create")||o.permsArray.includes("admin")?(r(),_(f,{key:0},[t(b,{moduleName:"product"},{default:a(()=>[t(v,{type:"primary",onClick:i[0]||(i[0]=()=>{e.formData={...e.formData,product_type:o.productType},e.addItem()})},{default:a(()=>[t(D),s(" "+n(e.$t("product.add")),1)]),_:1})]),_:1}),t(z,{pageTitle:e.$t("product.import_products"),sampleFileUrl:o.sampleFileUrl,importUrl:"products/import",onOnUploadSuccess:o.setUrlData},null,8,["pageTitle","sampleFileUrl","onOnUploadSuccess"])],64)):d("",!0),e.table.selectedRowKeys.length>0&&(o.permsArray.includes("products_delete")||o.permsArray.includes("admin"))?(r(),h(v,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:a(()=>[t(F)]),default:a(()=>[s(" "+n(e.$t("common.delete")),1)]),_:1},8,["onClick"])):d("",!0)]),_:1})]),_:1}),t(x,{xs:24,sm:24,md:12,lg:14,xl:14},{default:a(()=>[t(U,{gutter:[16,16],justify:"end"},{default:a(()=>[t(x,{xs:24,sm:24,md:8,lg:8,xl:6},{default:a(()=>[t(H,{value:e.table.searchString,"onUpdate:value":i[1]||(i[1]=y=>e.table.searchString=y),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,style:{width:"100%"},loading:e.table.filterLoading,placeholder:e.$t("common.search")},null,8,["value","onChange","onSearch","loading","placeholder"])]),_:1}),t(x,{xs:24,sm:24,md:8,lg:8,xl:6},{default:a(()=>[t(J,{value:o.filters.brand_id,"onUpdate:value":i[2]||(i[2]=y=>o.filters.brand_id=y),placeholder:e.$t("common.select_default_text",[e.$t("product.brand")]),allowClear:!0,style:{width:"100%"},optionFilterProp:"title","show-search":"",onChange:o.setUrlData},{default:a(()=>[(r(!0),_(f,null,Ke(o.brands,y=>(r(),h(Q,{key:y.xid,title:y.name,value:y.xid},{default:a(()=>[s(n(y.name),1)]),_:2},1032,["title","value"]))),128))]),_:1},8,["value","placeholder","onChange"])]),_:1}),t(x,{xs:24,sm:24,md:8,lg:8,xl:6},{default:a(()=>[t(K,{value:o.filters.category_id,"onUpdate:value":i[3]||(i[3]=y=>o.filters.category_id=y),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"250px",overflow:"auto"},placeholder:e.$t("common.select_default_text",[e.$t("category.category")]),"tree-data":o.categories,"allow-clear":"","tree-default-expand-all":"",filterTreeNode:o.filterTreeNode,onChange:o.setUrlData},null,8,["value","placeholder","tree-data","filterTreeNode","onChange"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(xe,null,{default:a(()=>[t(ee,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onAddAndNewSuccess:e.addAndNewSuccess,onAddAndContinueSuccess:e.addAndContinueSuccess,onClosed:e.onCloseAddEdit,formData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onAddAndNewSuccess","onAddAndContinueSuccess","onClosed","formData","data","pageTitle","successMessage"]),t(j,{product:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["product","visible","onClosed"]),t(te,{product:o.modelData,visible:o.productDetailsVisible,onClosed:o.onCloseProductDetails},null,8,["product","visible","onClosed"]),t(ae,{moduleName:"product"}),t(U,{gutter:16},{default:a(()=>[t(x,{span:24},{default:a(()=>[t(k,{activeKey:o.productType,"onUpdate:activeKey":i[4]||(i[4]=y=>o.productType=y),onChange:o.setUrlData},{default:a(()=>[t(N,{key:"single"},{tab:a(()=>[E("span",null,[t(oe),s(" "+n(e.$t("variations.single_type_product")),1)])]),_:1}),t(N,{key:"variable"},{tab:a(()=>[E("span",null,[t(X),s(" "+n(e.$t("variations.variant_type_product")),1)])]),_:1}),t(N,{key:"service"},{tab:a(()=>[E("span",null,[t(X),s(" "+n(e.$t("variations.service_type_product")),1)])]),_:1})]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1}),t(U,null,{default:a(()=>[t(x,{span:24},{default:a(()=>[E("div",Lt,[t(de,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:y=>({disabled:!1,name:y.xid})},columns:o.columns,"row-key":y=>y.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},je({bodyCell:a(({column:y,record:l})=>[y.dataIndex==="status"&&l&&l.details?(r(),_(f,{key:0},[l.details.status=="out_of_stock"?(r(),h(P,{key:0,placement:"top"},{content:a(()=>[s(n(e.$t("common.out_of_stock")),1)]),default:a(()=>[t(C,{status:"error"})]),_:1})):(r(),h(C,{key:1,status:"success"}))],64)):d("",!0),y.dataIndex==="name"?(r(),h(C,{key:1},{default:a(()=>[t(T,{shape:"square",src:l.image_url},null,8,["src"]),t(V,{onClick:S=>e.viewItem(l)},{default:a(()=>[s(n(l.name),1)]),_:2},1032,["onClick"])]),_:2},1024)):d("",!0),y.dataIndex==="warehouse_id"?(r(),_(f,{key:2},[s(n(l.details&&l.details.warehouse&&l.details.warehouse.name?l.details.warehouse.name:"-"),1)],64)):d("",!0),y.dataIndex==="category_id"?(r(),_(f,{key:3},[s(n(l.category?l.category.name:"-"),1)],64)):d("",!0),y.dataIndex==="brand_id"?(r(),_(f,{key:4},[s(n(l.brand?l.brand.name:"-"),1)],64)):d("",!0),y.dataIndex==="sales_price"?(r(),_(f,{key:5},[o.productType=="single"&&l&&l.details?(r(),_("span",Wt,n(o.formatAmountCurrency(l.details.sales_price)),1)):o.productType=="variable"?(r(),_("span",Gt,n(o.getVariableProductSalePrice(l)),1)):d("",!0)],64)):d("",!0),y.dataIndex==="purchase_price"?(r(),_(f,{key:6},[o.productType=="single"&&l&&l.details?(r(),_("span",Qt,n(o.formatAmountCurrency(l.details.purchase_price)),1)):o.productType=="variable"?(r(),_("span",Jt,n(o.getVariableProductPurchasePrice(l)),1)):d("",!0)],64)):d("",!0),y.dataIndex==="current_stock"?(r(),_(f,{key:7},[o.productType=="single"&&l&&l.details?(r(),h(V,{key:0,type:"primary",onClick:S=>o.openProductDetails(l),style:{"margin-left":"4px"}},{default:a(()=>[s(n(`${l.details.current_stock} ${l.unit.short_name}`),1)]),_:2},1032,["onClick"])):o.productType=="variable"?(r(),h(V,{key:1,type:"primary",onClick:S=>o.openProductDetails(l),style:{"margin-left":"4px"}},{default:a(()=>[s(n(o.getVariableProductStockSum(l)),1)]),_:2},1032,["onClick"])):d("",!0)],64)):d("",!0),y.dataIndex==="action"?(r(),h(O,{key:8},{default:a(()=>[t(v,{onClick:S=>e.viewItem(l),type:"primary"},{icon:a(()=>[t(se)]),_:2},1032,["onClick"]),o.permsArray.includes("products_edit")||o.permsArray.includes("admin")?(r(),h(v,{key:0,type:"primary",onClick:S=>e.editItem(l)},{icon:a(()=>[t(Se)]),_:2},1032,["onClick"])):d("",!0),o.permsArray.includes("products_delete")||o.permsArray.includes("admin")?(r(),h(v,{key:1,type:"primary",onClick:S=>e.showDeleteConfirm(l.xid)},{icon:a(()=>[t(F)]),_:2},1032,["onClick"])):d("",!0)]),_:2},1024)):d("",!0)]),_:2},[o.productType=="variable"?{name:"expandedRowRender",fn:a(y=>[y&&y.record&&y.record.variations?(r(),h(de,{key:0,columns:o.variantColumns,"row-key":l=>l.xid,"data-source":y.record.variations,pagination:!1,size:"middle"},{bodyCell:a(({column:l,record:S})=>[l.dataIndex==="name"?(r(),_(f,{key:0},[s(n(S.name),1)],64)):d("",!0),l.dataIndex==="sales_price"&&S&&S.details?(r(),_(f,{key:1},[s(n(o.formatAmountCurrency(S.details.sales_price)),1)],64)):d("",!0),l.dataIndex==="purchase_price"&&S&&S.details?(r(),_(f,{key:2},[s(n(o.formatAmountCurrency(S.details.purchase_price)),1)],64)):d("",!0),l.dataIndex==="current_stock"&&S&&S.details?(r(),_(f,{key:3},[s(n(`${S.details.current_stock} ${y.record.unit.short_name}`),1)],64)):d("",!0),l.dataIndex==="action"?(r(),h(v,{key:4,onClick:Yt=>e.viewItem(S),type:"links"},{icon:a(()=>[t(se)]),_:2},1032,["onClick"])):d("",!0)]),_:2},1032,["columns","row-key","data-source"])):d("",!0)]),key:"0"}:void 0,o.productType!="service"?{name:"summary",fn:a(()=>[t(Oe,null,{default:a(()=>[t(R,{"col-span":5}),o.productType=="variable"?(r(),h(R,{key:0,"col-span":1})):d("",!0),t(R,{"col-span":2}),t(R,{"col-span":1},{default:a(()=>[t(le,{strong:""},{default:a(()=>[s(n(e.$t("common.total")),1)]),_:1})]),_:1}),t(R,{"col-span":1},{default:a(()=>[t(le,{strong:""},{default:a(()=>[s(n(o.totals.totalCurrentStock),1)]),_:1})]),_:1})]),_:1})]),key:"1"}:void 0]),1032,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1})]),_:1})],64)}const xa=M(Rt,[["render",Xt]]);export{xa as default};

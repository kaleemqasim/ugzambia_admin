import{_ as te,d as se,r as d,o as l,i,w as t,a as n,X as le,aw as re,R as ie,az as ue,aA as de,Y as me,b as ce,z as _e,f as b,E as pe,a6 as ne,V as ye,c as h,G as U,ax as j,l as _,t as p,k as m,M as ee,j as fe,ab as ge,ay as be,aB as ve,aC as he,B as Ce,a0 as we,q as ke,aD as Te,aE as De,aF as Ae,h as Ue,an as Ee,ao as Se,ar as Oe,bk as Ke,aL as Ve,aM as Be,H as Ie,aN as Me,J as Fe,aG as Pe}from"./app-BGT2rO3o.js";import{c as Re}from"./crud-CMCwfvrw.js";import{A as Ne,f as $e}from"./fields-Dtkb-eKZ.js";import{U as ze}from"./UserInfo-CAbt0aZj.js";import{S as He}from"./StateWidget-DuZzb-tF.js";import{A as Le}from"./AdminPageHeader-CJWz-FmB.js";import{T as We,U as je,a as qe}from"./View-BvOnHu_Z.js";import{I as Ge}from"./Import-H-ohO1M1.js";import{a as Ye}from"./apiAdmin-Dy0HBSub.js";import{A as Je,a as Xe}from"./ArrowUpOutlined-CqAzb1hS.js";import"./datatable-kwYU4TZT.js";import"./filter-B3udfxQg.js";import"./Upload-Dzy6Mw2H.js";import"./AddButton-DHU55O9P.js";import"./AddEdit-C5f2dKZP.js";import"./SaveOutlined-DE64dtuy.js";import"./SettingOutlined-rQIIFNy5.js";import"./AddButton-BymJ4UFo.js";import"./AddEdit-_kWAg8By.js";import"./index-DnH4K6FM.js";import"./UploadFile-BXJTvpNL.js";import"./CloudDownloadOutlined-Pa6p2PwM.js";const Qe=se({props:["visible","user"],components:{Transactions:We},setup(e,{emit:u}){const{loading:I,rules:a}=Ye();return{loading:I,rules:a,onClose:()=>{u("closed")}}}});function Ze(e,u,I,a,$,q){const M=d("Transactions"),F=le;return l(),i(F,{open:e.visible,centered:!0,title:e.$t("payments.transactions"),onCancel:e.onClose,width:"40%",footer:!1},{default:t(()=>[n(M,{user_id:e.user.xid,result_type:e.user.user_type=="staff_members"?"staff_member":"customer_supplier"},null,8,["user_id","result_type"])]),_:1},8,["open","title","onCancel"])}const xe=te(Qe,[["render",Ze]]),ea={components:{EyeOutlined:re,PlusOutlined:ie,EditOutlined:ue,DeleteOutlined:de,ArrowUpOutlined:Je,ArrowDownOutlined:Xe,AddEdit:Ne,UserInfo:ze,StateWidget:He,AdminPageHeader:Le,UserBalance:je,UserView:qe,ImportUsers:Ge,UserTransaction:xe},setup(){const{t:e}=me(),{statusColors:u,userStatus:I,permsArray:a,formatDateTime:$,user:q,selectedWarehouse:M,formatAmountCurrency:F}=ce(),{supplierInitData:E,customerInitData:z,staffMemberInitData:H,columns:C,supplierCustomerColumns:P,filterableColumns:R}=$e(),s=Re(),v=_e(),y=b(v.meta.menuKey),G="?fields=id,district,xid,user_type,name,email,profile_image,profile_image_url,is_walkin_customer,phone,address,shipping_address,status,tax_number,created_at,details{opening_balance,opening_balance_type,credit_period,credit_limit,due_amount,warehouse_id,x_warehouse_id},details:warehouse{id,xid,name},role_id,role{id,xid,name,display_name},warehouse_id,x_warehouse_id,warehouse{xid,name},userWarehouses{user_id,x_user_id,warehouse_id,x_warehouse_id}",w=b(void 0),k=b("all"),T=b("all"),S=b([]),f=b(""),D=b(""),O=b(""),K=b(!1),L=b(""),Y=r=>{K.value=!0,L.value=r},J=()=>{K.value=!1},X=async()=>{const r=new Date,c=r.getFullYear(),Q=r.getMonth()+1,Z=`${c}${Q.toString().padStart(2,"0")}`;try{axiosAdmin.get(`period-api-data-import-session/${Z}`).then(x=>{j.success({placement:"topRight",message:e("common.success"),description:e("employees.synced_in_session_success")})})}catch{j.success({placement:"topRight",message:e("common.error"),description:"Something went wrong"})}},V=async()=>{try{axiosAdmin.get("process-session-import-data").then(r=>{j.success({placement:"topRight",message:e("common.success"),description:e("employees.synced_in_db")})})}catch{j.success({placement:"topRight",message:e("common.error"),description:e("employees.synced_in_db_failed")})}};pe(()=>{B(),s.table.filterableColumns=R,N()});const N=()=>{y.value=="suppliers"?(s.initData.value={...E},s.formData.value={...E},s.langKey.value="supplier",S.value=P,f.value=window.config.supplier_sample_file,D.value=e("supplier.import_suppliers"),O.value="suppliers/import"):y.value=="customers"?(s.initData.value={...z},s.formData.value={...z},s.langKey.value="customer",S.value=P,f.value=window.config.customer_sample_file,D.value=e("customer.import_customers"),O.value="customers/import"):(s.initData.value={...H},s.formData.value={...H},s.langKey.value="staff_member",S.value=C,f.value=window.config.staff_member_sample_file,D.value=e("staff_member.import_staff_members"),O.value="users/import"),s.restFormData()},B=()=>{s.crudUrl.value=y.value;var r="",c={};w.value!=null&&w.value!="all"&&(r+=`status eq "${w.value}"`),T.value!=null&&T.value!="all"&&y.value!="users"&&(c.search_due_type=T.value),s.tableUrl.value={url:`${y.value}${G}`,filterString:r,extraFilters:c},s.fetch({page:1})};ne(()=>v.meta.menuKey,(r,c)=>{(v.meta.menuKey=="users"||v.meta.menuKey=="customers"||v.meta.menuKey=="suppliers")&&(y.value=v.meta.menuKey,w.value=void 0,s.table.searchColumn=void 0,s.table.searchString="",T.value="all",B(),N())}),ne(M,(r,c)=>{B()});const W=ye(()=>{let r=0;return s.table.data.forEach(c=>{c&&c.details&&c.details.due_amount&&(r+=c.details.due_amount)}),{totalOpeningBalance:r}});return{statusColors:u,userStatus:I,filterableColumns:R,userType:y,tableColumns:S,searchStatus:w,setUrlData:B,searchDueType:T,activeTabKey:k,...s,permsArray:a,transactionVisible:K,formatDateTime:$,user:q,formatAmountCurrency:F,sampleFileUrl:f,importPageTitle:D,importUrl:O,totals:W,onCloseTransactions:J,openTransactions:Y,modelData:L,syncEmployees:X,updateEmployees:V}}},aa={class:"table-responsive"},na={key:0};function ta(e,u,I,a,$,q){const M=be,F=d("router-link"),E=ve,z=he,H=d("AdminPageHeader"),C=Ce,P=we,R=d("DeleteOutlined"),s=ke,v=Pe,y=Te,G=De,w=Ae,k=Ue,T=d("admin-page-filters"),S=d("AddEdit"),f=Ee,D=Se,O=d("user-info"),K=Oe,L=Ke,Y=d("UserBalance"),J=d("EyeOutlined"),X=d("EditOutlined"),V=Ve,N=Be,B=d("ArrowUpOutlined"),W=Ie,r=d("ArrowDownOutlined"),c=Me,Q=Fe,Z=d("UserView"),x=d("UserTransaction"),oe=d("admin-page-table-content");return l(),h(U,null,[n(H,null,{header:t(()=>[n(M,{title:e.$t(`menu.${e.langKey}s`),class:"p-0"},null,8,["title"])]),breadcrumb:t(()=>[n(z,{separator:"-",style:{"font-size":"12px"}},{default:t(()=>[n(E,null,{default:t(()=>[n(F,{to:{name:"admin.dashboard.index"}},{default:t(()=>[_(p(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),n(E,null,{default:t(()=>[_(p(e.$t("menu.parties")),1)]),_:1}),n(E,null,{default:t(()=>[_(p(e.$t(`menu.${e.langKey}s`)),1)]),_:1})]),_:1})]),_:1}),n(T,null,{default:t(()=>[n(k,{gutter:[16,16]},{default:t(()=>[n(s,{xs:24,sm:24,md:12,lg:10,xl:10},{default:t(()=>[n(P,null,{default:t(()=>[a.permsArray.includes(`${a.userType}_create`)||a.permsArray.includes("admin")?(l(),i(P,{key:0},{default:t(()=>[n(C,{type:"primary",onClick:a.syncEmployees},{default:t(()=>[_(" Sync Employees ")]),_:1},8,["onClick"])]),_:1})):m("",!0),e.table.selectedRowKeys.length>0&&(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))?(l(),i(C,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:t(()=>[n(R)]),default:t(()=>[_(" "+p(e.$t("common.delete")),1)]),_:1},8,["onClick"])):m("",!0)]),_:1})]),_:1}),n(s,{xs:24,sm:24,md:12,lg:14,xl:14},{default:t(()=>[n(k,{gutter:[16,16],justify:"end"},{default:t(()=>[n(s,{xs:24,sm:24,md:12,lg:8,xl:8},{default:t(()=>[n(w,{compact:""},{default:t(()=>[n(y,{style:{width:"25%"},value:e.table.searchColumn,"onUpdate:value":u[0]||(u[0]=o=>e.table.searchColumn=o),placeholder:e.$t("common.select_default_text",[""])},{default:t(()=>[(l(!0),h(U,null,ee(a.filterableColumns,o=>(l(),i(v,{key:o.key},{default:t(()=>[_(p(o.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),n(G,{style:{width:"75%"},value:e.table.searchString,"onUpdate:value":u[1]||(u[1]=o=>e.table.searchString=o),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,loading:e.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1}),a.userType&&a.userType!="users"?(l(),i(s,{key:0,xs:24,sm:24,md:12,lg:6,xl:6},{default:t(()=>[n(y,{value:a.searchStatus,"onUpdate:value":u[2]||(u[2]=o=>a.searchStatus=o),onChange:a.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("user.status")]),allowClear:!0,optionFilterProp:"label"},{default:t(()=>[(l(!0),h(U,null,ee(a.userStatus,o=>(l(),i(v,{key:o.key,value:o.key,label:o.value},{default:t(()=>[_(p(o.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):m("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n(oe,null,{default:t(()=>[n(S,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,addEditData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","addEditData","data","pageTitle","successMessage"]),a.userType&&a.userType=="users"?(l(),i(k,{key:0},{default:t(()=>[n(s,{span:24},{default:t(()=>[n(D,{activeKey:a.searchStatus,"onUpdate:activeKey":u[3]||(u[3]=o=>a.searchStatus=o),onChange:a.setUrlData},{default:t(()=>[n(f,{key:"all",tab:`${e.$t("common.all")} ${e.$t("menu.users")}`},null,8,["tab"]),(l(!0),h(U,null,ee(a.userStatus,o=>(l(),i(f,{key:o.key,tab:`${o.value} ${e.$t("menu.users")}`},null,8,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):m("",!0),a.userType&&a.userType!="users"?(l(),i(k,{key:1},{default:t(()=>[n(s,{span:24},{default:t(()=>[n(D,{activeKey:a.searchDueType,"onUpdate:activeKey":u[4]||(u[4]=o=>a.searchDueType=o),onChange:a.setUrlData},{default:t(()=>[n(f,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),n(f,{key:"receive",tab:`${e.$t("user.to_receive")}`},null,8,["tab"]),n(f,{key:"pay",tab:`${e.$t("user.to_pay")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):m("",!0),n(k,{gutter:[15,15]},{default:t(()=>[n(s,{span:24},{default:t(()=>[fe("div",aa,[n(Q,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:o=>({disabled:!!(a.user.xid==o.xid||o.is_walkin_customer),name:o.xid})},columns:a.tableColumns,"row-key":o=>o.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},ge({bodyCell:t(({column:o,text:ae,record:g})=>[o.dataIndex==="name"?(l(),i(K,{key:0,type:"primary",onClick:A=>e.viewItem(g)},{default:t(()=>[n(O,{user:g},null,8,["user"])]),_:2},1032,["onClick"])):m("",!0),o.dataIndex==="status"?(l(),i(L,{key:1,color:a.statusColors[ae]},{default:t(()=>[_(p(e.$t(`common.${ae}`)),1)]),_:2},1032,["color"])):m("",!0),o.dataIndex==="created_at"?(l(),h(U,{key:2},[_(p(a.formatDateTime(g.created_at)),1)],64)):m("",!0),o.dataIndex==="balance"?(l(),h(U,{key:3},[a.userType&&a.userType!="users"?(l(),i(K,{key:0,type:"primary",onClick:A=>a.openTransactions(g)},{default:t(()=>{var A;return[n(Y,{amount:(A=g.details)==null?void 0:A.due_amount},null,8,["amount"])]}),_:2},1032,["onClick"])):m("",!0)],64)):m("",!0),o.dataIndex==="action"?(l(),h(U,{key:4},[n(C,{type:"primary",onClick:A=>e.viewItem(g),style:{"margin-left":"4px"}},{icon:t(()=>[n(J)]),_:2},1032,["onClick"]),a.permsArray.includes(`${a.userType}_edit`)||a.permsArray.includes("admin")?(l(),i(C,{key:0,type:"primary",onClick:A=>e.editItem(g),style:{"margin-left":"4px"}},{icon:t(()=>[n(X)]),_:2},1032,["onClick"])):m("",!0),(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))&&a.user.xid!=g.xid&&!g.is_walkin_customer?(l(),i(C,{key:1,type:"primary",onClick:A=>e.showDeleteConfirm(g.xid),style:{"margin-left":"4px"}},{icon:t(()=>[n(R)]),_:2},1032,["onClick"])):m("",!0)],64)):m("",!0)]),_:2},[a.userType&&a.userType!="users"?{name:"summary",fn:t(()=>[n(c,null,{default:t(()=>[n(V,{"col-span":1}),n(V,{"col-span":2}),n(V,{"col-span":1},{default:t(()=>[n(N,{strong:""},{default:t(()=>[_(p(e.$t("common.total")),1)]),_:1})]),_:1}),n(V,{"col-span":1},{default:t(()=>[n(N,{strong:""},{default:t(()=>[a.totals.totalOpeningBalance<0?(l(),i(W,{key:0},{default:t(()=>[n(B,{style:{color:"red"}}),_(" "+p(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1})):(l(),i(W,{key:1},{default:t(()=>[a.totals.totalOpeningBalance>0?(l(),h("span",na,[n(r,{style:{color:"green"}})])):m("",!0),_(" "+p(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),n(Z,{user:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["user","visible","onClosed"]),n(x,{user:a.modelData,visible:a.transactionVisible,onClosed:a.onCloseTransactions},null,8,["user","visible","onClosed"])]),_:1})],64)}const Aa=te(ea,[["render",ta]]);export{Aa as default};

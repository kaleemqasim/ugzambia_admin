import{Y as V,f as B,_ as q,d as ee,R as H,aT as ae,b as K,cy as R,E as j,a6 as te,r as c,o as s,i as k,w as a,a as t,l as i,t as m,j as Y,c as b,M as F,G as C,k as g,aG as z,aD as W,n as ne,q as G,h as L,a_ as le,be as oe,b5 as de,F as se,B as J,a0 as Q,ap as re,az as me,aA as ie,ay as ue,aB as pe,aC as _e,bH as ye,J as ce}from"./app-D4MLQDBq.js";import{c as fe}from"./crud-D3Rid15-.js";import{h as ge}from"./hrmManagement-Nk6XSyb_.js";import{a as he}from"./apiAdmin-RdnAj9yx.js";import{S as ve}from"./StaffAddButton-C3EXLYsB.js";import{P as be}from"./AddButton-B7YUNhBP.js";import{D as Ce}from"./DateTimePicker-8ZpHU-uH.js";import{S as ke}from"./SaveOutlined-obpPvnis.js";import{A as De}from"./AdminPageHeader-mLYJ9Qzy.js";import{D as Ae}from"./DateRangePicker-D0QeaUlK.js";import{P as Se}from"./PayrollSidebar-Bgc4e6D4.js";import"./datatable-LegXxyA7.js";import"./filter-CI_FjftV.js";import"./fields-DjU54IsK.js";import"./Upload-CIoROJEZ.js";import"./AddButton-C7peUqHJ.js";import"./AddEdit-Boaqf196.js";import"./SettingOutlined-DCcbq3Qt.js";import"./AddButton-DYmOXGDY.js";import"./AddEdit-hBxBQJx9.js";import"./AddEdit-BEPFtlyv.js";import"./index-BPnlttH6.js";import"./ScheduleOutlined-CVZcRgLh.js";import"./TabletOutlined-C2oLD5-P.js";import"./DollarCircleOutlined-Dys9pfUJ.js";const we=()=>{const e="pre-payments",{t:l}=V(),M=["payment_mode_id","user_id"],n={user_id:void 0,payment_mode_id:void 0,amount:"",date_time:"",notes:"",payroll_month:"",payroll_year:"",deduct_from_payroll:1},S=B([{title:l("pre_payment.date_time"),dataIndex:"date_time"},{title:l("pre_payment.user_id"),dataIndex:"user_id"},{title:l("pre_payment.amount"),dataIndex:"amount"},{title:l("pre_payment.payment_mode_id"),dataIndex:"payment_mode_id"},{title:l("pre_payment.deduct_month"),dataIndex:"deduct_month"},{title:l("pre_payment.notes"),dataIndex:"notes"}]),O=[{key:"name",value:l("common.name")}];return{addEditUrl:e,initData:n,columns:S,filterableColumns:O,hashableColumns:M}},Me=ee({props:["formData","data","visible","url","addEditType","pageTitle","successMessage"],components:{PlusOutlined:H,LoadingOutlined:ae,SaveOutlined:ke,StaffMemberAddButton:ve,PaymentModeAddButton:be,DateTimePicker:Ce},setup(e,{emit:l}){const{addEditRequestAdmin:M,loading:n,rules:S}=he(),{appSetting:O,disabledDate:u,permsArray:f}=K(),h=B([]),y="users?limit=10000",p=B([]),P="payment-modes?fields=id,xid,name&limit=10000",r=B(R());j(()=>{const _=axiosAdmin.get(y),D=axiosAdmin.get(P);Promise.all([_,D]).then(([T,A])=>{h.value=T.data,p.value=A.data})});const $=()=>{M({url:e.url,data:{...e.formData,payroll_year:r.value.format("YYYY"),payroll_month:r.value.format("MM")},successMessage:e.successMessage,success:_=>{l("addEditSuccess",_.xid)}})},v=()=>{axiosAdmin.get(y).then(_=>{h.value=_.data})},w=()=>{axiosAdmin.get(P).then(_=>{p.value=_.data})},E=()=>{S.value={},l("closed")};return te(()=>e.visible,(_,D)=>{e.visible&&e.addEditType=="edit"&&(r.value=R(`${e.data.payroll_year}-${e.data.payroll_month}-01`))}),{loading:n,rules:S,onClose:E,onSubmit:$,appSetting:O,disabledDate:u,permsArray:f,staffMemberAdded:v,allStaffMembers:h,paymentModes:p,paymentModeAdded:w,monthYear:r,drawerWidth:window.innerWidth<=991?"90%":"45%"}}}),Pe={style:{display:"flex"}},$e={style:{display:"flex"}},Ee={style:{display:"flex"}};function Te(e,l,M,n,S,O){const u=z,f=W,h=c("StaffMemberAddButton"),y=ne,p=G,P=c("PaymentModeAddButton"),r=L,$=c("DateTimePicker"),v=le,w=oe,E=de,_=se,D=c("SaveOutlined"),T=J,A=Q,I=re;return s(),k(I,{title:e.pageTitle,width:e.drawerWidth,open:e.visible,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},maskClosable:!1,onClose:e.onClose},{footer:a(()=>[t(A,null,{default:a(()=>[t(T,{key:"submit",type:"primary",loading:e.loading,onClick:e.onSubmit},{icon:a(()=>[t(D)]),default:a(()=>[i(" "+m(e.addEditType=="add"?e.$t("common.create"):e.$t("common.update")),1)]),_:1},8,["loading","onClick"]),t(T,{key:"back",onClick:e.onClose},{default:a(()=>[i(m(e.$t("common.cancel")),1)]),_:1},8,["onClick"])]),_:1})]),default:a(()=>[t(_,{layout:"vertical"},{default:a(()=>[t(r,{gutter:16},{default:a(()=>[t(p,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[t(y,{label:e.$t("pre_payment.user_id"),name:"user_id",help:e.rules.user_id?e.rules.user_id.message:null,validateStatus:e.rules.user_id?"error":null,class:"required"},{default:a(()=>[Y("span",Pe,[t(f,{value:e.formData.user_id,"onUpdate:value":l[0]||(l[0]=d=>e.formData.user_id=d),placeholder:e.$t("common.select_default_text",[e.$t("pre_payment.user_id")]),allowClear:!0},{default:a(()=>[(s(!0),b(C,null,F(e.allStaffMembers,d=>(s(),k(u,{key:d.xid,value:d.xid},{default:a(()=>[i(m(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"]),t(h,{onOnAddSuccess:e.staffMemberAdded},null,8,["onOnAddSuccess"])])]),_:1},8,["label","help","validateStatus"])]),_:1}),t(p,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[t(y,{label:e.$t("pre_payment.payment_mode_id"),name:"payment_mode_id",help:e.rules.payment_mode_id?e.rules.payment_mode_id.message:null,validateStatus:e.rules.payment_mode_id?"error":null,class:"required"},{default:a(()=>[Y("span",$e,[t(f,{value:e.formData.payment_mode_id,"onUpdate:value":l[1]||(l[1]=d=>e.formData.payment_mode_id=d),placeholder:e.$t("common.select_default_text",[e.$t("pre_payment.payment_mode_id")]),allowClear:!0},{default:a(()=>[(s(!0),b(C,null,F(e.paymentModes,d=>(s(),k(u,{key:d.xid,value:d.xid},{default:a(()=>[i(m(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"]),t(P,{onOnAddSuccess:e.paymentModeAdded},null,8,["onOnAddSuccess"])])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),t(r,{gutter:16},{default:a(()=>[t(p,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[t(y,{label:e.$t("pre_payment.date_time"),name:"date_time",help:e.rules.date_time?e.rules.date_time.message:null,validateStatus:e.rules.date_time?"error":null,class:"required"},{default:a(()=>[t($,{dateTime:e.formData.date_time,onDateTimeChanged:l[2]||(l[2]=d=>e.formData.date_time=d)},null,8,["dateTime"])]),_:1},8,["label","help","validateStatus"])]),_:1}),t(p,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[t(y,{label:e.$t("pre_payment.amount"),name:"amount",help:e.rules.amount?e.rules.amount.message:null,validateStatus:e.rules.amount?"error":null,class:"required"},{default:a(()=>[t(v,{value:e.formData.amount,"onUpdate:value":l[3]||(l[3]=d=>e.formData.amount=d),placeholder:e.$t("common.placeholder_default_text",[e.$t("pre_payment.amount")]),style:{width:"100%"}},{addonBefore:a(()=>[i(m(e.appSetting.currency.symbol),1)]),_:1},8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),t(r,{gutter:16},{default:a(()=>[t(p,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[t(y,{label:e.$t("pre_payment.deduct_from_payroll"),name:"deduct_from_payroll",help:e.rules.deduct_from_payroll?e.rules.deduct_from_payroll.message:null,validateStatus:e.rules.deduct_from_payroll?"error":null},{default:a(()=>[Y("span",Ee,[t(f,{value:e.formData.deduct_from_payroll,"onUpdate:value":l[4]||(l[4]=d=>e.formData.deduct_from_payroll=d),placeholder:e.$t("common.select_default_text",[e.$t("pre_payment.deduct_from_payroll")])},{default:a(()=>[t(u,{value:1},{default:a(()=>[i(m(e.$t("pre_payment.on_given_payment_month")),1)]),_:1}),t(u,{value:0},{default:a(()=>[i(m(e.$t("pre_payment.another_month")),1)]),_:1})]),_:1},8,["value","placeholder"])])]),_:1},8,["label","help","validateStatus"])]),_:1}),e.formData.deduct_from_payroll=="0"?(s(),k(p,{key:0,xs:24,sm:24,md:12,lg:12},{default:a(()=>[t(y,{label:e.$t("pre_payment.month"),name:"month",help:e.rules.month?e.rules.month.message:null,validateStatus:e.rules.month?"error":null},{default:a(()=>[t(w,{value:e.monthYear,"onUpdate:value":l[5]||(l[5]=d=>e.monthYear=d),placeholder:e.$t("common.select_default_text",[e.$t("payroll.month")]),picker:"month",style:{width:"100%"},allowClear:!1},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})):g("",!0)]),_:1}),t(r,{gutter:16},{default:a(()=>[t(p,{xs:24,sm:24,md:24,lg:24},{default:a(()=>[t(y,{label:e.$t("pre_payment.notes"),name:"notes",help:e.rules.notes?e.rules.notes.message:null,validateStatus:e.rules.notes?"error":null,class:"required"},{default:a(()=>[t(E,{value:e.formData.notes,"onUpdate:value":l[6]||(l[6]=d=>e.formData.notes=d),placeholder:e.$t("common.placeholder_default_text",[e.$t("pre_payment.notes")]),rows:4},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1})]),_:1})]),_:1},8,["title","width","open","onClose"])}const Ue=q(Me,[["render",Te]]),Be={components:{PlusOutlined:H,EditOutlined:me,DeleteOutlined:ie,AddEdit:Ue,AdminPageHeader:De,DateRangePicker:Ae,PayrollSidebar:Se},setup(){const{t:e}=V(),{addEditUrl:l,initData:M,columns:n,filterableColumns:S,hashableColumns:O}=we(),u=fe(),{permsArray:f,appSetting:h,formatDate:y,formatAmountCurrency:p,formatDateTime:P}=K(),{getMonthNameByNumber:r}=ge(),$=B({payment_mode_id:void 0}),v=B({dates:[],user_id:void 0}),w=B([]),E=B([]),_="users?limit=10000";j(()=>{(f.value.includes("pre_payments_edit")||f.value.includes("pre_payments_delete")||f.value.includes("admin"))&&(n.value=[...n.value,{title:e("common.action"),dataIndex:"action"}]),D(),T(),u.crudUrl.value=l,u.langKey.value="pre_payment",u.initData.value={...M},u.formData.value={...M},u.hashableColumns.value=[...O]});const D=()=>{u.tableUrl.value={url:"pre-payments?fields=id,xid,user_id,x_user_id,user{id,xid,name},payment_mode_id,x_payment_mode_id,paymentMode{id,xid,name},amount,notes,payroll_year,payroll_month,date_time,deduct_from_payroll",filters:$,extraFilters:v},u.table.filterableColumns=S,u.fetch({page:1})},T=()=>{const A=axiosAdmin.get("payment-modes?limit=10000"),I=axiosAdmin.get(_);Promise.all([A,I]).then(([d,N])=>{w.value=d.data,E.value=N.data})};return{columns:n,...u,filterableColumns:S,permsArray:f,appSetting:h,formatDate:y,formatDateTime:P,filters:$,extraFilters:v,paymentModes:w,setUrlData:D,formatAmountCurrency:p,allUsers:E,getMonthNameByNumber:r}}},Oe={class:"table-responsive"};function Ie(e,l,M,n,S,O){const u=ue,f=c("router-link"),h=pe,y=_e,p=c("AdminPageHeader"),P=c("PayrollSidebar"),r=G,$=c("PlusOutlined"),v=J,w=c("DeleteOutlined"),E=Q,_=z,D=W,T=ye,A=L,I=c("admin-page-filters"),d=c("AddEdit"),N=c("EditOutlined"),X=ce,Z=c("admin-page-table-content");return s(),b(C,null,[t(p,null,{header:a(()=>[t(u,{title:e.$t("menu.pre_payments"),class:"p-0"},null,8,["title"])]),breadcrumb:a(()=>[t(y,{separator:"-",style:{"font-size":"12px"}},{default:a(()=>[t(h,null,{default:a(()=>[t(f,{to:{name:"admin.dashboard.index"}},{default:a(()=>[i(m(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),t(h,null,{default:a(()=>[i(m(e.$t("menu.hrm")),1)]),_:1}),t(h,null,{default:a(()=>[i(m(e.$t("menu.pre_payments")),1)]),_:1})]),_:1})]),_:1}),t(A,null,{default:a(()=>[t(r,{xs:24,sm:24,md:24,lg:4,xl:4,class:"bg-setting-sidebar"},{default:a(()=>[t(P)]),_:1}),t(r,{xs:24,sm:24,md:24,lg:20,xl:20},{default:a(()=>[t(I,null,{default:a(()=>[t(A,{gutter:[16,16]},{default:a(()=>[t(r,{xs:24,sm:24,md:12,lg:10,xl:10},{default:a(()=>[t(E,null,{default:a(()=>[n.permsArray.includes("pre_payments_create")||n.permsArray.includes("admin")?(s(),k(v,{key:0,type:"primary",onClick:e.addItem},{default:a(()=>[t($),i(" "+m(e.$t("pre_payment.add")),1)]),_:1},8,["onClick"])):g("",!0),e.table.selectedRowKeys.length>0&&(n.permsArray.includes("pre_payments_delete")||n.permsArray.includes("admin"))?(s(),k(v,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:a(()=>[t(w)]),default:a(()=>[i(" "+m(e.$t("common.delete")),1)]),_:1},8,["onClick"])):g("",!0)]),_:1})]),_:1}),t(r,{xs:24,sm:24,md:12,lg:14,xl:14},{default:a(()=>[t(A,{gutter:[16,16],justify:"end"},{default:a(()=>[n.permsArray.includes("pre_payments_view")||n.permsArray.includes("admin")?(s(),k(r,{key:0,xs:24,sm:24,md:12,lg:8,xl:8},{default:a(()=>[t(D,{value:n.extraFilters.user_id,"onUpdate:value":l[0]||(l[0]=o=>n.extraFilters.user_id=o),onChange:n.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("leave.user")]),allowClear:!0},{default:a(()=>[(s(!0),b(C,null,F(n.allUsers,o=>(s(),k(_,{key:o.xid,value:o.xid,title:o.name},{default:a(()=>[i(m(o.name),1)]),_:2},1032,["value","title"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):g("",!0),t(r,{xs:24,sm:24,md:8,lg:8,xl:6},{default:a(()=>[t(D,{value:n.filters.payment_mode_id,"onUpdate:value":l[1]||(l[1]=o=>n.filters.payment_mode_id=o),placeholder:e.$t("common.select_default_text",[e.$t("pre_payment.payment_mode_id")]),allowClear:!0,style:{width:"100%"},optionFilterProp:"title","show-search":"",onChange:n.setUrlData},{default:a(()=>[(s(!0),b(C,null,F(n.paymentModes,o=>(s(),k(_,{key:o.xid,title:o.name,value:o.xid},{default:a(()=>[i(m(o.name),1)]),_:2},1032,["title","value"]))),128))]),_:1},8,["value","placeholder","onChange"])]),_:1}),t(r,{xs:24,sm:24,md:8,lg:8,xl:8},{default:a(()=>[t(T,{format:n.appSetting.date_format,valueFormat:"YYYY-MM-DD",value:n.extraFilters.dates,"onUpdate:value":l[2]||(l[2]=o=>n.extraFilters.dates=o),style:{width:"100%"},onChange:n.setUrlData},null,8,["format","value","onChange"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(Z,null,{default:a(()=>[t(d,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,formData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","formData","data","pageTitle","successMessage"]),t(A,null,{default:a(()=>[t(r,{span:24},{default:a(()=>[Y("div",Oe,[t(X,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:o=>({disabled:!1,name:o.xid})},columns:n.columns,"row-key":o=>o.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},{bodyCell:a(({column:o,record:U})=>[o.dataIndex=="date_time"?(s(),b(C,{key:0},[i(m(n.formatDateTime(U.date_time)),1)],64)):g("",!0),o.dataIndex=="user_id"?(s(),b(C,{key:1},[i(m(U.user.name),1)],64)):g("",!0),o.dataIndex=="amount"?(s(),b(C,{key:2},[i(m(n.formatAmountCurrency(U.amount)),1)],64)):g("",!0),o.dataIndex=="payment_mode_id"?(s(),b(C,{key:3},[i(m(U.payment_mode.name),1)],64)):g("",!0),o.dataIndex=="deduct_month"?(s(),b(C,{key:4},[i(m(n.getMonthNameByNumber(U.payroll_month))+" "+m(U.payroll_year),1)],64)):g("",!0),o.dataIndex==="action"?(s(),b(C,{key:5},[n.permsArray.includes("pre_payments_edit")||n.permsArray.includes("admin")?(s(),k(v,{key:0,type:"primary",onClick:x=>e.editItem(U),style:{"margin-left":"4px"}},{icon:a(()=>[t(N)]),_:2},1032,["onClick"])):g("",!0),n.permsArray.includes("pre_payments_delete")||n.permsArray.includes("admin")?(s(),k(v,{key:1,type:"primary",onClick:x=>e.showDeleteConfirm(U.xid),style:{"margin-left":"4px"}},{icon:a(()=>[t(w)]),_:2},1032,["onClick"])):g("",!0)],64)):g("",!0)]),_:1},8,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)}const sa=q(Be,[["render",Ie]]);export{sa as default};

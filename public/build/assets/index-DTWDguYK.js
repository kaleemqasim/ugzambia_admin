import{_ as ee,d as oe,r as p,o as l,i as _,w as o,a as t,X as se,aw as le,R as re,az as ie,aA as ue,at as de,aT as me,Y as ce,f as y,b as pe,z as _e,E as ye,a6 as Z,V as fe,c as f,G as g,ax as H,l as d,t as c,k as i,M as Q,j as ge,ay as ve,aB as be,aC as he,B as Ce,a0 as ke,q as we,aD as Te,aE as Ue,aF as De,h as Se,an as Ee,ao as Ae,ar as Oe,bk as Ie,J as Ke,aG as Ve}from"./app-Dj1Is9gq.js";import{c as Me}from"./crud-CrvpJwtV.js";import{A as Fe,f as Be}from"./fields-21Wari_1.js";import{U as Pe}from"./UserInfo-DaXkV2_v.js";import{S as Re}from"./StateWidget-CQc6jJWq.js";import{A as Ne}from"./AdminPageHeader-Bk6Suxy_.js";import{T as ze,U as He,a as Le}from"./View-C06VfLZB.js";import{I as We}from"./Import-CrIojB6U.js";import{a as $e}from"./apiAdmin-DXyoDADi.js";import{A as je,a as qe}from"./ArrowUpOutlined-DcPs1WPA.js";import{S as Ge}from"./SaveOutlined-CEkVke7n.js";import{C as Ye}from"./CloudDownloadOutlined-BvG1hT6f.js";import"./datatable-BbN5BpFL.js";import"./filter-CEEEiwR2.js";import"./Upload-BlHzAAld.js";import"./AddButton-X98DiJfJ.js";import"./AddEdit-DC92yLfl.js";import"./SettingOutlined-JuYX6Rqg.js";import"./AddButton-CyvOkgxH.js";import"./AddEdit-zjwyjNyM.js";import"./index-AZVEloNj.js";import"./UploadFile-BMQyS_v_.js";const xe=oe({props:["visible","user"],components:{Transactions:ze},setup(e,{emit:u}){const{loading:k,rules:a}=$e();return{loading:k,rules:a,onClose:()=>{u("closed")}}}});function Je(e,u,k,a,F,L){const A=p("Transactions"),O=se;return l(),_(O,{open:e.visible,centered:!0,title:e.$t("payments.transactions"),onCancel:e.onClose,width:"40%",footer:!1},{default:o(()=>[t(A,{user_id:e.user.xid,result_type:e.user.user_type=="staff_members"?"staff_member":"customer_supplier"},null,8,["user_id","result_type"])]),_:1},8,["open","title","onCancel"])}const Xe=ee(xe,[["render",Je]]),Qe={components:{EyeOutlined:le,PlusOutlined:re,EditOutlined:ie,DeleteOutlined:ue,ArrowUpOutlined:je,ArrowDownOutlined:qe,AddEdit:Fe,UserInfo:Pe,StateWidget:Re,AdminPageHeader:Ne,UserBalance:He,UserView:Le,ImportUsers:We,UserTransaction:Xe,SyncOutlined:de,SaveOutlined:Ge,LoadingOutlined:me,CloudDownloadOutlined:Ye},setup(){const{t:e}=ce(),u=y(!1),k=y(!1),a=y(0),{statusColors:F,userStatus:L,permsArray:A,formatDateTime:O,user:I,selectedWarehouse:W,formatAmountCurrency:$}=pe(),{supplierInitData:B,customerInitData:v,staffMemberInitData:P,columns:j,supplierCustomerColumns:K,filterableColumns:V}=Be(),r=Me(),C=_e(),b=y(C.meta.menuKey),q="?fields=id,district,ministry,province,total,period,nrc_no,man_no,employee_no,xid,user_type,name,email,profile_image,profile_image_url,is_walkin_customer,phone,address,shipping_address,status,tax_number,created_at,details{opening_balance,opening_balance_type,credit_period,credit_limit,due_amount,warehouse_id,x_warehouse_id},details:warehouse{id,xid,name},role_id,role{id,xid,name,display_name},warehouse_id,x_warehouse_id,warehouse{xid,name},userWarehouses{user_id,x_user_id,warehouse_id,x_warehouse_id}",w=y(void 0),T=y("all"),U=y("all"),S=y([]),h=y(""),D=y(""),E=y(""),M=y(!1),R=y(""),G=s=>{M.value=!0,R.value=s},Y=()=>{M.value=!1},x=async()=>{u.value=!0;const s=new Date,m=s.getFullYear(),ae=s.getMonth()+1,te=`${m}${ae.toString().padStart(2,"0")}`;try{const ne=await axiosAdmin.get(`period-api-data-import-session/${te}`);H.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully fetched in session"})}catch{H.error({placement:"topRight",message:e("common.error"),description:"Something went wrong"})}finally{u.value=!1}},J=async()=>{k.value=!0;try{const s=await axiosAdmin.get("process-session-import-data");H.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully saved in the database"})}catch{H.error({placement:"topRight",message:e("common.error"),description:"No employees found in session"})}finally{k.value=!1}};ye(()=>{n(),r.table.filterableColumns=V,N(),X()});const X=async()=>{try{axiosAdmin.get("total-member").then(s=>{a.value=s.data.data??0})}catch{console.log("something went wrong")}},N=()=>{b.value=="suppliers"?(r.initData.value={...B},r.formData.value={...B},r.langKey.value="supplier",S.value=K,h.value=window.config.supplier_sample_file,D.value=e("supplier.import_suppliers"),E.value="suppliers/import"):b.value=="customers"?(r.initData.value={...v},r.formData.value={...v},r.langKey.value="customer",S.value=K,h.value=window.config.customer_sample_file,D.value=e("customer.import_customers"),E.value="customers/import"):(r.initData.value={...P},r.formData.value={...P},r.langKey.value="staff_member",S.value=j,h.value=window.config.staff_member_sample_file,D.value=e("staff_member.import_staff_members"),E.value="users/import"),r.restFormData()},n=()=>{r.crudUrl.value=b.value;var s="",m={};w.value!=null&&w.value!="all"&&(s+=`status eq "${w.value}"`),U.value!=null&&U.value!="all"&&b.value!="users"&&(m.search_due_type=U.value),r.tableUrl.value={url:`${b.value}${q}`,filterString:s,extraFilters:m},r.fetch({page:1})};Z(()=>C.meta.menuKey,(s,m)=>{(C.meta.menuKey=="users"||C.meta.menuKey=="customers"||C.meta.menuKey=="suppliers")&&(b.value=C.meta.menuKey,w.value=void 0,r.table.searchColumn=void 0,r.table.searchString="",U.value="all",n(),N())}),Z(W,(s,m)=>{n()});const z=fe(()=>{let s=0;return r.table.data.forEach(m=>{m&&m.details&&m.details.due_amount&&(s+=m.details.due_amount)}),{totalOpeningBalance:s}});return{statusColors:F,userStatus:L,filterableColumns:V,userType:b,tableColumns:S,searchStatus:w,setUrlData:n,searchDueType:U,activeTabKey:T,...r,permsArray:A,transactionVisible:M,formatDateTime:O,user:I,formatAmountCurrency:$,sampleFileUrl:h,importPageTitle:D,importUrl:E,totals:z,onCloseTransactions:Y,openTransactions:G,modelData:R,syncEmployees:x,updateEmployees:J,isSyncing:u,isUpdating:k,totalMembers:a}}},Ze={class:"table-responsive"};function ea(e,u,k,a,F,L){const A=ve,O=p("router-link"),I=be,W=he,$=p("AdminPageHeader"),B=p("SyncOutlined"),v=Ce,P=p("SaveOutlined"),j=p("ImportUsers"),K=ke,V=p("DeleteOutlined"),r=we,C=Ve,b=Te,q=Ue,w=De,T=Se,U=p("admin-page-filters"),S=p("AddEdit"),h=Ee,D=Ae,E=p("user-info"),M=Oe,R=Ie,G=p("EyeOutlined"),Y=p("EditOutlined"),x=Ke,J=p("UserView"),X=p("UserTransaction"),N=p("admin-page-table-content");return l(),f(g,null,[t($,null,{header:o(()=>[t(A,{title:e.$t(`menu.${e.langKey}s`),class:"p-0"},null,8,["title"])]),breadcrumb:o(()=>[t(W,{separator:"-",style:{"font-size":"12px"}},{default:o(()=>[t(I,null,{default:o(()=>[t(O,{to:{name:"admin.dashboard.index"}},{default:o(()=>[d(c(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),t(I,null,{default:o(()=>[d(c(e.$t("menu.parties")),1)]),_:1}),t(I,null,{default:o(()=>[d(c(e.$t(`menu.${e.langKey}s`)),1)]),_:1})]),_:1})]),_:1}),t(U,null,{default:o(()=>[t(T,{gutter:[16,16]},{default:o(()=>[t(r,{xs:24,sm:24,md:12,lg:10,xl:10},{default:o(()=>[t(K,null,{default:o(()=>[a.permsArray.includes(`${a.userType}_create`)||a.permsArray.includes("admin")?(l(),_(K,{key:0},{default:o(()=>[t(v,{type:"primary",onClick:a.syncEmployees,loading:a.isSyncing},{default:o(()=>[a.isSyncing?i("",!0):(l(),_(B,{key:0})),d(" Sync Employees ")]),_:1},8,["onClick","loading"]),t(v,{type:"primary",onClick:a.updateEmployees,loading:a.isUpdating},{default:o(()=>[a.isUpdating?i("",!0):(l(),_(P,{key:0})),d(" Update Employees ")]),_:1},8,["onClick","loading"]),t(v,{type:"primary"},{default:o(()=>[d(c(a.totalMembers)+" Members ",1)]),_:1}),t(j,{pageTitle:a.importPageTitle,sampleFileUrl:a.sampleFileUrl,importUrl:a.importUrl,onOnUploadSuccess:a.setUrlData},null,8,["pageTitle","sampleFileUrl","importUrl","onOnUploadSuccess"])]),_:1})):i("",!0),e.table.selectedRowKeys.length>0&&(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))?(l(),_(v,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:o(()=>[t(V)]),default:o(()=>[d(" "+c(e.$t("common.delete")),1)]),_:1},8,["onClick"])):i("",!0)]),_:1})]),_:1}),t(r,{xs:24,sm:24,md:12,lg:14,xl:14},{default:o(()=>[t(T,{gutter:[16,16],justify:"end"},{default:o(()=>[t(r,{xs:24,sm:24,md:12,lg:8,xl:8},{default:o(()=>[t(w,{compact:""},{default:o(()=>[t(b,{style:{width:"25%"},value:e.table.searchColumn,"onUpdate:value":u[0]||(u[0]=n=>e.table.searchColumn=n),placeholder:e.$t("common.select_default_text",[""])},{default:o(()=>[(l(!0),f(g,null,Q(a.filterableColumns,n=>(l(),_(C,{key:n.key},{default:o(()=>[d(c(n.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),t(q,{style:{width:"75%"},value:e.table.searchString,"onUpdate:value":u[1]||(u[1]=n=>e.table.searchString=n),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,loading:e.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1}),a.userType&&a.userType!="users"?(l(),_(r,{key:0,xs:24,sm:24,md:12,lg:6,xl:6},{default:o(()=>[t(b,{value:a.searchStatus,"onUpdate:value":u[2]||(u[2]=n=>a.searchStatus=n),onChange:a.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("user.status")]),allowClear:!0,optionFilterProp:"label"},{default:o(()=>[(l(!0),f(g,null,Q(a.userStatus,n=>(l(),_(C,{key:n.key,value:n.key,label:n.value},{default:o(()=>[d(c(n.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):i("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(N,null,{default:o(()=>[t(S,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,addEditData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","addEditData","data","pageTitle","successMessage"]),a.userType&&a.userType=="users"?(l(),_(T,{key:0},{default:o(()=>[t(r,{span:24},{default:o(()=>[t(D,{activeKey:a.searchStatus,"onUpdate:activeKey":u[3]||(u[3]=n=>a.searchStatus=n),onChange:a.setUrlData},{default:o(()=>[t(h,{key:"all",tab:`${e.$t("common.all")} ${e.$t("menu.users")}`},null,8,["tab"]),(l(!0),f(g,null,Q(a.userStatus,n=>(l(),_(h,{key:n.key,tab:`${n.value} ${e.$t("menu.users")}`},null,8,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):i("",!0),a.userType&&a.userType!="users"?(l(),_(T,{key:1},{default:o(()=>[t(r,{span:24},{default:o(()=>[t(D,{activeKey:a.searchDueType,"onUpdate:activeKey":u[4]||(u[4]=n=>a.searchDueType=n),onChange:a.setUrlData},{default:o(()=>[t(h,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),t(h,{key:"receive",tab:`${e.$t("user.to_receive")}`},null,8,["tab"]),t(h,{key:"pay",tab:`${e.$t("user.to_pay")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):i("",!0),t(T,{gutter:[15,15]},{default:o(()=>[t(r,{span:24},{default:o(()=>[ge("div",Ze,[t(x,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:n=>({disabled:!!(a.user.xid==n.xid||n.is_walkin_customer),name:n.xid})},columns:a.tableColumns,"row-key":n=>n.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},{bodyCell:o(({column:n,text:z,record:s})=>[n.dataIndex==="name"?(l(),_(M,{key:0,type:"primary",onClick:m=>e.viewItem(s)},{default:o(()=>[t(E,{user:s},null,8,["user"])]),_:2},1032,["onClick"])):i("",!0),n.dataIndex==="status"?(l(),_(R,{key:1,color:a.statusColors[z]},{default:o(()=>[d(c(e.$t(`common.${z}`)),1)]),_:2},1032,["color"])):i("",!0),n.dataIndex==="ministry"?(l(),f(g,{key:2},[d(c(s.ministry),1)],64)):i("",!0),n.dataIndex==="nrc_no"?(l(),f(g,{key:3},[d(c(s.nrc_no),1)],64)):i("",!0),n.dataIndex==="man_no"?(l(),f(g,{key:4},[d(c(s.man_no),1)],64)):i("",!0),n.dataIndex==="employee_id"?(l(),f(g,{key:5},[d(c(s.employee_id),1)],64)):i("",!0),n.dataIndex==="total"?(l(),f(g,{key:6},[d(c(s.total),1)],64)):i("",!0),n.dataIndex==="period"?(l(),f(g,{key:7},[d(c(s.period),1)],64)):i("",!0),n.dataIndex==="created_at"?(l(),f(g,{key:8},[d(c(a.formatDateTime(s.created_at)),1)],64)):i("",!0),n.dataIndex==="action"?(l(),f(g,{key:9},[t(v,{type:"primary",onClick:m=>e.viewItem(s),style:{"margin-left":"4px"}},{icon:o(()=>[t(G)]),_:2},1032,["onClick"]),a.permsArray.includes(`${a.userType}_edit`)||a.permsArray.includes("admin")?(l(),_(v,{key:0,type:"primary",onClick:m=>e.editItem(s),style:{"margin-left":"4px"}},{icon:o(()=>[t(Y)]),_:2},1032,["onClick"])):i("",!0),(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))&&a.user.xid!=s.xid&&!s.is_walkin_customer?(l(),_(v,{key:1,type:"primary",onClick:m=>e.showDeleteConfirm(s.xid),style:{"margin-left":"4px"}},{icon:o(()=>[t(V)]),_:2},1032,["onClick"])):i("",!0)],64)):i("",!0)]),_:1},8,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),t(J,{user:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["user","visible","onClosed"]),t(X,{user:a.modelData,visible:a.transactionVisible,onClosed:a.onCloseTransactions},null,8,["user","visible","onClosed"])]),_:1})],64)}const wa=ee(Qe,[["render",ea]]);export{wa as default};

import{_ as se,d as le,r as _,o as s,i as p,w as t,a as n,X as re,aw as ie,R as ue,az as de,aA as me,at as ce,aT as pe,Y as _e,f,b as ye,z as fe,E as ge,a6 as oe,V as ve,c as g,G as b,ax as G,l as i,t as c,k as u,M as te,j as be,ab as he,ay as Ce,aB as we,aC as ke,B as Te,a0 as De,q as Se,aD as Ae,aE as Ee,aF as Ue,h as Oe,an as Ke,ao as Ie,ar as Ve,bk as Be,aL as Me,aM as Fe,H as Pe,aN as Re,J as Ne,aG as ze}from"./app-D4MLQDBq.js";import{c as He}from"./crud-D3Rid15-.js";import{A as Le,f as We}from"./fields-DjU54IsK.js";import{U as je}from"./UserInfo-BbdWX85T.js";import{S as qe}from"./StateWidget-BFx9e5CO.js";import{A as Ge}from"./AdminPageHeader-mLYJ9Qzy.js";import{T as Ye,U as Je,a as Xe}from"./View-C20TLq9N.js";import{I as $e}from"./Import-BocXLPKV.js";import{a as xe}from"./apiAdmin-RdnAj9yx.js";import{A as Qe,a as Ze}from"./ArrowUpOutlined-Dn2Of1J3.js";import{S as ea}from"./SaveOutlined-obpPvnis.js";import{C as aa}from"./CloudDownloadOutlined-RfBvcyTm.js";import"./datatable-LegXxyA7.js";import"./filter-CI_FjftV.js";import"./Upload-CIoROJEZ.js";import"./AddButton-C7peUqHJ.js";import"./AddEdit-Boaqf196.js";import"./SettingOutlined-DCcbq3Qt.js";import"./AddButton-DYmOXGDY.js";import"./AddEdit-hBxBQJx9.js";import"./index-BPnlttH6.js";import"./UploadFile-DbJ_Q7Kz.js";const na=le({props:["visible","user"],components:{Transactions:Ye},setup(e,{emit:d}){const{loading:D,rules:a}=xe();return{loading:D,rules:a,onClose:()=>{d("closed")}}}});function ta(e,d,D,a,R,Y){const I=_("Transactions"),V=re;return s(),p(V,{open:e.visible,centered:!0,title:e.$t("payments.transactions"),onCancel:e.onClose,width:"40%",footer:!1},{default:t(()=>[n(I,{user_id:e.user.xid,result_type:e.user.user_type=="staff_members"?"staff_member":"customer_supplier"},null,8,["user_id","result_type"])]),_:1},8,["open","title","onCancel"])}const oa=se(na,[["render",ta]]),sa={components:{EyeOutlined:ie,PlusOutlined:ue,EditOutlined:de,DeleteOutlined:me,ArrowUpOutlined:Qe,ArrowDownOutlined:Ze,AddEdit:Le,UserInfo:je,StateWidget:qe,AdminPageHeader:Ge,UserBalance:Je,UserView:Xe,ImportUsers:$e,UserTransaction:oa,SyncOutlined:ce,SaveOutlined:ea,LoadingOutlined:pe,CloudDownloadOutlined:aa},setup(){const{t:e}=_e(),d=f(!1),D=f(!1),a=f(0),{statusColors:R,userStatus:Y,permsArray:I,formatDateTime:V,user:B,selectedWarehouse:J,formatAmountCurrency:X}=ye(),{supplierInitData:N,customerInitData:h,staffMemberInitData:z,columns:H,supplierCustomerColumns:M,filterableColumns:C}=We(),l=He(),k=fe(),T=f(k.meta.menuKey),$="?fields=id,district,ministry,province,nrc_no,man_no,employee_no,xid,user_type,name,email,profile_image,profile_image_url,is_walkin_customer,phone,address,shipping_address,status,tax_number,created_at,details{opening_balance,opening_balance_type,credit_period,credit_limit,due_amount,warehouse_id,x_warehouse_id},details:warehouse{id,xid,name},role_id,role{id,xid,name,display_name},warehouse_id,x_warehouse_id,warehouse{xid,name},userWarehouses{user_id,x_user_id,warehouse_id,x_warehouse_id}",v=f(void 0),x=f("all"),S=f("all"),w=f([]),A=f(""),E=f(""),U=f(""),F=f(!1),L=f(""),Q=r=>{F.value=!0,L.value=r},O=()=>{F.value=!1},W=async()=>{d.value=!0;const r=new Date,m=r.getFullYear(),ae=r.getMonth()+1,o=`${m}${ae.toString().padStart(2,"0")}`;try{const P=await axiosAdmin.get(`period-api-data-import-session/${o}`);G.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully fetched in session"})}catch(P){G.error({placement:"topRight",message:e("common.error"),description:"Something went wrong"}),console.error("Error syncing employees:",P)}finally{d.value=!1}},Z=async()=>{var r;D.value=!0;try{const m=await axiosAdmin.get("process-session-import-data");G.success({placement:"topRight",message:e("common.success"),description:"Employees updated data has been successfully saved in the database"})}catch(m){G.error({placement:"topRight",message:e("common.error"),description:((r=m.response)==null?void 0:r.status)===404?"No employees found in session":"An error occurred while updating employees"}),console.error("Error updating employees:",m)}finally{D.value=!1}};ge(()=>{K(),l.table.filterableColumns=C,q(),j()});const j=async()=>{try{axiosAdmin.get("total-member").then(r=>{a.value=r.data.data??0})}catch{console.log("something went wrong")}},q=()=>{T.value=="suppliers"?(l.initData.value={...N},l.formData.value={...N},l.langKey.value="supplier",w.value=M,A.value=window.config.supplier_sample_file,E.value=e("supplier.import_suppliers"),U.value="suppliers/import"):T.value=="customers"?(l.initData.value={...h},l.formData.value={...h},l.langKey.value="customer",w.value=M,A.value=window.config.customer_sample_file,E.value=e("customer.import_customers"),U.value="customers/import"):(l.initData.value={...z},l.formData.value={...z},l.langKey.value="staff_member",w.value=H,A.value=window.config.staff_member_sample_file,E.value=e("staff_member.import_staff_members"),U.value="users/import"),l.restFormData()},K=()=>{l.crudUrl.value=T.value;var r="",m={};v.value!=null&&v.value!="all"&&(r+=`status eq "${v.value}"`),S.value!=null&&S.value!="all"&&T.value!="users"&&(m.search_due_type=S.value),l.tableUrl.value={url:`${T.value}${$}`,filterString:r,extraFilters:m},l.fetch({page:1})};oe(()=>k.meta.menuKey,(r,m)=>{(k.meta.menuKey=="users"||k.meta.menuKey=="customers"||k.meta.menuKey=="suppliers")&&(T.value=k.meta.menuKey,v.value=void 0,l.table.searchColumn=void 0,l.table.searchString="",S.value="all",K(),q())}),oe(J,(r,m)=>{K()});const ee=ve(()=>{let r=0;return l.table.data.forEach(m=>{m&&m.details&&m.details.due_amount&&(r+=m.details.due_amount)}),{totalOpeningBalance:r}});return{statusColors:R,userStatus:Y,filterableColumns:C,userType:T,tableColumns:w,searchStatus:v,setUrlData:K,searchDueType:S,activeTabKey:x,...l,permsArray:I,transactionVisible:F,formatDateTime:V,user:B,formatAmountCurrency:X,sampleFileUrl:A,importPageTitle:E,importUrl:U,totals:ee,onCloseTransactions:O,openTransactions:Q,modelData:L,syncEmployees:W,updateEmployees:Z,isSyncing:d,isUpdating:D,totalMembers:a}}},la={class:"table-responsive"},ra={key:0};function ia(e,d,D,a,R,Y){const I=Ce,V=_("router-link"),B=we,J=ke,X=_("AdminPageHeader"),N=_("SyncOutlined"),h=Te,z=_("SaveOutlined"),H=De,M=_("DeleteOutlined"),C=Se,l=ze,k=Ae,T=Ee,$=Ue,v=Oe,x=_("admin-page-filters"),S=_("AddEdit"),w=Ke,A=Ie,E=_("user-info"),U=Ve,F=Be,L=_("EyeOutlined"),Q=_("EditOutlined"),O=Me,W=Fe,Z=_("ArrowUpOutlined"),j=Pe,q=_("ArrowDownOutlined"),K=Re,ee=Ne,r=_("UserView"),m=_("UserTransaction"),ae=_("admin-page-table-content");return s(),g(b,null,[n(X,null,{header:t(()=>[n(I,{title:e.$t(`menu.${e.langKey}s`),class:"p-0"},null,8,["title"])]),breadcrumb:t(()=>[n(J,{separator:"-",style:{"font-size":"12px"}},{default:t(()=>[n(B,null,{default:t(()=>[n(V,{to:{name:"admin.dashboard.index"}},{default:t(()=>[i(c(e.$t("menu.dashboard")),1)]),_:1},8,["to"])]),_:1}),n(B,null,{default:t(()=>[i(c(e.$t("menu.parties")),1)]),_:1}),n(B,null,{default:t(()=>[i(c(e.$t(`menu.${e.langKey}s`)),1)]),_:1})]),_:1})]),_:1}),n(x,null,{default:t(()=>[n(v,{gutter:[16,16]},{default:t(()=>[n(C,{xs:24,sm:24,md:12,lg:10,xl:10},{default:t(()=>[n(H,null,{default:t(()=>[a.permsArray.includes(`${a.userType}_create`)||a.permsArray.includes("admin")?(s(),p(H,{key:0},{default:t(()=>[n(h,{type:"primary",onClick:a.syncEmployees,loading:a.isSyncing},{default:t(()=>[a.isSyncing?u("",!0):(s(),p(N,{key:0})),i(" Sync Employees ")]),_:1},8,["onClick","loading"]),n(h,{type:"primary",onClick:a.updateEmployees,loading:a.isUpdating},{default:t(()=>[a.isUpdating?u("",!0):(s(),p(z,{key:0})),i(" Update Employees ")]),_:1},8,["onClick","loading"]),n(h,{type:"primary"},{default:t(()=>[i(c(a.totalMembers)+" Members ",1)]),_:1})]),_:1})):u("",!0),e.table.selectedRowKeys.length>0&&(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))?(s(),p(h,{key:1,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:t(()=>[n(M)]),default:t(()=>[i(" "+c(e.$t("common.delete")),1)]),_:1},8,["onClick"])):u("",!0)]),_:1})]),_:1}),n(C,{xs:24,sm:24,md:12,lg:14,xl:14},{default:t(()=>[n(v,{gutter:[16,16],justify:"end"},{default:t(()=>[n(C,{xs:24,sm:24,md:12,lg:8,xl:8},{default:t(()=>[n($,{compact:""},{default:t(()=>[n(k,{style:{width:"25%"},value:e.table.searchColumn,"onUpdate:value":d[0]||(d[0]=o=>e.table.searchColumn=o),placeholder:e.$t("common.select_default_text",[""])},{default:t(()=>[(s(!0),g(b,null,te(a.filterableColumns,o=>(s(),p(l,{key:o.key},{default:t(()=>[i(c(o.value),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"]),n(T,{style:{width:"75%"},value:e.table.searchString,"onUpdate:value":d[1]||(d[1]=o=>e.table.searchString=o),"show-search":"",onChange:e.onTableSearch,onSearch:e.onTableSearch,loading:e.table.filterLoading},null,8,["value","onChange","onSearch","loading"])]),_:1})]),_:1}),a.userType&&a.userType!="users"?(s(),p(C,{key:0,xs:24,sm:24,md:12,lg:6,xl:6},{default:t(()=>[n(k,{value:a.searchStatus,"onUpdate:value":d[2]||(d[2]=o=>a.searchStatus=o),onChange:a.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("user.status")]),allowClear:!0,optionFilterProp:"label"},{default:t(()=>[(s(!0),g(b,null,te(a.userStatus,o=>(s(),p(l,{key:o.key,value:o.key,label:o.value},{default:t(()=>[i(c(o.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):u("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n(ae,null,{default:t(()=>[n(S,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,addEditData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","addEditData","data","pageTitle","successMessage"]),a.userType&&a.userType=="users"?(s(),p(v,{key:0},{default:t(()=>[n(C,{span:24},{default:t(()=>[n(A,{activeKey:a.searchStatus,"onUpdate:activeKey":d[3]||(d[3]=o=>a.searchStatus=o),onChange:a.setUrlData},{default:t(()=>[n(w,{key:"all",tab:`${e.$t("common.all")} ${e.$t("menu.users")}`},null,8,["tab"]),(s(!0),g(b,null,te(a.userStatus,o=>(s(),p(w,{key:o.key,tab:`${o.value} ${e.$t("menu.users")}`},null,8,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):u("",!0),a.userType&&a.userType!="users"?(s(),p(v,{key:1},{default:t(()=>[n(C,{span:24},{default:t(()=>[n(A,{activeKey:a.searchDueType,"onUpdate:activeKey":d[4]||(d[4]=o=>a.searchDueType=o),onChange:a.setUrlData},{default:t(()=>[n(w,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),n(w,{key:"receive",tab:`${e.$t("user.to_receive")}`},null,8,["tab"]),n(w,{key:"pay",tab:`${e.$t("user.to_pay")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1})):u("",!0),n(v,{gutter:[15,15]},{default:t(()=>[n(C,{span:24},{default:t(()=>[be("div",la,[n(ee,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:o=>({disabled:!!(a.user.xid==o.xid||o.is_walkin_customer),name:o.xid})},columns:a.tableColumns,"row-key":o=>o.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},he({bodyCell:t(({column:o,text:P,record:y})=>[o.dataIndex==="name"?(s(),p(U,{key:0,type:"primary",onClick:ne=>e.viewItem(y)},{default:t(()=>[n(E,{user:y},null,8,["user"])]),_:2},1032,["onClick"])):u("",!0),o.dataIndex==="status"?(s(),p(F,{key:1,color:a.statusColors[P]},{default:t(()=>[i(c(e.$t(`common.${P}`)),1)]),_:2},1032,["color"])):u("",!0),o.dataIndex==="ministry"?(s(),g(b,{key:2},[i(c(y.ministry),1)],64)):u("",!0),o.dataIndex==="nrc_no"?(s(),g(b,{key:3},[i(c(y.nrc_no),1)],64)):u("",!0),o.dataIndex==="man_no"?(s(),g(b,{key:4},[i(c(y.man_no),1)],64)):u("",!0),o.dataIndex==="employee_id"?(s(),g(b,{key:5},[i(c(y.employee_id),1)],64)):u("",!0),o.dataIndex==="total"?(s(),g(b,{key:6},[i(c(y.total),1)],64)):u("",!0),o.dataIndex==="created_at"?(s(),g(b,{key:7},[i(c(a.formatDateTime(y.created_at)),1)],64)):u("",!0),o.dataIndex==="action"?(s(),g(b,{key:8},[n(h,{type:"primary",onClick:ne=>e.viewItem(y),style:{"margin-left":"4px"}},{icon:t(()=>[n(L)]),_:2},1032,["onClick"]),a.permsArray.includes(`${a.userType}_edit`)||a.permsArray.includes("admin")?(s(),p(h,{key:0,type:"primary",onClick:ne=>e.editItem(y),style:{"margin-left":"4px"}},{icon:t(()=>[n(Q)]),_:2},1032,["onClick"])):u("",!0),(a.permsArray.includes(`${a.userType}_delete`)||a.permsArray.includes("admin"))&&a.user.xid!=y.xid&&!y.is_walkin_customer?(s(),p(h,{key:1,type:"primary",onClick:ne=>e.showDeleteConfirm(y.xid),style:{"margin-left":"4px"}},{icon:t(()=>[n(M)]),_:2},1032,["onClick"])):u("",!0)],64)):u("",!0)]),_:2},[a.userType&&a.userType!="users"?{name:"summary",fn:t(()=>[n(K,null,{default:t(()=>[n(O,{"col-span":1}),n(O,{"col-span":2}),n(O,{"col-span":1},{default:t(()=>[n(W,{strong:""},{default:t(()=>[i(c(e.$t("common.total")),1)]),_:1})]),_:1}),n(O,{"col-span":1},{default:t(()=>[n(W,{strong:""},{default:t(()=>[a.totals.totalOpeningBalance<0?(s(),p(j,{key:0},{default:t(()=>[n(Z,{style:{color:"red"}}),i(" "+c(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1})):(s(),p(j,{key:1},{default:t(()=>[a.totals.totalOpeningBalance>0?(s(),g("span",ra,[n(q,{style:{color:"green"}})])):u("",!0),i(" "+c(a.formatAmountCurrency(a.totals.totalOpeningBalance)),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1}),n(r,{user:e.viewData,visible:e.detailsVisible,onClosed:e.onCloseDetails},null,8,["user","visible","onClosed"]),n(m,{user:a.modelData,visible:a.transactionVisible,onClosed:a.onCloseTransactions},null,8,["user","visible","onClosed"])]),_:1})],64)}const Ka=se(sa,[["render",ia]]);export{Ka as default};

import{Y as w,_ as U,d as I,Q as M,aT as V,aU as A,r as E,V as L,a6 as N,o as f,g as c,w as a,a as t,j as m,t as _,i as h,c as F,L as P,D as W,ak as j,I as G,m as H,q as Q,f as R,aG as X,aD as Y,a_ as z,p as S,B as J,F as K,X as Z}from"./app-OikDM5Kw.js";import{a as ee}from"./apiAdmin-yFrp6bZq.js";import{F as ae}from"./FormItemHeading-C_zGUfEl.js";import{S as te}from"./SaveOutlined-BSR-wlKo.js";import{s as le}from"./sumBy-DFoExBWY.js";import{f as ne}from"./filter-CQCFHrIe.js";import{s as $}from"./some-BxTyXH2q.js";const ye=()=>{const e="taxes?fields=id,xid,name,rate,tax_type,x_parent_id,parent_id,multipleTax{id,xid,name,rate,tax_type,x_parent_id,parent_id}&filters=parent_id eq null",l="taxes",{t:u}=w(),b=["parent_id"],y={name:"",rate:"",tax_type:"single"},g=[{title:u("tax.name"),dataIndex:"name",sorter:!0},{title:u("tax.tax_type"),dataIndex:"tax_type",sorter:!0},{title:u("tax.rate"),dataIndex:"rate",sorter:!0},{title:u("common.action"),dataIndex:"action"}],n=[{key:"name",value:u("tax.name")}];return{url:e,addEditUrl:l,initData:y,columns:g,filterableColumns:n,hashableColumns:b}},oe=I({props:["formData","data","visible","url","addEditType","pageTitle","successMessage"],components:{PlusOutlined:M,LoadingOutlined:V,SaveOutlined:te,MinusSquareOutlined:A,FormItemHeading:ae},setup(e,{emit:l}){const{addEditRequestAdmin:u,loading:b,rules:y}=ee(),g=E([]),n=E([{tax_name:"",rate:"",id:void 0}]),i=()=>{var r=ne(n.value,function(s){return s.tax_name!=""&&s.rate&&s.rate>0}),p={...e.formData,multiple_taxes:r,removed_fields:g.value};u({url:e.url,data:p,successMessage:e.successMessage,success:s=>{l("addEditSuccess",s.xid)}})},d=L(()=>n.value.length==0?!1:$(n.value,{tax_name:""})||$(n.value,{tax_name:null})||$(n.value,{rate:""})||$(n.value,{rate:null})),v=()=>{n.value.push({tax_name:"",rate:"",id:""})},k=r=>{let p=n.value.indexOf(r);p!==-1&&n.value.splice(p,1),r.id!=""&&g.value.push(r.id)},D=()=>{y.value={},l("closed")};return N(()=>e.visible,(r,p)=>{e.visible&&(n.value=[],e.addEditType=="add"?n.value.push({tax_name:"",rate:"",id:""}):j(e.data.multiple_tax,s=>{n.value.push({tax_name:s.name,rate:s.rate,id:s.xid})}))}),{loading:b,rules:y,onClose:D,onSubmit:i,removeFormField:k,formFields:n,addFormField:v,addFormButtonStatus:d,sumBy:le,drawerWidth:window.innerWidth<=991?"90%":"45%"}}}),se={key:2,class:"ant-form-item-explain-error",style:{marginTop:"-15px"}};function de(e,l,u,b,y,g){const n=G,i=H,d=Q,v=R,k=X,D=Y,r=z,p=S("form-item-heading"),s=S("MinusSquareOutlined"),O=S("PlusOutlined"),C=J,T=K,q=S("SaveOutlined"),B=Z;return f(),c(B,{open:e.visible,closable:!1,centered:!0,title:e.pageTitle,onOk:e.onSubmit},{footer:a(()=>[t(C,{key:"submit",type:"primary",loading:e.loading,onClick:e.onSubmit},{icon:a(()=>[t(q)]),default:a(()=>[m(" "+_(e.addEditType=="add"?e.$t("common.create"):e.$t("common.update")),1)]),_:1},8,["loading","onClick"]),t(C,{key:"back",onClick:e.onClose},{default:a(()=>[m(_(e.$t("common.cancel")),1)]),_:1},8,["onClick"])]),default:a(()=>[t(T,{layout:"vertical"},{default:a(()=>[t(v,{gutter:16},{default:a(()=>[t(d,{xs:24,sm:24,md:24,lg:24},{default:a(()=>[t(i,{label:e.$t("tax.name"),name:"name",help:e.rules.name?e.rules.name.message:null,validateStatus:e.rules.name?"error":null,class:"required"},{default:a(()=>[t(n,{value:e.formData.name,"onUpdate:value":l[0]||(l[0]=o=>e.formData.name=o),placeholder:e.$t("common.placeholder_default_text",[e.$t("tax.name")])},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),t(v,{gutter:16},{default:a(()=>[t(d,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[t(i,{label:e.$t("tax.tax_type"),name:"tax_type",help:e.rules.tax_type?e.rules.tax_type.message:null,validateStatus:e.rules.tax_type?"error":null,class:"required"},{default:a(()=>[t(D,{value:e.formData.tax_type,"onUpdate:value":l[1]||(l[1]=o=>e.formData.tax_type=o),placeholder:e.$t("common.select_default_text",[e.$t("tax.tax_type")]),onChange:l[2]||(l[2]=o=>{e.formData.rate=o=="multiple"?e.sumBy(e.formFields,"rate"):void 0})},{default:a(()=>[t(k,{value:"single"},{default:a(()=>[m(_(e.$t("tax.single")),1)]),_:1}),t(k,{value:"multiple"},{default:a(()=>[m(_(e.$t("tax.multiple")),1)]),_:1})]),_:1},8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1}),t(d,{xs:24,sm:24,md:12,lg:12},{default:a(()=>[t(i,{label:e.$t("tax.rate"),name:"rate",help:e.rules.rate?e.rules.rate.message:null,validateStatus:e.rules.rate?"error":null,class:"required"},{default:a(()=>[t(r,{value:e.formData.rate,"onUpdate:value":l[3]||(l[3]=o=>e.formData.rate=o),placeholder:e.$t("common.placeholder_default_text",[e.$t("tax.rate")]),min:"0",style:{width:"100%"},disabled:e.formData.tax_type=="multiple"},{addonAfter:a(()=>l[5]||(l[5]=[m("%")])),_:1},8,["value","placeholder","disabled"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),e.formData.tax_type=="multiple"?(f(),c(p,{key:0},{default:a(()=>[m(_(e.$t("tax.multiple_tax")),1)]),_:1})):h("",!0),e.formData.tax_type=="multiple"?(f(!0),F(W,{key:1},P(e.formFields,(o,re)=>(f(),c(v,{gutter:16,key:o.id,style:{display:"flex","align-items":"center"}},{default:a(()=>[t(d,{xs:24,sm:24,md:e.addEditType=="add"?11:12,lg:e.addEditType=="add"?11:12},{default:a(()=>[t(i,{name:"tax_name",help:e.rules.tax_name?e.rules.tax_name.message:null,validateStatus:e.rules.tax_name?"error":null,class:"required"},{default:a(()=>[t(n,{value:o.tax_name,"onUpdate:value":x=>o.tax_name=x,placeholder:e.$t("common.placeholder_default_text",[e.$t("tax.name")]),min:"0",style:{width:"100%"}},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["help","validateStatus"])]),_:2},1032,["md","lg"]),t(d,{xs:24,sm:24,md:e.addEditType=="add"?11:12,lg:e.addEditType=="add"?11:12},{default:a(()=>[t(i,{name:"rate",class:"required"},{default:a(()=>[t(r,{value:o.rate,"onUpdate:value":x=>o.rate=x,placeholder:e.$t("common.placeholder_default_text",[e.$t("tax.rate")]),style:{width:"100%"},onChange:l[4]||(l[4]=()=>{e.formData.rate=e.sumBy(e.formFields,"rate")})},{addonAfter:a(()=>l[6]||(l[6]=[m("%")])),_:2},1032,["value","onUpdate:value","placeholder"])]),_:2},1024)]),_:2},1032,["md","lg"]),e.addEditType=="add"?(f(),c(d,{key:0,span:2,style:{"margin-bottom":"20px"}},{default:a(()=>[t(s,{onClick:()=>{e.removeFormField(o),e.formData.rate=e.sumBy(e.formFields,"rate")}},null,8,["onClick"])]),_:2},1024)):h("",!0)]),_:2},1024))),128)):h("",!0),e.rules&&e.rules.multiple_taxes?(f(),F("p",se,_(e.rules.multiple_taxes.message),1)):h("",!0),e.formData.tax_type=="multiple"?(f(),c(v,{key:3,gutter:16},{default:a(()=>[t(d,{xs:24,sm:24,md:4,lg:4},{default:a(()=>[t(i,null,{default:a(()=>[t(C,{type:"primary",onClick:e.addFormField,disabled:e.addFormButtonStatus},{default:a(()=>[t(O),m(" "+_(e.$t("tax.add")),1)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})):h("",!0)]),_:1})]),_:1},8,["open","title","onOk"])}const ge=U(oe,[["render",de]]);export{ge as A,ye as f};

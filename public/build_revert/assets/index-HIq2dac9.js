import{b as q,Y as H,_ as N,d as oe,Q as W,aT as de,r as B,z as G,o as s,g as b,w as t,a,j as i,t as u,h as K,c as y,L as P,D as w,i as p,aG as Q,aD as X,p as g,m as re,q as J,f as Z,bC as ie,bv as ue,bt as me,b3 as pe,F as _e,B as x,a0 as ee,ap as ce,az as fe,aA as ve,a5 as ye,b0 as ge,X as V,aH as z,ax as Y,ay as be,aB as he,aC as ke,an as Ce,ao as Ae,bi as De,G as Se}from"./app-OikDM5Kw.js";import{c as $e}from"./crud-BXjQ0O-i.js";import{a as we}from"./apiAdmin-yFrp6bZq.js";import{S as Te}from"./StaffAddButton-CA3WeqKv.js";import{U as Oe}from"./UploadFile-DR1pWrT7.js";import{L as Ee}from"./AddButton-DkoJX8P3.js";import{D as Ue}from"./DateRangePicker-S2EeC5bP.js";import{S as Me}from"./SaveOutlined-BSR-wlKo.js";import{A as je}from"./AdminPageHeader-MbAN4P4t.js";import{L as Ie}from"./LeaveSidebar-Cp6UaTnL.js";import"./datatable-DjynKO_7.js";import"./filter-CQCFHrIe.js";import"./fields-DfhbxYIm.js";import"./Upload-D5F1bEQ_.js";import"./AddButton-BQyn84QE.js";import"./AddEdit-DHyK7A_P.js";import"./SettingOutlined-DBG_v97O.js";import"./AddButton-D9RkJdxV.js";import"./AddEdit-DKTkvuxN.js";import"./fields-Di8MX3Au.js";import"./index-CaGusbUe.js";import"./ScheduleOutlined-Dj7wWgnj.js";import"./TabletOutlined-vCKQCqfa.js";import"./FundViewOutlined-Cv0xqeLO.js";import"./UnderlineOutlined-C7p3VsLK.js";const Be=()=>{const{user:e}=q(),o="leaves",{t:c}=H(),l=["leave_type_id","user_id"],E={user_id:e.value.xid,leave_type_id:void 0,start_date:void 0,end_date:void 0,is_half_day:0,reason:"",status:"approved",date:void 0},_=[{title:c("leave.user_id"),dataIndex:"user_id"},{title:c("leave.leave_type"),dataIndex:"leave_type_id"},{title:c("leave.start_date"),dataIndex:"start_date"},{title:c("leave.end_date"),dataIndex:"end_date"},{title:c("leave.is_half_day"),dataIndex:"is_half_day"},{title:c("leave.status"),dataIndex:"status"},{title:c("common.action"),dataIndex:"action"}],r=[{key:"name",value:c("common.name")}];return{addEditUrl:o,initData:E,columns:_,filterableColumns:r,hashableColumns:l}},Pe=oe({props:["formData","data","visible","url","addEditType","pageTitle","successMessage"],components:{PlusOutlined:W,LoadingOutlined:de,SaveOutlined:Me,StaffMemberAddButton:Te,LeaveTypeAddButton:Ee,UploadFile:Oe,DateRangePicker:Ue},setup(e,{emit:o}){const{addEditRequestAdmin:c,loading:l,rules:E}=we(),{appSetting:_,disabledDate:r,permsArray:T}=q(),D=B([]),h="users?limit=10000",f=B([]),A="leave-types?fields=id,xid,name&limit=10000";return G(()=>{const v=axiosAdmin.get(h),S=axiosAdmin.get(A);Promise.all([v,S]).then(([j,$])=>{D.value=j.data,f.value=$.data})}),{loading:l,rules:E,onClose:()=>{E.value={},o("closed")},onSubmit:()=>{c({url:e.url,data:{...e.formData,start_date:e.formData.date?e.formData.date[0]:"",end_date:e.formData.date?e.formData.date[1]:""},successMessage:e.successMessage,success:v=>{o("addEditSuccess",v.xid)}})},appSetting:_,disabledDate:r,permsArray:T,staffMemberAdded:()=>{axiosAdmin.get(h).then(v=>{D.value=v.data})},allStaffMembers:D,leaveTypeAdded:()=>{axiosAdmin.get(A).then(v=>{f.value=v.data})},allLeaveTypes:f,drawerWidth:window.innerWidth<=991?"90%":"45%"}}}),Re={style:{display:"flex"}},Fe={style:{display:"flex"}};function Le(e,o,c,l,E,_){const r=Q,T=X,D=g("StaffMemberAddButton"),h=re,f=J,A=Z,k=g("LeaveTypeAddButton"),M=ie,C=ue,U=me,v=pe,S=_e,j=g("SaveOutlined"),$=x,O=ee,I=ce;return s(),b(I,{title:e.pageTitle,width:e.drawerWidth,open:e.visible,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},maskClosable:!1,onClose:e.onClose},{footer:t(()=>[a(O,null,{default:t(()=>[a($,{key:"submit",type:"primary",loading:e.loading,onClick:e.onSubmit},{icon:t(()=>[a(j)]),default:t(()=>[i(" "+u(e.addEditType=="add"?e.$t("common.create"):e.$t("common.update")),1)]),_:1},8,["loading","onClick"]),a($,{key:"back",onClick:e.onClose},{default:t(()=>[i(u(e.$t("common.cancel")),1)]),_:1},8,["onClick"])]),_:1})]),default:t(()=>[a(S,{layout:"vertical"},{default:t(()=>[a(A,{gutter:16},{default:t(()=>[e.permsArray.includes("admin")||e.permsArray.includes("leaves_assign_to_all")?(s(),b(f,{key:0,xs:24,sm:24,md:24,lg:24},{default:t(()=>[a(h,{label:e.$t("leave.user_id"),name:"user_id",help:e.rules.user_id?e.rules.user_id.message:null,validateStatus:e.rules.user_id?"error":null,class:"required"},{default:t(()=>[K("span",Re,[a(T,{value:e.formData.user_id,"onUpdate:value":o[0]||(o[0]=d=>e.formData.user_id=d),placeholder:e.$t("common.select_default_text",[e.$t("leave.user_id")]),allowClear:!0},{default:t(()=>[(s(!0),y(w,null,P(e.allStaffMembers,d=>(s(),b(r,{key:d.xid,value:d.xid},{default:t(()=>[i(u(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"]),a(D,{onOnAddSuccess:e.staffMemberAdded},null,8,["onOnAddSuccess"])])]),_:1},8,["label","help","validateStatus"])]),_:1})):p("",!0)]),_:1}),a(A,{gutter:16},{default:t(()=>[a(f,{xs:24,sm:24,md:24,lg:12},{default:t(()=>[a(h,{label:e.$t("leave.leave_type"),name:"leave_type_id",help:e.rules.leave_type_id?e.rules.leave_type_id.message:null,validateStatus:e.rules.leave_type_id?"error":null,class:"required"},{default:t(()=>[K("span",Fe,[a(T,{value:e.formData.leave_type_id,"onUpdate:value":o[1]||(o[1]=d=>e.formData.leave_type_id=d),placeholder:e.$t("common.select_default_text",[e.$t("leave.leave_type")]),allowClear:!0},{default:t(()=>[(s(!0),y(w,null,P(e.allLeaveTypes,d=>(s(),b(r,{key:d.xid,value:d.xid},{default:t(()=>[i(u(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"]),a(k,{onOnAddSuccess:e.leaveTypeAdded},null,8,["onOnAddSuccess"])])]),_:1},8,["label","help","validateStatus"])]),_:1}),a(f,{xs:24,sm:24,md:24,lg:12},{default:t(()=>[a(h,{label:e.$t("holiday.date"),name:"date",help:e.rules.date?e.rules.date.message:null,validateStatus:e.rules.date?"error":null,class:"required"},{default:t(()=>[a(M,{format:e.appSetting.date_format,valueFormat:"YYYY-MM-DD",value:e.formData.date,"onUpdate:value":o[2]||(o[2]=d=>e.formData.date=d),style:{width:"100%"}},null,8,["format","value"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1}),a(A,{gutter:16},{default:t(()=>[a(f,{xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(h,{label:e.$t("leave.is_half_day"),name:"is_half_day",help:e.rules.is_half_day?e.rules.is_half_day.message:null,validateStatus:e.rules.is_half_day?"error":null},{default:t(()=>[a(U,{value:e.formData.is_half_day,"onUpdate:value":o[3]||(o[3]=d=>e.formData.is_half_day=d),"button-style":"solid",size:"small"},{default:t(()=>[a(C,{value:1},{default:t(()=>[i(u(e.$t("common.yes")),1)]),_:1}),a(C,{value:0},{default:t(()=>[i(u(e.$t("common.no")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label","help","validateStatus"])]),_:1}),e.permsArray.includes("admin")||e.permsArray.includes("leaves_approve_reject")?(s(),b(f,{key:0,xs:24,sm:24,md:12,lg:12},{default:t(()=>[a(h,{label:e.$t("user.status"),name:"status",help:e.rules.status?e.rules.status.message:null,validateStatus:e.rules.status?"error":null},{default:t(()=>[a(T,{value:e.formData.status,"onUpdate:value":o[4]||(o[4]=d=>e.formData.status=d),placeholder:e.$t("common.select_default_text",[e.$t("common.status")])},{default:t(()=>[a(r,{value:"pending"},{default:t(()=>[i(u(e.$t("common.pending")),1)]),_:1}),a(r,{value:"approved"},{default:t(()=>[i(u(e.$t("common.approved")),1)]),_:1}),a(r,{value:"rejected"},{default:t(()=>[i(u(e.$t("common.rejected")),1)]),_:1})]),_:1},8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})):p("",!0)]),_:1}),a(A,{gutter:16},{default:t(()=>[a(f,{xs:24,sm:24,md:24,lg:24},{default:t(()=>[a(h,{label:e.$t("leave.reason"),name:"reason",help:e.rules.reason?e.rules.reason.message:null,validateStatus:e.rules.reason?"error":null,class:"required"},{default:t(()=>[a(v,{value:e.formData.reason,"onUpdate:value":o[5]||(o[5]=d=>e.formData.reason=d),placeholder:e.$t("common.placeholder_default_text",[e.$t("leave.reason")]),rows:4},null,8,["value","placeholder"])]),_:1},8,["label","help","validateStatus"])]),_:1})]),_:1})]),_:1})]),_:1},8,["title","width","open","onClose"])}const Ke=N(Pe,[["render",Le]]),qe={components:{PlusOutlined:W,EditOutlined:fe,DeleteOutlined:ve,AddEdit:Ke,AdminPageHeader:je,LeaveSidebar:Ie,CloseOutlined:ye,CheckOutlined:ge},setup(){const{addEditUrl:e,initData:o,columns:c,filterableColumns:l,hashableColumns:E}=Be(),_=$e(),{t:r}=H(),{permsArray:T,appSetting:D,formatDate:h,user:f}=q(),A=B({status:"all",user_id:void 0,leave_type_id:void 0}),k=B("all"),M=B([]),C="users?limit=10000",U=B([]),v="leave-types?limit=10000";G(()=>{S();const O=axiosAdmin.get(v),I=axiosAdmin.get(C);Promise.all([I,O]).then(([d,R])=>{M.value=d.data,U.value=R.data}),_.crudUrl.value=e,_.langKey.value="leave",_.initData.value={...o},_.formData.value={...o},_.hashableColumns.value=[...E]});const S=()=>{_.tableUrl.value={url:"leaves?fields=id,xid,user_id,x_user_id,user{id,xid,name},leave_type_id,x_leave_type_id,leaveType{id,xid,name},start_date,end_date,is_half_day,reason,status",extraFilters:A},_.table.filterableColumns=l,_.fetch({page:1})};return{columns:c,..._,filterableColumns:l,permsArray:T,appSetting:D,formatDate:h,setUrlData:S,leaveApproved:O=>{V.confirm({title:r("common.approved")+"?",icon:a(z),content:r("common.approved_message"),centered:!0,okText:r("common.yes"),okType:"danger",cancelText:r("common.no"),onOk(){return axiosAdmin.post(`leaves/update-status/${O}`,{status:"approved"}).then(I=>{S(),Y.success({message:r("common.success"),description:r("common.status_changed"),placement:"bottomRight"})}).catch(()=>{})},onCancel(){}})},leaveRejected:O=>{V.confirm({title:r("common.rejected")+"?",icon:a(z),content:r("common.rejected_message"),centered:!0,okText:r("common.yes"),okType:"danger",cancelText:r("common.no"),onOk(){return axiosAdmin.post(`leaves/update-status/${O}`,{status:"rejected"}).then(I=>{S(),Y.success({message:r("common.success"),description:r("common.status_changed"),placement:"bottomRight"})}).catch(()=>{})},onCancel(){}})},activeTabKey:k,allUsers:M,staffMembersUrl:C,extraFilters:A,leaveTypes:U,user:f}}},Ve={class:"table-responsive"},ze={key:0},Ye={key:1},He={key:2};function Ne(e,o,c,l,E,_){const r=be,T=g("router-link"),D=he,h=ke,f=g("AdminPageHeader"),A=g("LeaveSidebar"),k=J,M=g("PlusOutlined"),C=x,U=g("DeleteOutlined"),v=ee,S=Q,j=X,$=Z,O=g("admin-page-filters"),I=g("AddEdit"),d=Ce,R=Ae,F=De,ae=g("CheckOutlined"),te=g("CloseOutlined"),le=g("EditOutlined"),ne=Se,se=g("admin-page-table-content");return s(),y(w,null,[a(f,null,{header:t(()=>[a(r,{title:e.$t("menu.leaves"),class:"p-0"},null,8,["title"])]),breadcrumb:t(()=>[a(h,{separator:"-",style:{"font-size":"12px"}},{default:t(()=>[a(D,null,{default:t(()=>[a(T,{to:{name:"admin.dashboard.index"}},{default:t(()=>[i(u(e.$t("menu.dashboard")),1)]),_:1})]),_:1}),a(D,null,{default:t(()=>[i(u(e.$t("menu.hrm")),1)]),_:1}),a(D,null,{default:t(()=>[i(u(e.$t("menu.leaves")),1)]),_:1})]),_:1})]),_:1}),a($,null,{default:t(()=>[a(k,{xs:24,sm:24,md:24,lg:4,xl:4,class:"bg-setting-sidebar"},{default:t(()=>[a(A)]),_:1}),a(k,{xs:24,sm:24,md:24,lg:20,xl:20},{default:t(()=>[a(O,null,{default:t(()=>[a($,{gutter:[16,16]},{default:t(()=>[a(k,{xs:24,sm:24,md:12,lg:10,xl:10},{default:t(()=>[a(v,null,{default:t(()=>[a(C,{type:"primary",onClick:e.addItem},{default:t(()=>[a(M),i(" "+u(e.$t("leave.add")),1)]),_:1},8,["onClick"]),e.table.selectedRowKeys.length>0?(s(),b(C,{key:0,type:"primary",onClick:e.showSelectedDeleteConfirm,danger:""},{icon:t(()=>[a(U)]),default:t(()=>[i(" "+u(e.$t("common.delete")),1)]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1}),a(k,{xs:24,sm:24,md:12,lg:14,xl:14},{default:t(()=>[a($,{gutter:[16,16],justify:"end"},{default:t(()=>[a(k,{xs:24,sm:24,md:12,lg:8,xl:8},{default:t(()=>[a(j,{value:l.extraFilters.leave_type_id,"onUpdate:value":o[0]||(o[0]=n=>l.extraFilters.leave_type_id=n),onChange:l.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("leave.leave_type")]),allowClear:!0},{default:t(()=>[(s(!0),y(w,null,P(l.leaveTypes,n=>(s(),b(S,{key:n.xid,value:n.xid,title:n.name},{default:t(()=>[i(u(n.name),1)]),_:2},1032,["value","title"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1}),l.permsArray.includes("admin")||l.permsArray.includes("leaves_assign_to_all")?(s(),b(k,{key:0,xs:24,sm:24,md:12,lg:8,xl:8},{default:t(()=>[a(j,{value:l.extraFilters.user_id,"onUpdate:value":o[1]||(o[1]=n=>l.extraFilters.user_id=n),onChange:l.setUrlData,"show-search":"",style:{width:"100%"},placeholder:e.$t("common.select_default_text",[e.$t("leave.user")]),allowClear:!0},{default:t(()=>[(s(!0),y(w,null,P(l.allUsers,n=>(s(),b(S,{key:n.xid,value:n.xid,title:n.name},{default:t(()=>[i(u(n.name),1)]),_:2},1032,["value","title"]))),128))]),_:1},8,["value","onChange","placeholder"])]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),a(se,null,{default:t(()=>[a(I,{addEditType:e.addEditType,visible:e.addEditVisible,url:e.addEditUrl,onAddEditSuccess:e.addEditSuccess,onClosed:e.onCloseAddEdit,formData:e.formData,data:e.viewData,pageTitle:e.pageTitle,successMessage:e.successMessage},null,8,["addEditType","visible","url","onAddEditSuccess","onClosed","formData","data","pageTitle","successMessage"]),a($,null,{default:t(()=>[a(k,{span:24},{default:t(()=>[a(R,{activeKey:l.extraFilters.status,"onUpdate:activeKey":o[2]||(o[2]=n=>l.extraFilters.status=n),onChange:l.setUrlData},{default:t(()=>[a(d,{key:"all",tab:`${e.$t("common.all")}`},null,8,["tab"]),a(d,{key:"pending",tab:`${e.$t("common.pending")}`},null,8,["tab"]),a(d,{key:"approved",tab:`${e.$t("common.approved")}`},null,8,["tab"]),a(d,{key:"rejected",tab:`${e.$t("common.rejected")}`},null,8,["tab"])]),_:1},8,["activeKey","onChange"])]),_:1})]),_:1}),a($,null,{default:t(()=>[a(k,{span:24},{default:t(()=>[K("div",Ve,[a(ne,{"row-selection":{selectedRowKeys:e.table.selectedRowKeys,onChange:e.onRowSelectChange,getCheckboxProps:n=>({disabled:!(l.permsArray.includes("admin")||l.permsArray.includes("leaves_delete_all")||n.status=="pending"),name:n.xid})},columns:l.columns,"row-key":n=>n.xid,"data-source":e.table.data,pagination:e.table.pagination,loading:e.table.loading,onChange:e.handleTableChange,bordered:"",size:"middle"},{bodyCell:t(({column:n,record:m})=>[n.dataIndex=="user_id"?(s(),y(w,{key:0},[i(u(m.user.name),1)],64)):p("",!0),n.dataIndex=="start_date"?(s(),y(w,{key:1},[i(u(l.formatDate(m.start_date)),1)],64)):p("",!0),n.dataIndex=="end_date"?(s(),y(w,{key:2},[i(u(l.formatDate(m.end_date)),1)],64)):p("",!0),n.dataIndex=="is_half_day"?(s(),y(w,{key:3},[i(u(m.is_half_day?e.$t("common.yes"):e.$t("common.no")),1)],64)):p("",!0),n.dataIndex=="leave_type_id"?(s(),y(w,{key:4},[i(u(m.leave_type.name),1)],64)):p("",!0),n.dataIndex==="status"?(s(),y(w,{key:5},[m.status=="pending"?(s(),y("div",ze,[a(F,{color:"yellow"},{default:t(()=>[i(u(e.$t("common.pending")),1)]),_:1})])):p("",!0),m.status=="approved"?(s(),y("div",Ye,[a(F,{color:"green"},{default:t(()=>[i(u(e.$t("common.approved")),1)]),_:1})])):p("",!0),m.status=="rejected"?(s(),y("div",He,[a(F,{color:"red"},{default:t(()=>[i(u(e.$t("common.rejected")),1)]),_:1})])):p("",!0)],64)):p("",!0),n.dataIndex==="action"?(s(),b(v,{key:6},{default:t(()=>[m.status=="pending"&&(l.permsArray.includes("admin")||l.permsArray.includes("leaves_approve_reject"))?(s(),b(C,{key:0,type:"primary",onClick:L=>l.leaveApproved(m.xid)},{icon:t(()=>[a(ae)]),_:2},1032,["onClick"])):p("",!0),m.status=="pending"&&(l.permsArray.includes("admin")||l.permsArray.includes("leaves_approve_reject"))?(s(),b(C,{key:1,type:"primary",onClick:L=>l.leaveRejected(m.xid),danger:""},{icon:t(()=>[a(te)]),_:2},1032,["onClick"])):p("",!0),m.status=="pending"&&(m.x_user_id==l.user.xid||l.permsArray.includes("admin")||l.permsArray.includes("leaves_edit_all"))?(s(),b(C,{key:2,type:"primary",onClick:L=>e.editItem(m)},{icon:t(()=>[a(le)]),_:2},1032,["onClick"])):p("",!0),m.status=="pending"&&m.x_user_id==l.user.xid||l.permsArray.includes("admin")||l.permsArray.includes("leaves_delete_all")?(s(),b(C,{key:3,type:"primary",onClick:L=>e.showDeleteConfirm(m.xid)},{icon:t(()=>[a(U)]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)):p("",!0)]),_:1},8,["row-selection","columns","row-key","data-source","pagination","loading","onChange"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)}const ga=N(qe,[["render",Ne]]);export{ga as default};
